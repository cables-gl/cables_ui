        <a id="undev" data-info="undevLogo" class="icon-undev info" target="_blank" href="http://www.undev.de"></a>
    </div>
</body>
<script>
    "use strict";
    var CABLESUILOADER = CABLESUILOADER || {};

    CABLESUILOADER.GlobalVarTester = (function ()
    {
        var fields = {};
        var before = function (w)
        {
            for (var field in w)
            {
                fields[field] = true;
            }
        };

        var after = function (w)
        {
            for (var field in w)
            {
                if (!fields[field])
                {
                    console.log(field + " has been added");
                }
            }
            ;

        };
        return {
            before: before,
            after: after
        };
    }());

    CABLESUILOADER.preload = {};
    CABLESUILOADER.GlobalVarTester.before(window);

    CABLESUILOADER.uiLoadStart = performance.now();
    CABLESUILOADER.startup = {};
    CABLESUILOADER.startup.log = [];
    CABLESUILOADER.startup.maxEvents = 15 - 1;
    CABLESUILOADER.startup.numEvents = 0;

    CABLESUILOADER.buildInfo = {};

    function incrementStartup()
    {
        CABLESUILOADER.startup.numEvents++;

        const loadingBarEle = document.getElementById("loadingstatusBar");
        if (loadingBarEle) loadingBarEle.style.width = (CABLESUILOADER.startup.numEvents / CABLESUILOADER.startup.maxEvents) * 100 + "%";
    }

    function logStartup(title)
    {

        const timeUsed = Math.round((performance.now() - CABLESUILOADER.uiLoadStart) / 1000 * 100) / 100;

        CABLESUILOADER.startup.log.push(
            {
                "title": title,
                "time": timeUsed
            });

        if (!window.CABLES || !CABLES.sandbox || !CABLES.sandbox.isDevEnv()) return;
        document.getElementById("loadingstatusLog").innerHTML += title + " (" + timeUsed + ") <br/>";
        document.querySelectorAll(".devOnly").forEach(e => e.style.display = "inherit");
    }

    CABLESUILOADER.noCacheUrl = function (url)
    {
        let seperator = "?";
        if(url.includes("?")) seperator = "&";
        return url + seperator + "nc=" + (Date.now() + "").substr(-6);
    };

    CABLESUILOADER.builtVersionUrl = function (component, url)
    {
        let ncUrl = CABLESUILOADER.noCacheUrl(url);
        if (CABLESUILOADER.buildInfo)
        {
            if (CABLESUILOADER.buildInfo[component])
            {
                ncUrl = url + "?nc=" + CABLESUILOADER.buildInfo[component].timestamp;
            }
        }
        return ncUrl;
    };

    incrementStartup();
    if (window.logStartup) logStartup("Start");
    const numRetries = 5;

    CABLESUILOADER.loadAll = function (cfg)
    {
        CABLESUILOADER.cfg = cfg;
        if (!window.hasOwnProperty("loadjs"))
        {
            setTimeout(CABLESUILOADER.loadAll, 100);
            console.log("wait for loadjs...");
            return;
        }

        logStartup("loaded minimum libs / starting up...");

        incrementStartup();

        loadjs([
            CABLESUILOADER.builtVersionUrl("core", "js/libs.core.min.js")
        ], "libs");

        var jsType = "max";
        if (!cfg.isDevEnv) jsType = "min";

        loadjs.ready("libs", function ()
        {
            incrementStartup();
            logStartup("loaded libs");


            loadjs([CABLESUILOADER.builtVersionUrl("core", "js/cables." + jsType + ".js")], "cables_core");

            loadjs.ready("cables_core", function ()
            {
                logStartup("loaded cables core");
                // console.log("core loaded",CABLES);

                incrementStartup();

                loadjs([CABLESUILOADER.builtVersionUrl("ui", "js/cablesui." + jsType + ".js")], "cablesuinew");

                loadjs.ready("cablesuinew", function ()
                {
                    incrementStartup();
                    logStartup("loaded ui");

                    CABLESUILOADER.talkerAPI = CABLESUILOADER.talkerAPI || new CABLESUILOADER.TalkerAPI(window.parent);
                    CABLESUILOADER.talkerAPI.send("getOpDocsAll", { "projectId": cfg.patchId }, (err, _data) =>
                    {
                        if (err)
                        {
                            console.error("preloading error", err);
                        }
                        else
                        {
                            CABLESUILOADER.preload.opDocsAll = _data;
                        }
                    }, (response) =>
                    {
                        console.error("preloading error", response);
                    });

                    let platformClass = "PlatformCommunity";
                    if(cfg && cfg.platformClass) {
                        if(CABLES.hasOwnProperty(cfg.platformClass)) {
                            platformClass = cfg.platformClass;
                            console.info("using sandbox from", platformClass);
                        }else{
                            console.error("could not find class for sandbox", cfg.platformClass, "using", platformClass);
                        }

                    }
                    CABLES.sandbox = new CABLES[platformClass](cfg);

                    incrementStartup();
                    loadjs([CABLESUILOADER.noCacheUrl(CABLES.sandbox.getUrlOpsCode()), CABLESUILOADER.noCacheUrl(CABLES.sandbox.getUrlProjectOpsCode(cfg.patchId))], 'all_ops');
                    loadjs.ready('all_ops', () =>
                    {
                        incrementStartup();
                        logStartup('loaded cables ops');
                        const uiBuild = CABLESUILOADER.buildInfo.ui;
                        const coreBuild = CABLESUILOADER.buildInfo.core;
                        const apiBuild = CABLESUILOADER.buildInfo.api;

                        if(uiBuild && uiBuild.git) if(window.logStartup) logStartup("UI buildmessage: " + uiBuild.git.message);
                        if(coreBuild && coreBuild.git) if(window.logStartup) logStartup("CORE buildmessage: " + coreBuild.git.message);
                        if(apiBuild && apiBuild.git)  if(window.logStartup) logStartup("API buildmessage: " + apiBuild.git.message);

                        waitForAce();
                    });
                });
            });
        });
    };

    function waitForAce()
    {
        if (!CABLESUILOADER.preload.opDocsAll)
        {
            console.log("waiting for opDocsAll...");
            setTimeout(waitForAce, 100);
        }
        else
        {
            CABLESUILOADER.uiLoadFiles = performance.now() - CABLESUILOADER.uiLoadStart;

            CABLES.UI.startUi(CABLESUILOADER.cfg);
        }
    }

    document.addEventListener("DOMContentLoaded", function (event)
    {
        CABLESUILOADER.talkerAPI = CABLESUILOADER.talkerAPI || new CABLESUILOADER.TalkerAPI(window.parent);

        const reqTimeout=setTimeout(()=>
        {
            document.getElementById("loadingstatus").style.display="none";
            document.getElementById("loadingstatusLog").innerHTML += "error: could not get response from talker api. editor not in iframe? <br/>";
        },1000);

        CABLESUILOADER.talkerAPI.send("requestPatchData", {}, function (response)
        {
            clearTimeout(reqTimeout);

            if (response.buildInfo)
            {
                CABLESUILOADER.buildInfo = response.buildInfo;
            }
            CABLESUILOADER.loadAll(response);
        });
    });

    if (!(function () { return !this; })()) console.log("not in strict mode: footer html");

</script>

<div class="preloading" style="font-family:SourceSansPro"></div>

<div id="testcontent"></div>

</html>
