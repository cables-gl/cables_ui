function generateUUID(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e}function isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}function ajaxRequest(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(t){e(t.target.response)},i.send()}function Timer(){function t(){return a=(Date.now()-s)/1e3,a+r}function e(){if(!u)for(var t in g)g[t]()}function i(){if(!u)for(var t in c)c[t]()}var n=this,s=Date.now(),r=0,o=0,a=0,h=!0,l=0,u=!1;this.overwriteTime=-1,this.setDelay=function(t){l=t,i()},this.isPlaying=function(){return!h},this.update=function(){return h?void 0:o=t()},this.getTime=function(){return this.overwriteTime>=0?this.overwriteTime-l:o-l},this.togglePlay=function(){h?n.play():n.pause()},this.setTime=function(t){0>t&&(t=0),s=Date.now(),r=t,o=t,i()},this.setOffset=function(t){0>o+t?(s=Date.now(),r=0,o=0):(r+=t,o=a+r),i()},this.play=function(){s=Date.now(),h=!1,e()},this.pause=function(){r=o,h=!0,e()};var g=[],c=[];this.pauseEvents=function(t){u=t},this.onPlayPause=function(t){t&&"function"==typeof t&&g.push(t)},this.onTimeChange=function(t){t&&"function"==typeof t&&c.push(t)}}CABLES=CABLES||{},CABLES.ajax=function(t,e,i,n,s){var r,o;try{o=new XMLHttpRequest}catch(a){}o.onreadystatechange=function(){4==o.readyState&&(clearTimeout(r),e(200!=o.status?new Error(t+"server response status is "+o.status):!1,o.responseText,o))},o.open(i?i.toUpperCase():"GET",t,!0),n?(o.setRequestHeader("Content-type",s?s:"application/x-www-form-urlencoded"),o.send(n)):o.send()},String.prototype.endl=function(){return this+"\n"};var arrayContains=function(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1};CGL=CGL||{},CGL.DEG2RAD=3.14159/180,CGL.numMaxLoadingAssets=0,CGL.numLoadingAssets=0,CGL.onLoadingAssetsFinished=null,CGL.finishedLoading=function(){return 0!==CGL.numLoadingAssets},CGL.incrementLoadingAssets=function(){CGL.numLoadingAssets++,CGL.numMaxLoadingAssets=Math.max(CGL.numLoadingAssets,CGL.numMaxLoadingAssets)},CGL.decrementLoadingAssets=function(){CGL.numLoadingAssets--,setTimeout(CGL.getLoadingStatus,100)},CGL.getLoadingStatus=function(){if(0===CGL.numMaxLoadingAssets)return 0;var t=(CGL.numMaxLoadingAssets-CGL.numLoadingAssets)/CGL.numMaxLoadingAssets;return 1==t&&CGL.onLoadingAssetsFinished&&CGL.onLoadingAssetsFinished(),t};var CGL=CGL||{};CGL.Mesh=function(t,e){function n(t,e,n){var s=r.gl.createBuffer();r.gl.bindBuffer(r.gl.ARRAY_BUFFER,s),r.gl.bufferData(r.gl.ARRAY_BUFFER,new Float32Array(e),r.gl.STATIC_DRAW);var o={loc:-1,buffer:s,name:t,itemSize:n,numItems:e.length/n};for(h.push(o),i=0;i<h.length;i++)h[i].loc=-1}function s(t){for(r.gl.enableVertexAttribArray(t.getAttrVertexPos()),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,o),r.gl.vertexAttribPointer(t.getAttrVertexPos(),o.itemSize,r.gl.FLOAT,!1,0,0),i=0;i<h.length;i++)-1==h[i].loc&&(h[i].loc=r.gl.getAttribLocation(t.getProgram(),h[i].name)),-1!=h[i].loc&&(r.gl.enableVertexAttribArray(h[i].loc),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,h[i].buffer),r.gl.vertexAttribPointer(h[i].loc,h[i].itemSize,r.gl.FLOAT,!1,0,0));r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,a)}var r=t,o=r.gl.createBuffer(),a=r.gl.createBuffer(),h=[];this.getAttributes=function(){return h},this.setGeom=function(t){this.meshChanged()||this.unBind(),h.length=0,r.gl.bindBuffer(r.gl.ARRAY_BUFFER,o),r.gl.bufferData(r.gl.ARRAY_BUFFER,new Float32Array(t.vertices),r.gl.STATIC_DRAW),o.itemSize=3,o.numItems=t.vertices.length/3,r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,a),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.verticesIndices),r.gl.STATIC_DRAW),a.itemSize=1,a.numItems=t.verticesIndices.length,t.vertexNormals.length>0&&n("attrVertNormal",t.vertexNormals,3),t.texCoords.length>0&&n("attrTexCoord",t.texCoords,2);for(var e=0;e<t.morphTargets.length;e++)n("attrMorphTargetA",t.morphTargets[e],3)},this.unBind=function(){for(r.lastMesh=null,r.lastMeshShader=null,i=0;i<h.length;i++)-1!=h[i].loc&&r.gl.disableVertexAttribArray(h[i].loc)},this.meshChanged=function(){return r.lastMesh&&r.lastMesh!=this},this.render=function(t){if(t){t.bind(),s(t);var e=r.gl.TRIANGLES;r.wireframe?e=r.gl.LINES:r.points&&(e=r.gl.POINTS),r.gl.drawElements(e,a.numItems,r.gl.UNSIGNED_SHORT,0),this.unBind()}},this.setGeom(e)},CGL.Geometry=function(){function t(t){var e=[0,0,0],i=[0,0,0],n=[0,0,0];return vec3.subtract(e,t[0],t[1]),vec3.subtract(i,t[0],t[2]),n[0]=e[1]*i[2]-e[2]*i[1],n[1]=e[2]*i[0]-e[0]*i[2],n[2]=e[0]*i[1]-e[1]*i[0],vec3.normalize(n,n),n}this.faceVertCount=3,this.vertices=[],this.verticesIndices=[],this.texCoords=[],this.texCoordsIndices=[],this.vertexNormals=[],this.morphTargets=[],this.getVertexVec=function(t){var e=[0,0,0];return e[0]=this.vertices[3*t+0],e[1]=this.vertices[3*t+1],e[2]=this.vertices[3*t+2],e},this.calcNormals=function(e){var i=0;for(console.log("calcNormals"),this.vertexNormals.length=this.vertices.length,i=0;i<this.vertices.length;i++)this.vertexNormals[i]=0;var n=[];for(n.length=this.verticesIndices.length/3,i=0;i<this.verticesIndices.length;i+=3){var s=[this.getVertexVec(this.verticesIndices[i+0]),this.getVertexVec(this.verticesIndices[i+1]),this.getVertexVec(this.verticesIndices[i+2])];n[i/3]=t(s),e||(this.vertexNormals[3*this.verticesIndices[i+0]+0]=n[i/3][0],this.vertexNormals[3*this.verticesIndices[i+0]+1]=n[i/3][1],this.vertexNormals[3*this.verticesIndices[i+0]+2]=n[i/3][2],this.vertexNormals[3*this.verticesIndices[i+1]+0]=n[i/3][0],this.vertexNormals[3*this.verticesIndices[i+1]+1]=n[i/3][1],this.vertexNormals[3*this.verticesIndices[i+1]+2]=n[i/3][2],this.vertexNormals[3*this.verticesIndices[i+2]+0]=n[i/3][0],this.vertexNormals[3*this.verticesIndices[i+2]+1]=n[i/3][1],this.vertexNormals[3*this.verticesIndices[i+2]+2]=n[i/3][2])}if(console.log("this.vertices",this.vertices.length),console.log("this.vertexNormals",this.vertexNormals.length),e)for(console.log("calc vertexnormals"),i=0;i<this.verticesIndices.length;i+=3)for(var r=0;3>r;r++){var o=[this.vertexNormals[3*this.verticesIndices[i+r]+0]+n[i/3][0],this.vertexNormals[3*this.verticesIndices[i+r]+1]+n[i/3][1],this.vertexNormals[3*this.verticesIndices[i+r]+2]+n[i/3][2]];vec3.normalize(o,o),this.vertexNormals[3*this.verticesIndices[i+r]+0]=o[0],this.vertexNormals[3*this.verticesIndices[i+r]+1]=o[1],this.vertexNormals[3*this.verticesIndices[i+r]+2]=o[2]}},this.clear=function(){this.vertices.length=0,this.verticesIndices.length=0,this.texCoords.length=0,this.texCoordsIndices.length=0,this.vertexNormals.length=0},this.addFace=function(t,e,i){for(var n=[-1,-1,-1],s=0;s<this.vertices;s+=3)this.vertices[s+0]==t[0]&&this.vertices[s+1]==t[1]&&this.vertices[s+2]==t[2]&&(n[0]=s/3),this.vertices[s+0]==e[0]&&this.vertices[s+1]==e[1]&&this.vertices[s+2]==e[2]&&(n[1]=s/3),this.vertices[s+0]==i[0]&&this.vertices[s+1]==i[1]&&this.vertices[s+2]==i[2]&&(n[2]=s/3);-1==n[0]&&(this.vertices.push(t[0],t[1],t[2]),n[0]=(this.vertices.length-1)/3),-1==n[1]&&(this.vertices.push(e[0],e[1],e[2]),n[1]=(this.vertices.length-1)/3),-1==n[2]&&(this.vertices.push(i[0],i[1],i[2]),n[2]=(this.vertices.length-1)/3),this.verticesIndices.push(parseInt(n[0],10)),this.verticesIndices.push(parseInt(n[1],10)),this.verticesIndices.push(parseInt(n[2],10)),this.faceVertCount=this.verticesIndices.length}},parseOBJ=function(t){_readline=function(t,e){for(var i="";10!=t[e];)i+=String.fromCharCode(t[e++]);return i};var e=new CGL.Geometry;e.groups={},e.vertexNormals=[],e.vertexNormalIndices=[];for(var i={from:0,to:0},n=0,s=new Uint8Array(t),r=0,o=0,a=0;n<s.length;){var h=_readline(s,n);n+=h.length+1,h=h.replace(/ +(?= )/g,""),h=h.replace(/(^\s+|\s+$)/g,"");var l=h.split(" ");if("g"==l[0]&&(i.to=e.verticesIndices.length,e.groups[l[1]]||(e.groups[l[1]]={from:e.verticesIndices.length,to:0}),i=e.groups[l[1]]),"v"==l[0]&&(r=parseFloat(l[1]),o=parseFloat(l[2]),a=parseFloat(l[3]),e.vertices.push(r,o,a)),"vt"==l[0]&&(r=parseFloat(l[1]),o=1-parseFloat(l[2]),e.texCoords.push(r,o)),"vn"==l[0]&&(r=parseFloat(l[1]),o=parseFloat(l[2]),a=parseFloat(l[3]),e.vertexNormals.push(r,o,a)),"f"==l[0]){var u=l[1].split("/"),g=l[2].split("/"),c=l[3].split("/"),f=parseInt(u[0])-1,d=parseInt(g[0])-1,p=parseInt(c[0])-1,v=parseInt(u[1])-1,m=parseInt(g[1])-1,T=parseInt(c[1])-1,E=parseInt(u[2])-1,I=parseInt(g[2])-1,L=parseInt(c[2])-1,A=e.vertices.length/3,C=e.texCoords.length/2,x=e.vertexNormals.length/3;if(0>f&&(f=A+f+1),0>d&&(d=A+d+1),0>p&&(p=A+p+1),0>v&&(v=C+v+1),0>m&&(m=C+m+1),0>T&&(T=C+T+1),0>E&&(E=x+E+1),0>I&&(I=x+I+1),0>L&&(L=x+L+1),e.verticesIndices.push(f,d,p),e.texCoordsIndices.push(v,m,T),e.vertexNormalIndices.push(E,I,L),5==l.length){var _=l[4].split("/"),S=parseInt(_[0])-1,R=parseInt(_[1])-1,P=parseInt(_[2])-1;0>S&&(S=A+S+1),0>R&&(R=C+R+1),0>P&&(P=x+P+1),e.verticesIndices.push(f,p,S),e.texCoordsIndices.push(v,T,R),e.vertexNormalIndices.push(E,L,P)}}}return i.to=e.verticesIndices.length,e};var CGL=CGL||{};CGL.profileUniformCount=0,CGL.Uniform=function(t,e,i,n){var s=this,r=-1,o=i,a=e,h=1e-5,l=t;this.needsUpdate=!0,l.addUniform(this),this.getType=function(){return a},this.getName=function(){return o},this.getValue=function(){return h},this.resetLoc=function(){r=-1,s.needsUpdate=!0},this.updateValueF=function(){-1==r?r=l.getCgl().gl.getUniformLocation(l.getProgram(),o):s.needsUpdate=!1,l.getCgl().gl.uniform1f(r,h),CGL.profileUniformCount++},this.bindTextures=function(){},this.setValueF=function(t){t!=h&&(s.needsUpdate=!0,h=t)},this.updateValue4F=function(){-1==r&&(r=l.getCgl().gl.getUniformLocation(l.getProgram(),o)),l.getCgl().gl.uniform4f(r,h[0],h[1],h[2],h[3]),CGL.profileUniformCount++},this.setValue4F=function(t){s.needsUpdate=!0,h=t},this.updateValueT=function(){-1==r&&(r=l.getCgl().gl.getUniformLocation(l.getProgram(),o),-1==r&&console.log("texture loc unknown!!")),CGL.profileUniformCount++,l.getCgl().gl.uniform1i(r,h),s.needsUpdate=!1},this.setValueT=function(t){s.needsUpdate=!0,h=t},"f"==a&&(this.setValue=this.setValueF,this.updateValue=this.updateValueF),"4f"==a&&(this.setValue=this.setValue4F,this.updateValue=this.updateValue4F),"t"==a&&(this.setValue=this.setValueT,this.updateValue=this.updateValueT),this.setValue(n),s.needsUpdate=!0},CGL.Shader=function(t){if(!t)throw"shader constructed without cgl";var e=this,i=null,n=[],s=[],r=!0,o=t,a=null,h=null,l=null,u=-1;this.getCgl=function(){return o},this.define=function(t,e){e||(e="");for(var i=0;i<s.length;i++)if(s[i][0]==t)return s[i][1]=e,void(r=!0);s.push([t,e]),r=!0},this.removeDefine=function(t,e){for(var i=0;i<s.length;i++)if(s[i][0]==t)return s.splice(i,1),void(r=!0)},this.removeUniform=function(t){for(var e=0;e<n.length;e++)n[e].getName()==t&&n.splice(e,1);r=!0},this.addUniform=function(t){n.push(t),r=!0},this.getDefaultVertexShader=function(){return"".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"varying vec2 texCoord;".endl()+"varying vec3 norm;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   norm=attrVertNormal;".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);".endl()+"}"},this.getDefaultFragmentShader=function(){return"".endl()+"precision mediump float;".endl()+"varying vec3 norm;".endl()+"void main()".endl()+"{".endl()+"   gl_FragColor = vec4(0.5,0.5,0.5,1.0);".endl()+"}"},this.getErrorFragmentShader=function(){return"".endl()+"precision mediump float;".endl()+"varying vec3 norm;".endl()+"void main()".endl()+"{".endl()+"   gl_FragColor = vec4(1.0,0.0,0.0,1.0);".endl()+"}"},this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader(),this.setSource=function(t,e){this.srcVert=t,this.srcFrag=e},this.getAttrVertexPos=function(){return u},this.hasTextureUniforms=function(){for(var t=0;t<n.length;t++)if("t"==n[t].getType())return!0;return!1},this.compile=function(){var t="",o=0;for(o=0;o<s.length;o++)t+="#define "+s[o][0]+" "+s[o][1]+"".endl();e.hasTextureUniforms()&&(t+="#define HAS_TEXTURES".endl());var a=t+e.srcVert,l=t+e.srcFrag,u="",g="";for(o=0;o<c.length;o++){for(var d="",p="",v=0;v<f.length;v++)f[v].name==c[o]&&(d+=f[v].srcBodyVert||"",p+=f[v].srcBodyFrag||"",u+=f[v].srcHeadVert||"",g+=f[v].srcHeadFrag||"",d=d.replace(/{{mod}}/g,f[v].prefix),p=p.replace(/{{mod}}/g,f[v].prefix),u=u.replace(/{{mod}}/g,f[v].prefix),g=g.replace(/{{mod}}/g,f[v].prefix));a=a.replace("{{"+c[o]+"}}",d),l=l.replace("{{"+c[o]+"}}",p)}if(a=a.replace("{{MODULES_HEAD}}",u),l=l.replace("{{MODULES_HEAD}}",g),i)for(i=createProgram(a,l,i),h=null,o=0;o<n.length;o++)n[o].resetLoc();else i=createProgram(a,l,i);r=!1},this.bind=function(){if((!i||r)&&e.compile(),!h){u=o.gl.getAttribLocation(i,"vPosition"),a=o.gl.getUniformLocation(i,"projMatrix"),h=o.gl.getUniformLocation(i,"mvMatrix"),l=o.gl.getUniformLocation(i,"normalMatrix");for(var t=0;t<n.length;t++)n[t].needsUpdate=!0}o.currentProgram!=i&&(o.gl.useProgram(i),o.currentProgram=i);for(var t=0;t<n.length;t++)n[t].needsUpdate&&n[t].updateValue();if(o.gl.uniformMatrix4fv(a,!1,o.pMatrix),o.gl.uniformMatrix4fv(h,!1,o.mvMatrix),l){var s=mat4.create();mat4.invert(s,o.mvMatrix),mat4.transpose(s,s),o.gl.uniformMatrix4fv(l,!1,s)}},this.getProgram=function(){return i};var g=function(t,i,n){function s(t){var e=[],i=t.split("\n");for(var n in i){var s=i[n].split(":");parseInt(s[2],10)&&e.push(parseInt(s[2],10))}return e}var r=n||o.gl.createShader(i);if(o.gl.shaderSource(r,t),o.gl.compileShader(r),!o.gl.getShaderParameter(r,o.gl.COMPILE_STATUS)){console.log("compile status: "),i==o.gl.VERTEX_SHADER&&console.log("VERTEX_SHADER"),i==o.gl.FRAGMENT_SHADER&&console.log("FRAGMENT_SHADER"),console.warn(o.gl.getShaderInfoLog(r));var a=o.gl.getShaderInfoLog(r),h=s(a),l='<div class="shaderErrorCode">',u=t.match(/^.*((\r\n|\n|\r)|$)/gm);for(var g in u){var c=parseInt(g,10)+1,f=c+": "+u[g];console.log(f);var d=!1;for(var p in h)h[p]==c&&(d=!0);d&&(l+='<span class="error">'),l+=f,d&&(l+="</span>")}console.warn(a),a=a.replace(/\n/g,"<br/>"),l=a+"<br/>"+l+"<br/><br/>",CABLES.UI.MODAL.showError("shader error",l),l+="</div>",e.setSource(e.getDefaultVertexShader(),e.getErrorFragmentShader())}return r};linkProgram=function(t){o.gl.linkProgram(t),o.gl.getProgramParameter(t,o.gl.LINK_STATUS)||e.setSource(e.getDefaultVertexShader(),e.getErrorFragmentShader())},createProgram=function(t,i){var n=o.gl.createProgram();return e.vshader=g(t,o.gl.VERTEX_SHADER),e.fshader=g(i,o.gl.FRAGMENT_SHADER),o.gl.attachShader(n,e.vshader),o.gl.attachShader(n,e.fshader),linkProgram(n),n};var c=[],f=[],d=0;this.removeModule=function(t){for(var e=0;e<f.length;e++)if(f[e].id==t.id){f.splice(e,1);break}r=!0},this.addModule=function(t){return t.id=generateUUID(),t.numId=d,t.prefix="mod"+d,f.push(t),r=!0,d++,t},this.setModules=function(t){c=t}};var CGL=CGL||{};CGL.State=function(){var t=this,e=[],i=[],n=[],s=[0,0,0,0];this.frameStore={},this.pMatrix=mat4.create(),this.mvMatrix=mat4.create(),this.canvas=null,mat4.identity(t.mvMatrix);var r=new CGL.Shader(this),o=r;this.setCanvas=function(t){this.canvas=document.getElementById(t),this.gl=this.canvas.getContext("experimental-webgl",{preserveDrawingBuffer:!0,antialias:!0}),this.canvasWidth=this.canvas.clientWidth,this.canvasHeight=this.canvas.clientHeight},this.canvasWidth=-1,this.canvasHeight=-1,this.wireframe=!1,this.points=!1,this.doScreenshot=!1,this.screenShotDataURL=null,this.getViewPort=function(){return s},this.resetViewPort=function(){this.gl.viewport(s[0],s[1],s[2],s[3])},this.setViewPort=function(t,e,i,n){s[0]=parseInt(t,10),s[1]=parseInt(e,10),s[2]=parseInt(i,10),s[3]=parseInt(n,10),this.gl.viewport(s[0],s[1],s[2],s[3])},this.beginFrame=function(){t.setShader(r)},this.endFrame=function(){t.setPreviousShader(),e.length>0&&console.warn("mvmatrix stack length !=0 at end of rendering..."),i.length>0&&console.warn("pmatrix stack length !=0 at end of rendering..."),n.length>0&&console.warn("shaderStack length !=0 at end of rendering..."),e.length=0,i.length=0,n.length=0,this.doScreenshot&&(console.log("do screenshot"),this.doScreenshot=!1,this.screenShotDataURL=document.getElementById("glcanvas").toDataURL("image/png"))},this.getShader=function(){return o},this.setShader=function(t){n.push(t),o=t},this.setPreviousShader=function(){if(0===n.length)throw"Invalid movelview popMatrix!";n.pop(),o=n[n.length-1]},this.pushMvMatrix=function(){var i=mat4.create();mat4.copy(i,t.mvMatrix),e.push(i)},this.popMvMatrix=function(){if(0===e.length)throw"Invalid movelview popMatrix!";t.mvMatrix=e.pop()},this.pushPMatrix=function(){var e=mat4.create();mat4.copy(e,t.pMatrix),i.push(e)},this.popPMatrix=function(){if(0===i.length)throw"Invalid projection popMatrix!";t.pMatrix=i.pop()}};var CGL=CGL||{};CGL.Texture=function(t,e){function i(t){return 1==t||2==t||4==t||8==t||16==t||32==t||64==t||128==t||256==t||512==t||1024==t||2048==t||4096==t||8192==t||16384==t}function n(){i(s.width)&&i(s.height)?(s.filter==CGL.Texture.FILTER_NEAREST&&(t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST)),s.filter==CGL.Texture.FILTER_LINEAR&&(t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.LINEAR),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MAG_FILTER,t.gl.LINEAR)),s.filter==CGL.Texture.FILTER_MIPMAP&&(t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MAG_FILTER,t.gl.LINEAR),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST_MIPMAP_LINEAR))):(t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE))}if(!t)throw"no cgl";var s=this;this.tex=t.gl.createTexture(),this.width=0,this.height=0,this.flip=!0,this.filter=CGL.Texture.FILTER_NEAREST;var r=!1;e&&e.isDepthTexture&&(r=e.isDepthTexture),this.isPowerOfTwo=function(){return i(this.width)&&i(this.width)},this.setSize=function(e,i){s.width=e,s.height=i,t.gl.bindTexture(t.gl.TEXTURE_2D,s.tex);var o=null;n(),r?t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.DEPTH_COMPONENT,e,i,0,t.gl.DEPTH_COMPONENT,t.gl.UNSIGNED_SHORT,null):t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.RGBA,e,i,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,o),t.gl.bindTexture(t.gl.TEXTURE_2D,null)},this.initTexture=function(e){s.width=e.width,s.height=e.height,t.gl.bindTexture(t.gl.TEXTURE_2D,s.tex),s.flip&&t.gl.pixelStorei(t.gl.UNPACK_FLIP_Y_WEBGL,!0),t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.RGBA,t.gl.RGBA,t.gl.UNSIGNED_BYTE,s.image),n(),i(s.width)&&i(s.height)&&s.filter==CGL.Texture.FILTER_MIPMAP&&t.gl.generateMipmap(t.gl.TEXTURE_2D),t.gl.bindTexture(t.gl.TEXTURE_2D,null)},this.setSize(8,8),this.preview=function(){CGL.Texture.previewTexture=s}},CGL.Texture.load=function(t,e,i,n){CGL.incrementLoadingAssets();var s=new CGL.Texture(t);return s.image=new Image,n&&n.hasOwnProperty("filter")&&(s.filter=n.filter),s.image.onload=function(){s.initTexture(s.image),i&&i(),CGL.decrementLoadingAssets()},s.image.src=e,s},CGL.Texture.fromImage=function(t,e){var i=new CGL.Texture(t);return i.flip=!0,i.image=e,i.initTexture(e),i},CGL.Texture.FILTER_NEAREST=0,CGL.Texture.FILTER_LINEAR=1,CGL.Texture.FILTER_MIPMAP=2,CGL.Texture.previewTexture=null,CGL.Texture.texturePreviewer=null,CGL.Texture.texturePreview=function(t){var e=2,i=new CGL.Geometry;i.vertices=[e/2,e/2,0,-e/2,e/2,0,e/2,-e/2,0,-e/2,-e/2,0],i.texCoords=[1,1,0,1,1,0,0,0],i.verticesIndices=[0,1,2,3,1,2];var n=new CGL.Mesh(t,i),s="".endl()+"precision highp float;".endl()+"varying vec2 texCoord;".endl()+"uniform sampler2D tex;".endl()+"uniform float time;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col;".endl()+"bool isEven = mod(time+texCoord.y+texCoord.x,0.2)>0.1;".endl()+"vec4 col1 = vec4(0.2,0.2,0.2,1.0);".endl()+"vec4 col2 = vec4(0.5,0.5,0.5,1.0);".endl()+"col = (isEven)? col1:col2;".endl()+"vec4 colTex = texture2D(tex,texCoord);;".endl()+"col = mix(col,colTex,colTex.a);".endl()+"   gl_FragColor = col;".endl()+"}",r=new CGL.Shader(t);r.setSource(r.getDefaultVertexShader(),s);var o=new CGL.Uniform(r,"f","time",0),a=(new CGL.Uniform(r,"t","tex",0),Date.now()/1e3);this.render=function(e){console.log("previewing ",e.width,e.height),t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),o.setValue(.1*(Date.now()/1e3-a)),t.setShader(r),e&&(t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,e.tex)),n.render(t.getShader()),t.setPreviousShader()}};var CGL=CGL||{};CGL.TextureEffect=function(t){var e=this,i=new CGL.Geometry;i.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],i.texCoords=[1,1,0,1,1,0,0,0],i.verticesIndices=[0,1,2,3,1,2];var n=new CGL.Mesh(t,i),s=null,r=new CGL.Texture(t),o=t.gl.createFramebuffer(),a=t.gl.createRenderbuffer(),h=!1;this.startEffect=function(){h=!1},this.setSourceTexture=function(e){null===e?(s=new CGL.Texture(t),s.setSize(16,16)):s=e,r.setSize(s.width,s.height),t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,o),t.gl.bindRenderbuffer(t.gl.RENDERBUFFER,a),t.gl.renderbufferStorage(t.gl.RENDERBUFFER,t.gl.DEPTH_COMPONENT16,s.width,s.height),t.gl.framebufferTexture2D(t.gl.FRAMEBUFFER,t.gl.COLOR_ATTACHMENT0,t.gl.TEXTURE_2D,r.tex,0),t.gl.framebufferRenderbuffer(t.gl.FRAMEBUFFER,t.gl.DEPTH_ATTACHMENT,t.gl.RENDERBUFFER,a),t.gl.bindTexture(t.gl.TEXTURE_2D,null),t.gl.bindRenderbuffer(t.gl.RENDERBUFFER,null),t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null)},this.getCurrentTargetTexture=function(){return h?s:r},this.getCurrentSourceTexture=function(){return h?r:s},this.bind=function(){return null===s?void console.log("no base texture set!"):(t.pushMvMatrix(),t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,o),t.gl.framebufferTexture2D(t.gl.FRAMEBUFFER,t.gl.COLOR_ATTACHMENT0,t.gl.TEXTURE_2D,e.getCurrentTargetTexture().tex,0),t.pushPMatrix(),t.gl.viewport(0,0,e.getCurrentTargetTexture().width,e.getCurrentTargetTexture().height),mat4.perspective(t.pMatrix,45,e.getCurrentTargetTexture().width/e.getCurrentTargetTexture().height,.01,1100),t.pushPMatrix(),mat4.identity(t.pMatrix),t.pushMvMatrix(),mat4.identity(t.mvMatrix),t.gl.clearColor(0,0,0,0),void t.gl.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT))},this.finish=function(){return null===s?void console.log("no base texture set!"):(n.render(t.getShader()),t.popPMatrix(),t.popMvMatrix(),t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.popPMatrix(),t.resetViewPort(),t.popMvMatrix(),void(h=!h))}};var PORT_DIR_IN=0,PORT_DIR_OUT=1,OP_PORT_TYPE_VALUE=0,OP_PORT_TYPE_FUNCTION=1,OP_PORT_TYPE_OBJECT=2,OP_PORT_TYPE_TEXTURE=2,OP_PORT_TYPE_ARRAY=3,OP_PORT_TYPE_DYNAMIC=4,Ops={},Op=function(t){this.objName="",this.portsOut=[],this.portsIn=[],this.posts=[],this.uiAttribs={},this.enabled=!0,this.patch=t,this.name="unknown",this.id=generateUUID(),this.onAddPort=null,this.onCreate=null,this.onResize=null,this.onLoaded=null,this.onDelete=null,this.onUiAttrChange=null,this.uiAttr=function(t){this.uiAttribs||(this.uiAttribs={});for(var e in t)this.uiAttribs[e]=t[e];this.onUiAttrChange&&this.onUiAttrChange()},this.getName=function(){return this.name},this.addOutPort=function(t){return t.direction=PORT_DIR_OUT,t.parent=this,this.portsOut.push(t),this.onAddPort&&this.onAddPort(t),t},this.hasPort=function(t){for(var e in this.portsIn)if(this.portsIn[e].getName()==t)return!0;return!1},this.addInPort=function(t){return t.direction=PORT_DIR_IN,t.parent=this,this.portsIn.push(t),this.onAddPort&&this.onAddPort(t),t},this.printInfo=function(){for(var t=0;t<this.portsIn.length;t++)console.log("in: "+this.portsIn[t].getName());for(var e in this.portsOut)console.log("out: "+this.portsOut[e].getName())},this.removeLinks=function(){for(var t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks();for(var e in this.portsOut)this.portsOut[e].removeLinks()},this.findFittingPort=function(t){for(var e in this.portsOut)if(Link.canLink(t,this.portsOut[e]))return this.portsOut[e];for(var i in this.portsIn)if(Link.canLink(t,this.portsIn[i]))return this.portsIn[i]},this.getSerialized=function(){var t={};t.name=this.getName(),t.objName=this.objName,t.id=this.id,t.uiAttribs=this.uiAttribs,t.portsIn=[],t.portsOut=[];for(var e=0;e<this.portsIn.length;e++)this.portsIn[e].type!=OP_PORT_TYPE_DYNAMIC&&t.portsIn.push(this.portsIn[e].getSerialized());for(var i in this.portsOut)this.portsOut[i].type!=OP_PORT_TYPE_DYNAMIC&&t.portsOut.push(this.portsOut[i].getSerialized());return t},this.getPortByName=function(t){for(var e in this.portsIn)if(this.portsIn[e].getName()==t)return this.portsIn[e];for(var i in this.portsOut)if(this.portsOut[i].getName()==t)return this.portsOut[i]},this.getPort=function(t){return this.getPortByName(t)},this.updateAnims=function(){for(var t=0;t<this.portsIn.length;t++)this.portsIn[t].updateAnim()}},Port=function(t,e,i,n){var s=this;this.direction=PORT_DIR_IN,this.id=generateUUID(),this.parent=t,this.links=[],this.value=0,this.name=e,this.type=i||OP_PORT_TYPE_VALUE,this.uiAttribs=n||{};var r=null;this.anim=null;var o=!1,a=-5711;this.onLink=null,this.showPreview=!1;var h=!0;this.ignoreValueSerialize=!1,this.onLinkChanged=null,this.doShowPreview=function(t){t!=s.showPreview&&(s.showPreview=t,s.onPreviewChanged())},this.onPreviewChanged=function(){},this.shouldLink=function(){return!0},this.get=function(){return this.value},this.set=function(t){this.setValue(t)},this.__defineGetter__("val",function(){return this.value}),this.__defineSetter__("val",function(t){this.setValue(t)}),this.getType=function(){return this.type},this.isLinked=function(){return this.links.length>0},this.onValueChanged=null,this.onTriggered=null,this._onTriggered=function(){t.updateAnims(),t.enabled&&s.onTriggered&&s.onTriggered()},this.setValue=function(e){if(t.enabled&&(e!=this.value||this.type==OP_PORT_TYPE_TEXTURE)){o?s.anim.setValue(t.patch.timer.getTime(),e):(this.value=e,this.onValueChanged&&this.onValueChanged());for(var i=0;i<this.links.length;++i)this.links[i].setValue()}},this.updateAnim=function(){o&&(this.value=s.anim.getValue(t.patch.timer.getTime()),a!=this.value&&(a=this.value,this.onValueChanged&&this.onValueChanged()),a=this.value)},this.isAnimated=function(){return o},this.getUiActiveState=function(){return h},this.setUiActiveState=function(t){h=t,this.onUiActiveStateChange&&this.onUiActiveStateChange()},this.onUiActiveStateChange=null,this.onAnimToggle=function(){},this._onAnimToggle=function(){this.onAnimToggle()},this.setAnimated=function(t){o!=t&&(o=t,o&&!s.anim&&(s.anim=new CABLES.TL.Anim),this._onAnimToggle())},this.toggleAnim=function(t){o=!o,o&&!s.anim&&(s.anim=new CABLES.TL.Anim),s.setAnimated(o),this._onAnimToggle()},this.getName=function(){return this.name},this.addLink=function(t){this.onLinkChanged&&this.onLinkChanged(),r=s.value,this.links.push(t)},this.removeLinkTo=function(t){for(var e in this.links)(this.links[e].portIn==t||this.links[e].portOut==t)&&this.links[e].remove()},this.isLinkedTo=function(t){for(var e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},this.trigger=function(){if(t.enabled&&0!==this.links.length)for(var e=0;e<this.links.length;++e)this.links[e].portIn._onTriggered()},this.call=function(){console.log("call deprecated - use trigger() "),this.trigger()},this.execute=function(){console.log("### execute port: "+this.getName(),this.goals.length)},this.getTypeString=function(){return this.type==OP_PORT_TYPE_VALUE?"value":this.type==OP_PORT_TYPE_FUNCTION?"function":this.type==OP_PORT_TYPE_TEXTURE?"texture":void 0},this.getSerialized=function(){var t={};if(t.name=this.getName(),this.ignoreValueSerialize?console.log("ja hier nicht speichern...."):t.value=this.value,o&&(t.animated=!0),this.anim&&(t.anim=this.anim.getSerialized()),this.direction==PORT_DIR_IN&&this.links.length>0){t.links=[];for(var e in this.links)t.links.push(this.links[e].getSerialized())}return t},this.removeLinks=function(){for(;this.links.length>0;)this.links[0].remove()},this.removeLink=function(t){this.onLinkChanged&&this.onLinkChanged();for(var e in this.links)this.links[e]==t&&this.links.splice(e,1);s.setValue(r)}},Link=function(t){this.portIn=null,this.portOut=null,this.scene=t,this.setValue=function(t){this.portIn.val=t},this.setValue=function(){this.portIn.get()!=this.portOut.get()&&this.portIn.set(this.portOut.get())},this.getOtherPort=function(t){return t==this.portIn?this.portOut:this.portIn},this.remove=function(){this.portIn.removeLink(this),this.portOut.removeLink(this),this.scene.onUnLink(this.portIn,this.portOut),this.portIn=null,this.portOut=null,this.scene=null},this.link=function(t,e){return Link.canLink(t,e)?(t.direction==PORT_DIR_IN?(this.portIn=t,this.portOut=e):(this.portIn=e,this.portOut=t),t.addLink(this),e.addLink(this),t.onLink&&t.onLink(this),e.onLink&&e.onLink(this),void this.setValue()):(console.log("cannot link ports!"),!1)},this.getSerialized=function(){var t={};return t.portIn=this.portIn.getName(),t.portOut=this.portOut.getName(),t.objIn=this.portIn.parent.id,t.objOut=this.portOut.parent.id,t}};Link.canLinkText=function(t,e){if(t.direction==e.direction){var i="(out)";return e.direction==PORT_DIR_IN&&(i="(in)"),"can not link: same direction"+i}return t.parent==e.parent?"can not link: same op":t.type!=OP_PORT_TYPE_DYNAMIC&&e.type!=OP_PORT_TYPE_DYNAMIC&&t.type!=e.type?"can not link: different type":t?e?t.direction==PORT_DIR_IN&&t.isAnimated()?"can not link: is animated":e.direction==PORT_DIR_IN&&e.isAnimated()?"can not link: is animated":t.direction==PORT_DIR_IN&&t.links.length>0?"input port already busy":e.direction==PORT_DIR_IN&&e.links.length>0?"input port already busy":t.isLinkedTo(e)?"ports already linked":"can link":"can not link: port 2 invalid":"can not link: port 1 invalid"},Link.canLink=function(t,e){return t.type==OP_PORT_TYPE_DYNAMIC||e.type==OP_PORT_TYPE_DYNAMIC?!0:t&&e?t.direction==PORT_DIR_IN&&t.isAnimated()?!1:e.direction==PORT_DIR_IN&&e.isAnimated()?!1:t.direction==PORT_DIR_IN&&t.links.length>0?!1:e.direction==PORT_DIR_IN&&e.links.length>0?!1:t.isLinkedTo(e)?!1:t.direction==e.direction?!1:t.type!=e.type?!1:t.parent==e.parent?!1:!0:!1};var Scene=function(t){var e=this;this.ops=[],this.settings={},this.timer=new Timer,this.animFrameOps=[],this.gui=!1,this.onLoadStart=null,this.onLoadEnd=null,this.config=t||{glCanvasId:"glcanvas",prefixAssetPath:""},this.cgl=new CGL.State,this.cgl.patch=this,this.cgl.setCanvas(this.config.glCanvasId),this.getFilePath=function(t){return this.config.prefixAssetPath+t},this.clear=function(){for(e.animFrameOps.length=0,this.timer=new Timer;this.ops.length>0;)this.deleteOp(this.ops[0].id)},this.addOp=function(t,e){var i=t.split("."),n=null;return 2==i.length?n=new window[i[0]][i[1]](this):3==i.length?n=new window[i[0]][i[1]][i[2]](this):4==i.length?n=new window[i[0]][i[1]][i[2]][i[3]](this):5==i.length?n=new window[i[0]][i[1]][i[2]][i[3]][i[4]](this):console.log("parts.length",i.length),n.objName=t,n.patch=this,n.uiAttr(e),n.onCreate&&n.onCreate(),n.hasOwnProperty("onAnimFrame")&&this.animFrameOps.push(n),this.ops.push(n),this.onAdd&&this.onAdd(n),n},this.removeOnAnimFrame=function(t){for(var e=0;e<this.animFrameOps.length;e++)this.animFrameOps.splice(e,1)},this.deleteOp=function(t,i){for(var n in this.ops)if(this.ops[n].id==t){var s=this.ops[n],r=null,o=null;s&&(i&&this.ops[n].portsIn.length>0&&this.ops[n].portsIn[0].isLinked()&&this.ops[n].portsOut.length>0&&this.ops[n].portsOut[0].isLinked()&&this.ops[n].portsIn[0].getType()==this.ops[n].portsOut[0].getType()&&(r=this.ops[n].portsIn[0].links[0].getOtherPort(this.ops[n].portsIn[0]),o=this.ops[n].portsOut[0].links[0].getOtherPort(this.ops[n].portsOut[0])),this.ops[n].removeLinks(),this.onDelete(this.ops[n]),this.ops[n].id=generateUUID(),this.ops[n].onDelete&&this.ops[n].onDelete(),this.ops.splice(n,1),null!==r&&null!==o&&e.link(r.parent,r.getName(),o.parent,o.getName()))}},this.exec=function(t){requestAnimationFrame(CGL.getLoadingStatus()>0&&CGL.getLoadingStatus()<1?e.exec:e.exec),e.timer.update();for(var i=e.timer.getTime(),n=0;n<e.animFrameOps.length;++n)e.animFrameOps[n].onAnimFrame(i)},this.link=function(t,e,i,n){
if(t&&i){var s=t.getPort(e),r=i.getPort(n);if(!s)return void console.warn("port not found! "+e);if(!r)return void console.warn("port not found! "+n);if(!s.shouldLink(s,r)||!r.shouldLink(s,r))return!1;if(Link.canLink(s,r)){var o=new Link(this);return o.link(s,r),this.onLink(s,r),o}console.log(Link.canLinkText(s,r))}},this.onAdd=function(t){},this.onDelete=function(t){},this.onLink=function(t,e){},this.onUnLink=function(t,e){},this.serialize=function(t){var e={};e.ops=[],e.settings=this.settings;for(var i in this.ops)e.ops.push(this.ops[i].getSerialized());return t?e:JSON.stringify(e)},this.getOpById=function(t){for(var e in this.ops)if(this.ops[e].id==t)return this.ops[e]},this.getSubPatchOp=function(t,i){for(var n in e.ops)if(e.ops[n].uiAttribs&&e.ops[n].uiAttribs.subPatch==t&&e.ops[n].objName==i)return e.ops[n];return!1},this.deSerialize=function(t){function e(t,e,n,s){var r=!1;r||i.link(i.getOpById(t),n,i.getOpById(e),s)}this.onLoadStart&&this.onLoadStart(),"string"==typeof t&&(t=JSON.parse(t));var i=this;this.settings=t.settings;for(var n in t.ops){var s=this.addOp(t.ops[n].objName,t.ops[n].uiAttribs);s.id=t.ops[n].id;for(var r in t.ops[n].portsIn){var o=t.ops[n].portsIn[r],a=s.getPort(o.name);if(a&&a.type!=OP_PORT_TYPE_TEXTURE&&(a.val=o.value),o.animated&&a.setAnimated(o.animated),o.anim){a.anim||(a.anim=new CABLES.TL.Anim),o.anim.loop&&(a.anim.loop=o.anim.loop);for(var h in o.anim.keys)a.anim.keys.push(new CABLES.TL.Key(o.anim.keys[h]))}}for(var l in t.ops[n].portsOut){var u=s.getPort(t.ops[n].portsOut[l].name);u&&u.type!=OP_PORT_TYPE_TEXTURE&&(u.val=t.ops[n].portsOut[l].value)}}for(n in t.ops)for(var g in t.ops[n].portsIn)for(var c in t.ops[n].portsIn[g].links)e(t.ops[n].portsIn[g].links[c].objIn,t.ops[n].portsIn[g].links[c].objOut,t.ops[n].portsIn[g].links[c].portIn,t.ops[n].portsIn[g].links[c].portOut);for(var f in this.ops)this.ops[f].id=generateUUID();this.onLoadEnd&&this.onLoadEnd()},this.exec()},CABLES=CABLES||{};CABLES.TL=CABLES.TL||{},CABLES.TL.EASING_LINEAR=0,CABLES.TL.EASING_ABSOLUTE=1,CABLES.TL.EASING_SMOOTHSTEP=2,CABLES.TL.EASING_SMOOTHERSTEP=3,CABLES.TL.EASING_BEZIER=4,CABLES.TL.EASING_CUBIC_IN=5,CABLES.TL.EASING_CUBIC_OUT=6,CABLES.TL.EASING_CUBIC_INOUT=7,CABLES.TL.EASING_EXPO_IN=8,CABLES.TL.EASING_EXPO_OUT=9,CABLES.TL.EASING_EXPO_INOUT=10,CABLES.TL.EASING_SIN_IN=11,CABLES.TL.EASING_SIN_OUT=12,CABLES.TL.EASING_SIN_INOUT=13,CABLES.TL.Key=function(t){function e(t,e,i){return parseFloat(e.value)+parseFloat(i.value-e.value)*t}this.time=0,this.value=0,this.ui={},this.onChange=null;var i=0;this.bezTime=.5,this.bezValue=0,this.bezTimeIn=-.5,this.bezValueIn=0;var n=null,s=!1,r=this;this.setBezierControlOut=function(t,e){this.bezTime=t,this.bezValue=e,s=!0,null!==this.onChange&&this.onChange()},this.setBezierControlIn=function(t,e){this.bezTimeIn=t,this.bezValueIn=e,s=!0,null!==this.onChange&&this.onChange()},this.setValue=function(t){this.value=t,s=!0,null!==this.onChange&&this.onChange()},this.set=function(t){t&&(t.e&&this.setEasing(t.e),t.b&&(this.bezTime=t.b[0],this.bezValue=t.b[1],this.bezTimeIn=t.b[2],this.bezValueIn=t.b[3],s=!0),t.hasOwnProperty("t")&&(this.time=t.t),t.hasOwnProperty("time")&&(this.time=t.time),t.hasOwnProperty("v")?this.value=t.v:t.hasOwnProperty("value")&&(this.value=t.value)),null!==this.onChange&&this.onChange()},this.getSerialized=function(){var t={};return t.t=this.time,t.v=this.value,t.e=i,i==CABLES.TL.EASING_BEZIER&&(t.b=[this.bezTime,this.bezValue,this.bezTimeIn,this.bezValueIn]),t},this.easeLinear=function(t,i){return e(t,this,i)},this.easeAbsolute=function(t,e){return this.value},this.easeExpoIn=function(t,i){return t=Math.pow(2,10*(t-1)),e(t,this,i)},this.easeExpoOut=function(t,i){return t=-Math.pow(2,-10*t)+1,e(t,this,i)},this.easeExpoInOut=function(t,i){return t*=2,1>t?t=.5*Math.pow(2,10*(t-1)):(t--,t=.5*(-Math.pow(2,-10*t)+2)),e(t,this,i)},this.easeSinIn=function(t,i){return t=-1*Math.cos(t*Math.PI/2)+1,e(t,this,i)},this.easeSinOut=function(t,i){return t=Math.sin(t*Math.PI/2),e(t,this,i)},this.easeSinInOut=function(t,i){return t=-.5*(Math.cos(Math.PI*t)-1),e(t,this,i)},this.easeCubicIn=function(t,i){return t=t*t*t,e(t,this,i)},this.easeCubicOut=function(t,i){return t--,t=t*t*t+1,e(t,this,i)},this.easeCubicInOut=function(t,i){return t*=2,1>t?t=.5*t*t*t:(t-=2,t=.5*(t*t*t+2)),e(t,this,i)},this.easeSmoothStep=function(t,i){var n=Math.max(0,Math.min(1,(t-0)/1));return t=n*n*(3-2*n),e(t,this,i)},this.easeSmootherStep=function(t,i){var n=Math.max(0,Math.min(1,(t-0)/1));return t=n*n*n*(n*(6*n-15)+10),e(t,this,i)},BezierB1=function(t){return t*t*t},BezierB2=function(t){return 3*t*t*(1-t)},BezierB3=function(t){return 3*t*(1-t)*(1-t)},BezierB4=function(t){return(1-t)*(1-t)*(1-t)},Bezier=function(t,e){var i=e.time,n=e.value,s=e.time+e.bezTimeIn,o=e.value-e.bezValueIn,a=r.time,h=r.value,l=r.time+r.bezTime,u=r.value-r.bezValue,g=i*BezierB1(t)+s*BezierB2(t)+a*BezierB3(t)+l*BezierB4(t),c=n*BezierB1(t)+o*BezierB2(t)+h*BezierB3(t)+u*BezierB4(t);return{x:g,y:c}},this.easeBezier=function(t,e){n||(n=new CABLES.TL.Anim,s=!0);var i=e.time-r.time;if(s){n.clear();for(var o=20,a=1/o,h=0;o>h;h++){{var l=Bezier(h*a,e);r.time+i/o*h}n.setValue(l.x,l.y)}s=!1}return n.getValue(r.time+t*i)},this.getEasing=function(){return i},this.setEasing=function(t){i=t,i==CABLES.TL.EASING_ABSOLUTE?this.ease=this.easeAbsolute:i==CABLES.TL.EASING_SMOOTHSTEP?this.ease=this.easeSmoothStep:i==CABLES.TL.EASING_SMOOTHERSTEP?this.ease=this.easeSmootherStep:i==CABLES.TL.EASING_CUBIC_IN?this.ease=this.easeCubicIn:i==CABLES.TL.EASING_CUBIC_OUT?this.ease=this.easeCubicOut:i==CABLES.TL.EASING_CUBIC_INOUT?this.ease=this.easeCubicInOut:i==CABLES.TL.EASING_EXPO_IN?this.ease=this.easeExpoIn:i==CABLES.TL.EASING_EXPO_OUT?this.ease=this.easeExpoOut:i==CABLES.TL.EASING_EXPO_INOUT?this.ease=this.easeExpoInOut:i==CABLES.TL.EASING_SIN_IN?this.ease=this.easeSinIn:i==CABLES.TL.EASING_SIN_OUT?this.ease=this.easeSinOut:i==CABLES.TL.EASING_SIN_INOUT?this.ease=this.easeSinInOut:i==CABLES.TL.EASING_BEZIER?(s=!0,this.ease=this.easeBezier):(i=CABLES.TL.EASING_LINEAR,this.ease=this.easeLinear)},this.setEasing(CABLES.TL.EASING_LINEAR),this.set(t)},CABLES.TL.Anim=function(t){this.keys=[],this.onChange=null,this.stayInTimeline=!1,this.loop=!1,this.defaultEasing=CABLES.TL.EASING_LINEAR,this.clear=function(){this.keys.length=0},this.sortKeys=function(){this.keys.sort(function(t,e){return parseFloat(t.time)-parseFloat(e.time)})},this.getKeyIndex=function(t){var e=0;for(var i in this.keys)if(t>=this.keys[i].time&&(e=i),this.keys[i].time>t)return e;return e},this.setValue=function(t,e){var i=!1;for(var n in this.keys)if(this.keys[n].time==t){i=this.keys[n],this.keys[n].setValue(e);break}i||(console.log("not found"),this.keys.push(new CABLES.TL.Key({time:t,value:e,e:this.defaultEasing}))),this.onChange&&this.onChange(),this.sortKeys()},this.getSerialized=function(){var t={};t.keys=[],t.loop=this.loop;for(var e in this.keys)t.keys.push(this.keys[e].getSerialized());return t},this.getKey=function(t){var e=this.getKeyIndex(t);return this.keys[e]},this.getValue=function(t){if(0===this.keys.length)return 0;if(t<this.keys[0].time)return this.keys[0].value;this.loop&&t>this.keys[this.keys.length-1].time&&(t=(t-this.keys[0].time)%(this.keys[this.keys.length-1].time-this.keys[0].time),t+=this.keys[0].time);var e=this.getKeyIndex(t);if(e>=this.keys.length-1)return this.keys[this.keys.length-1].value;var i=parseInt(e,10)+1,n=this.keys[e],s=this.keys[i];if(!s)return-1;var r=(t-n.time)/(s.time-n.time);return n.ease(r,s)},this.addKey=function(t){void 0===t.time?console.log("key time undefined, ignoreing!"):this.keys.push(t)}};var CABLES=CABLES||{};CABLES.Variable=function(){var t=null,e=[];this.onChanged=function(t){e.push(t)},this.getValue=function(){return t},this.setValue=function(e){t=e,i()};var i=function(){for(var t=0;t<e.length;t++)e[t]()}};
//# sourceMappingURL=cables.min.js.map