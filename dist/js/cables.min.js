function Mesh(t){this.render=function(t){t.setAttributeVertex(self.bufVertices.itemSize),t.bind(),gl.bindBuffer(gl.ARRAY_BUFFER,self.bufVertices),gl.drawArrays(gl.POINTS,0,self.bufVertices.numItems)},self.bufVertices=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,self.bufVertices),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.vertices),gl.STATIC_DRAW),self.bufVertices.itemSize=t.faceVertCount,self.bufVertices.numItems=t.vertices.length/t.faceVertCount}function Geometry(){this.faceVertCount=3,this.vertices=[],this.verticesIndices=[]}function Timer(){function t(){return s=(Date.now()-i)/1e3,s+r}var e=this,i=Date.now(),r=0,n=0,s=0,a=!0;this.update=function(){return a?void 0:n=t()},this.getTime=function(){return n},this.togglePlay=function(){a?e.play():e.pause()},this.setOffset=function(t){0>n+t?(i=Date.now(),r=0,n=0):(r+=t,n=s+r)},this.play=function(){i=Date.now(),a=!1},this.pause=function(){r=n,a=!0}}function generateUUID(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e}function ajaxRequest(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(t){e(t.target.response)},i.send()}parseOBJ=function(t){_readline=function(t,e){for(var i="";10!=t[e];)i+=String.fromCharCode(t[e++]);return i};var e=new Geometry;e.groups={},e.c_uvt=[],e.c_norms=[],e.i_verts=[],e.i_uvt=[],e.i_norms=[];for(var i={from:0,to:0},r=0,n=new Uint8Array(t);r<n.length;){var s=_readline(n,r);r+=s.length+1,s=s.replace(/ +(?= )/g,""),s=s.replace(/(^\s+|\s+$)/g,"");var a=s.split(" ");if("g"==a[0]&&(i.to=e.i_verts.length,null==e.groups[a[1]]&&(e.groups[a[1]]={from:e.i_verts.length,to:0}),i=e.groups[a[1]]),"v"==a[0]){var o=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);e.vertices.push(o,h,l)}if("vt"==a[0]){var o=parseFloat(a[1]),h=1-parseFloat(a[2]);e.c_uvt.push(o,h)}if("vn"==a[0]){var o=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);e.c_norms.push(o,h,l)}if("f"==a[0]){var u=a[1].split("/"),p=a[2].split("/"),d=a[3].split("/"),g=parseInt(u[0])-1,m=parseInt(p[0])-1,c=parseInt(d[0])-1,P=parseInt(u[1])-1,f=parseInt(p[1])-1,v=parseInt(d[1])-1,O=parseInt(u[2])-1,_=parseInt(p[2])-1,I=parseInt(d[2])-1,T=e.vertices.length/3,b=e.c_uvt.length/2,x=e.c_norms.length/3;if(0>g&&(g=T+g+1),0>m&&(m=T+m+1),0>c&&(c=T+c+1),0>P&&(P=b+P+1),0>f&&(f=b+f+1),0>v&&(v=b+v+1),0>O&&(O=x+O+1),0>_&&(_=x+_+1),0>I&&(I=x+I+1),e.i_verts.push(g,m,c),e.i_uvt.push(P,f,v),e.i_norms.push(O,_,I),5==a.length){var w=a[4].split("/"),R=parseInt(w[0])-1,C=parseInt(w[1])-1,y=parseInt(w[2])-1;0>R&&(R=T+R+1),0>C&&(C=b+C+1),0>y&&(y=x+y+1),e.i_verts.push(g,c,R),e.i_uvt.push(P,v,C),e.i_norms.push(O,I,y)}}}return i.to=e.i_verts.length,e};var glShader=function(){var t=-1;this.getDefaultVertexShader=function(){return"attribute vec3 vPosition;\nuniform mat4 projMatrix;\nuniform mat4 mvMatrix;\nvoid main()\n{\n   gl_PointSize=3.0;\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"},this.getDefaultFragmentShader=function(){return"precision mediump float;\nvoid main()\n{\n   gl_FragColor = vec4(0.5,0.5,0.5,1.0);\n}\n"},this.compile=function(e,i){t=glUtils.createProgram(e,i),console.log("compiled!")};var e=-1,i=-1,r=-1;this.setAttributeVertex=function(t){r=t},this.bind=function(){-1==t&&this.compile(this.getDefaultVertexShader(),this.getDefaultFragmentShader()),-1==i&&(t.vertexPosAttrib=GL.getAttribLocation(t,"vPosition"),e=gl.getUniformLocation(t,"projMatrix"),i=gl.getUniformLocation(t,"mvMatrix")),GL.useProgram(t),GL.enableVertexAttribArray(t.vertexPosAttrib),gl.uniformMatrix4fv(e,!1,pMatrix),gl.uniformMatrix4fv(i,!1,mvMatrix),gl.vertexAttribPointer(t.vertexPosAttrib,r,gl.FLOAT,!1,0,0)},this.getProgram=function(){return t}},glUtils={};glUtils.createShader=function(t,e){var i=gl.createShader(e);if(gl.shaderSource(i,t),gl.compileShader(i),!gl.getShaderParameter(i,gl.COMPILE_STATUS))throw console.log("compile status: "),e==gl.VERTEX_SHADER&&console.log("VERTEX_SHADER"),e==gl.FRAGMENT_SHADER&&console.log("FRAGMENT_SHADER"),gl.getShaderInfoLog(i);return i},glUtils.createProgram=function(t,e){var i=gl.createProgram(),r=glUtils.createShader(t,gl.VERTEX_SHADER),n=glUtils.createShader(e,gl.FRAGMENT_SHADER);if(gl.attachShader(i,r),gl.attachShader(i,n),gl.linkProgram(i),!gl.getProgramParameter(i,gl.LINK_STATUS))throw gl.getProgramInfoLog(i);return i};var PORT_DIR_IN=0,PORT_DIR_OUT=1,OP_PORT_TYPE_VALUE=0,OP_PORT_TYPE_FUNCTION=1,Ops={},Op=function(){this.objName="",this.portsOut=[],this.portsIn=[],this.posts=[],this.uiAttribs={},this.name="unknown",this.id=generateUUID(),this.getName=function(){return this.name},this.addOutPort=function(t){return t.direction=PORT_DIR_OUT,t.parent=this,this.portsOut.push(t),t},this.addInPort=function(t){return t.direction=PORT_DIR_IN,t.parent=this,this.portsIn.push(t),t},this.execute=function(){this.exec()},this.printInfo=function(){for(var t=0;t<this.portsIn.length;t++)console.log("in: "+this.portsIn[t].getName());for(var e in this.portsOut)console.log("out: "+this.portsOut[e].getName())},this.removeLinks=function(){for(var t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks();for(var e in this.portsOut)this.portsOut[e].removeLinks()},this.getPort=function(t){for(var e in this.portsIn)if(this.portsIn[e].getName()==t)return this.portsIn[e];for(var i in this.portsOut)if(this.portsOut[i].getName()==t)return this.portsOut[i]},this.getSerialized=function(){var t={};t.name=this.getName(),t.objName=this.objName,t.id=this.id,t.uiAttribs=this.uiAttribs,t.portsIn=[],t.portsOut=[];for(var e=0;e<this.portsIn.length;e++)t.portsIn.push(this.portsIn[e].getSerialized());for(var i in this.portsOut)t.portsOut.push(this.portsOut[i].getSerialized());return t},this.getPortByName=function(t){for(var e=0;e<this.portsIn.length;e++)if(this.portsIn[e].name==t)return this.portsIn[e];for(var i in this.portsOut)if(this.portsOut[i].name==t)return this.portsOut[i]}},Port=function(t,e,i){this.direction=PORT_DIR_IN,this.id=generateUUID(),this.parent=t,this.links=[],this.value=null,this.name=e,this.type=i||OP_PORT_TYPE_VALUE,this.__defineGetter__("val",function(){return this.value}),this.__defineSetter__("val",function(t){this.setValue(t)}),this.onValueChanged=function(){},this.onTriggered=function(){},this.setValue=function(t){if(t!=this.value){this.value=t,this.onValueChanged();for(var e in this.links)this.links[e].setValue()}},this.getName=function(){return this.name},this.addLink=function(t){this.links.push(t)},this.isLinkedTo=function(t){for(var e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},this.call=function(){for(var t in this.links)this.links[t].portIn!=this&&this.links[t].portIn.onTriggered(),this.links[t].portOut!=this&&this.links[t].portOut.onTriggered()},this.execute=function(){console.log("### execute port: "+this.getName(),this.goals.length)},this.getTypeString=function(){return this.type==OP_PORT_TYPE_VALUE?"value":this.type==OP_PORT_TYPE_FUNCTION?"function":void 0},this.getSerialized=function(){var t={};if(t.name=this.getName(),t.value=this.value,this.direction==PORT_DIR_IN&&this.links.length>0){t.links=[];for(var e in this.links)t.links.push(this.links[e].getSerialized())}return t},this.removeLinks=function(){for(;this.links.length>0;)this.links[0].remove()},this.removeLink=function(t){for(var e in this.links)this.links[e]==t&&this.links.splice(e,1)}},Link=function(t){this.portIn=null,this.portOut=null,this.scene=t,this.setValue=function(){this.portIn.val!=this.portOut.val&&(this.portIn.val=this.portOut.val)},this.remove=function(){this.portIn.removeLink(this),this.portOut.removeLink(this),this.scene.onUnLink(this.portIn,this.portOut),this.portIn=null,this.portOut=null,this.scene=null},this.link=function(t,e){return Link.canLink(t,e)?(t.direction==PORT_DIR_IN?(this.portIn=t,this.portOut=e):(this.portIn=e,this.portOut=t),t.addLink(this),e.addLink(this),void this.setValue()):(console.log("cannot link ports!"),!1)},this.getSerialized=function(){var t={};return t.portIn=this.portIn.getName(),t.portOut=this.portOut.getName(),t.objIn=this.portIn.parent.id,t.objOut=this.portOut.parent.id,t}};Link.canLinkText=function(t,e){return t.direction==PORT_DIR_IN&&t.links.length>0?"input port already busy":e.direction==PORT_DIR_IN&&e.links.length>0?"input port already busy":t.isLinkedTo(e)?"ports already linked":t?e?t.direction==e.direction?"can not link: same direction":t.type!=e.type?"can not link: different type":t.parent==e.parent?"can not link: same op":"can link":"can not link: port 2 invalid":"can not link: port 1 invalid"},Link.canLink=function(t,e){return t.direction==PORT_DIR_IN&&t.links.length>0?!1:e.direction==PORT_DIR_IN&&e.links.length>0?!1:t.isLinkedTo(e)?!1:t&&e?t.direction==e.direction?!1:t.type!=e.type?!1:t.parent==e.parent?!1:!0:!1};var Scene=function(){var self=this;this.ops=[],this.timer=new Timer,this.animFrameOps=[],this.clear=function(){for(this.timer=new Timer;this.ops.length>0;)this.deleteOp(this.ops[0].id)},this.addOp=function(objName,uiAttribs){var op=eval("new "+objName+"();");return op.objName=objName,op.uiAttribs=uiAttribs,op.hasOwnProperty("onAnimFrame")&&this.animFrameOps.push(op),this.ops.push(op),this.onAdd&&this.onAdd(op),op},this.deleteOp=function(t){for(var e in this.ops)this.ops[e].id==t&&(this.ops[e].removeLinks(),this.onDelete(this.ops[e]),this.ops.splice(e,1))},this.exec=function(){requestAnimationFrame(self.exec),self.timer.update();var t=self.timer.getTime();for(var e in self.animFrameOps)self.animFrameOps[e].onAnimFrame(t)},this.link=function(t,e,i,r){var n=t.getPort(e),s=i.getPort(r);if(Link.canLink(n,s)){var a=new Link(this);return a.link(n,s),this.onLink(n,s),a}console.log(Link.canLinkText(n,s))},this.onAdd=function(t){},this.onDelete=function(t){},this.onLink=function(t,e){},this.onUnLink=function(t,e){},this.serialize=function(){var t={};t.ops=[];for(var e in this.ops)t.ops.push(this.ops[e].getSerialized());return JSON.stringify(t)},this.getOpById=function(t){for(var e in this.ops)if(this.ops[e].id==t)return this.ops[e]},this.deSerialize=function(t){function e(t,e,r,n){var s=!1;s||i.link(i.getOpById(t),r,i.getOpById(e),n)}"string"==typeof t&&(t=JSON.parse(t));var i=this;for(var r in t.ops){var n=this.addOp(t.ops[r].objName,t.ops[r].uiAttribs);n.id=t.ops[r].id;for(var s in t.ops[r].portsIn){var a=n.getPortByName(t.ops[r].portsIn[s].name);a&&(a.val=t.ops[r].portsIn[s].value)}for(var o in t.ops[r].portsOut){var h=n.getPortByName(t.ops[r].portsOut[o].name);h&&(h.val=t.ops[r].portsOut[o].value)}}for(r in t.ops)for(var l in t.ops[r].portsIn)for(var u in t.ops[r].portsIn[l].links)e(t.ops[r].portsIn[l].links[u].objIn,t.ops[r].portsIn[l].links[u].objOut,t.ops[r].portsIn[l].links[u].portIn,t.ops[r].portsIn[l].links[u].portOut);for(var p in this.ops)this.ops[p].id=generateUUID()},this.exec()};Ops.Gl={};var GL=null,GL=null,mvMatrix=mat4.create(),pMatrix=mat4.create();Ops.Gl.Renderer=function(){Op.apply(this,arguments);var t=this,e=new glShader;this.name="WebGL Renderer",this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var i=vec3.create();vec3.set(i,0,0,-2),this.onAnimFrame=function(r){currentShader=e,GL.clearColor(0,0,0,1),GL.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT),gl.viewport(0,0,640,360),mat4.perspective(pMatrix,45,800/480,.01,1100),mat4.identity(mvMatrix),mat4.translate(mvMatrix,mvMatrix,i),GL.enable(GL.BLEND),GL.blendFunc(GL.SRC_ALPHA,GL.ONE_MINUS_SRC_ALPHA),t.trigger.call()},this.canvas=document.getElementById("glcanvas"),GL=this.canvas.getContext("experimental-webgl"),gl=this.canvas.getContext("experimental-webgl")},Ops.Gl.Renderer.prototype=new Op,Ops.Gl.ClearColor=function(){Op.apply(this,arguments);var t=this;this.name="ClearColor",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r")),this.g=this.addInPort(new Port(this,"g")),this.b=this.addInPort(new Port(this,"b")),this.render.onTriggered=function(){GL.clearColor(t.r.val,t.g.val,t.b.val,1),GL.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT),t.trigger.call()}},Ops.Gl.ClearColor.prototype=new Op;var currentShader=null;Ops.Gl.Meshes={},Ops.Gl.Meshes.Rectangle=function(){Op.apply(this,arguments);var t=this;this.name="rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){currentShader.setAttributeVertex(t.squareVertexPositionBuffer.itemSize),currentShader.bind(),gl.bindBuffer(gl.ARRAY_BUFFER,t.squareVertexPositionBuffer),gl.drawArrays(gl.TRIANGLE_STRIP,0,t.squareVertexPositionBuffer.numItems),t.trigger.call()},this.squareVertexPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.squareVertexPositionBuffer),this.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.vertices),gl.STATIC_DRAW),this.squareVertexPositionBuffer.itemSize=3,this.squareVertexPositionBuffer.numItems=4},Ops.Gl.Meshes.Rectangle.prototype=new Op,Ops.Gl.Meshes.ObjMesh=function(){Op.apply(this,arguments);var t=this;this.name="OBJ Mesh",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null,this.render.onTriggered=function(){t.mesh&&t.mesh.render(currentShader),t.trigger.call()},ajaxRequest("assets/43_ChinUpperRaise.obj",function(e){console.log(e);var i=parseOBJ(e);console.log(i),t.mesh=new Mesh(i)})},Ops.Gl.Meshes.ObjMesh.prototype=new Op,Ops.Gl.Meshes.Plotter=function(){function t(){gl.lineWidth(4),gl.bindBuffer(gl.ARRAY_BUFFER,e.buffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e.vertices),gl.STATIC_DRAW),e.buffer.itemSize=3,e.buffer.numItems=i}Op.apply(this,arguments);var e=this;this.name="Plotter",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.v=this.addInPort(new Port(this,"value")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){currentShader.setAttributeVertex(e.buffer.itemSize),currentShader.bind(),gl.bindBuffer(gl.ARRAY_BUFFER,e.buffer),gl.drawArrays(gl.LINE_STRIP,0,e.buffer.numItems),e.trigger.call()},this.buffer=gl.createBuffer();var i=50;this.vertices=[];for(var r=0;i>r;r++)this.vertices.push(1/i*r),this.vertices.push(Math.random()-.5),this.vertices.push(0);t(),this.v.onValueChanged=function(){e.vertices.splice(0,3),e.vertices.push(1),e.vertices.push(e.v.val),e.vertices.push(0);for(var r=0;3*i>r;r+=3)e.vertices[r]=1/i*r;t()}},Ops.Gl.Meshes.Plotter.prototype=new Op,Ops.Gl.Meshes.Triangle=function(){Op.apply(this,arguments);var t=this;this.name="Triangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){currentShader.setAttributeVertex(t.squareVertexPositionBuffer.itemSize),currentShader.bind(),gl.bindBuffer(gl.ARRAY_BUFFER,t.squareVertexPositionBuffer),gl.drawArrays(gl.TRIANGLE_STRIP,0,t.squareVertexPositionBuffer.numItems),t.trigger.call()},this.squareVertexPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.squareVertexPositionBuffer),this.vertices=[0,1,0,-1,-1,0,1,-1,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.vertices),gl.STATIC_DRAW),this.squareVertexPositionBuffer.itemSize=3,this.squareVertexPositionBuffer.numItems=3},Ops.Gl.Meshes.Triangle.prototype=new Op,Ops.Gl.Shader={},Ops.Gl.Shader.BasicMaterial=function(){Op.apply(this,arguments);var t=this;this.name="BasicMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){currentShader=i,t.trigger.call()};var e="precision mediump float;\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\n\nvoid main()\n{\n   gl_FragColor = vec4(r,g,b,a);\n}\n",i=new glShader;i.compile(i.getDefaultVertexShader(),e),this.doRender(),this.r=this.addInPort(new Port(this,"r")),this.r.onValueChanged=function(){i.bind(),t.r.uniLoc||(t.r.uniLoc=gl.getUniformLocation(i.getProgram(),"r")),gl.uniform1f(t.r.uniLoc,t.r.val)},this.g=this.addInPort(new Port(this,"g")),this.g.onValueChanged=function(){i.bind(),t.g.uniLoc||(t.g.uniLoc=gl.getUniformLocation(i.getProgram(),"g")),gl.uniform1f(t.g.uniLoc,t.g.val)},this.b=this.addInPort(new Port(this,"b")),this.b.onValueChanged=function(){i.bind(),t.b.uniLoc||(t.b.uniLoc=gl.getUniformLocation(i.getProgram(),"b")),gl.uniform1f(t.b.uniLoc,t.b.val)},this.a=this.addInPort(new Port(this,"a")),this.a.onValueChanged=function(){i.bind(),t.a.uniLoc||(t.a.uniLoc=gl.getUniformLocation(i.getProgram(),"a")),gl.uniform1f(t.a.uniLoc,t.a.val)},this.r.val=Math.random(),this.g.val=Math.random(),this.b.val=Math.random(),this.a.val=1,this.render.onTriggered=this.doRender},Ops.Gl.Shader.BasicMaterial.prototype=new Op,Ops.Gl.Shader.Schwurbel=function(){Op.apply(this,arguments);var t=this;this.name="Schwurbel",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.timer=this.addInPort(new Port(this,"time")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){currentShader=i,t.timer.uniLoc||(i.bind(),t.timer.uniLoc=gl.getUniformLocation(i.getProgram(),"time")),gl.uniform1f(t.timer.uniLoc,t.timer.val),t.trigger.call()};var e="precision mediump float;\nuniform float time;\n\nvoid main()\n{\nfloat c=sqrt(sin(time*0.02)*cos((time+gl_FragCoord.y)*0.02)+sin(time+gl_FragCoord.x*0.02)*sin(time+gl_FragCoord.y*0.02));\ngl_FragColor = vec4( c,c,c,1.0);\n}\n",i=new glShader;i.compile(i.getDefaultVertexShader(),e),this.doRender(),this.render.onTriggered=this.doRender},Ops.Gl.Shader.Schwurbel.prototype=new Op,Ops.Gl.Shader.Noise=function(){Op.apply(this,arguments);var t=this;this.name="Noise",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var e=-1,i=-1;this.doRender=function(){-1==e&&(i=Date.now(),n.bind(),e=gl.getUniformLocation(n.getProgram(),"time")),gl.uniform1f(e,(Date.now()-i)/1e3),currentShader=n,t.trigger.call()};var r="precision mediump float;\nuniform float time;\n\nfloat random(vec2 co)\n{\n   return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvoid main()\n{\n   float c=random(time*gl_FragCoord.xy);   gl_FragColor = vec4( c,c,c,1.0);\n}\n",n=new glShader;n.compile(n.getDefaultVertexShader(),r),this.doRender(),this.render.onTriggered=this.doRender},Ops.Gl.Shader.Noise.prototype=new Op,Ops.Gl.Cube=function(){Op.apply(this,arguments);var t=this;this.name="Cube",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){GL.bindBuffer(gl.ARRAY_BUFFER,this.cubeVerticesBuffer),GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,t.cubeVerticesIndexBuffer),GL.drawElements(GL.TRIANGLES,36,GL.UNSIGNED_SHORT,0)},this.cubeVerticesIndexBuffer=null,this.cubeVerticesBuffer=null,this.init=function(){var t=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];this.cubeVerticesBuffer=GL.createBuffer(),GL.bindBuffer(GL.ARRAY_BUFFER,this.cubeVerticesBuffer),GL.bufferData(GL.ARRAY_BUFFER,new Float32Array(t),GL.STATIC_DRAW),this.cubeVerticesIndexBuffer=GL.createBuffer(),GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.cubeVerticesIndexBuffer);var e=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];GL.bufferData(GL.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),GL.STATIC_DRAW)},this.init()},Ops.Gl.Cube.prototype=new Op,Ops.Gl.Matrix={},Ops.Gl.Matrix.Translate=function(){Op.apply(this,arguments);var t=this;this.name="translate",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"x")),this.y=this.addInPort(new Port(this,"y")),this.z=this.addInPort(new Port(this,"z")),this.x.val=0,this.y.val=0,this.z.val=0;var e=vec3.create();this.render.onTriggered=function(){vec3.set(e,t.x.val,t.y.val,t.z.val),mat4.translate(mvMatrix,mvMatrix,e),t.trigger.call()}},Ops.Gl.Matrix.Translate.prototype=new Op,Ops.Gl.Matrix.Transform=function(){Op.apply(this,arguments);var t=this,e=3.14159/180;this.name="transform",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.posX=this.addInPort(new Port(this,"posX")),this.posY=this.addInPort(new Port(this,"posY")),this.posZ=this.addInPort(new Port(this,"posZ")),this.scaleX=this.addInPort(new Port(this,"scaleX")),this.scaleY=this.addInPort(new Port(this,"scaleY")),this.scaleZ=this.addInPort(new Port(this,"scaleZ")),this.rotX=this.addInPort(new Port(this,"rotX")),this.rotY=this.addInPort(new Port(this,"rotY")),this.rotZ=this.addInPort(new Port(this,"rotZ"));var i=vec3.create(),r=vec3.create(),n=mat4.create(),s=mat4.create();mat4.identity(s);var a=!1,o=!1;this.render.onTriggered=function(){mat4.copy(n,mvMatrix),mat4.multiply(mvMatrix,mvMatrix,s),t.trigger.call(),mat4.copy(mvMatrix,n)};var h=function(){mat4.identity(s),o&&mat4.translate(s,s,i),0!==t.rotX.val&&mat4.rotateX(s,s,t.rotX.val*e),0!==t.rotY.val&&mat4.rotateY(s,s,t.rotY.val*e),0!==t.rotZ.val&&mat4.rotateZ(s,s,t.rotZ.val*e),a&&mat4.scale(s,s,r)};this.translateChanged=function(){o=!1,(0!==t.posX.val||0!==t.posY.val||0!==t.posZ.val)&&(o=!0),vec3.set(i,t.posX.val,t.posY.val,t.posZ.val),h()},this.scaleChanged=function(){a=!1,(0!==t.scaleX.val||0!==t.scaleY.val||0!==t.scaleZ.val)&&(a=!0),vec3.set(r,t.scaleX.val,t.scaleY.val,t.scaleZ.val),h()},this.rotChanged=function(){h()},this.rotX.onValueChanged=this.rotChanged,this.rotY.onValueChanged=this.rotChanged,this.rotZ.onValueChanged=this.rotChanged,this.scaleX.onValueChanged=this.scaleChanged,this.scaleY.onValueChanged=this.scaleChanged,this.scaleZ.onValueChanged=this.scaleChanged,this.posX.onValueChanged=this.translateChanged,this.posY.onValueChanged=this.translateChanged,this.posZ.onValueChanged=this.translateChanged,this.rotX.val=0,this.rotY.val=0,this.rotZ.val=0,this.scaleX.val=1,this.scaleY.val=1,this.scaleZ.val=1,this.posX.val=0,this.posY.val=0,this.posZ.val=0,h()},Ops.Gl.Matrix.Translate.prototype=new Op,Ops.Log=function(){Op.apply(this,arguments);var t=this;this.name="logger",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.input=this.addInPort(new Port(this,"input")),this.input.val="",this.exec=function(){console.log("[log] "+t.input.val)},this.exe.onTriggered=this.exec,this.input.onValueChanged=this.exec},Ops.Log.prototype=new Op,Ops.CallsPerSecond=function(){Op.apply(this,arguments);var t=this;this.name="CallsPerSecond",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.timeStart=0,this.cps=0,this.exe.onTriggered=function(){0===t.timeStart&&(t.timeStart=Date.now());var e=Date.now();e-t.timeStart>1e3&&(t.timeStart=Date.now(),console.log("cps: "+t.cps),t.cps=0),t.cps++}},Ops.CallsPerSecond.prototype=new Op,Ops.Value=function(){Op.apply(this,arguments);var t=this;this.name="Value",this.v=this.addInPort(new Port(this,"value")),this.result=this.addOutPort(new Port(this,"result")),this.exec=function(){t.result.val=t.v.val},this.v.onValueChanged=this.exec},Ops.Value.prototype=new Op,Ops.TimeLineTime=function(){Op.apply(this,arguments);this.name="TimeLineTime",this.theTime=this.addOutPort(new Port(this,"time")),this.onAnimFrame=function(t){this.theTime.val=t}},Ops.TimeLineTime.prototype=new Op,Ops.Repeat=function(){Op.apply(this,arguments);var t=this;this.name="Repeat",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.num.val=5,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.exe.onTriggered=function(){for(var e=0;e<t.num.value;e++)t.idx.val=e,t.trigger.call()}},Ops.Repeat.prototype=new Op,Ops.IfTrueThen=function(){Op.apply(this,arguments);var t=this;this.name="if true then",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.bool=this.addInPort(new Port(this,"boolean")),this.bool.val=!1,this.triggerThen=this.addOutPort(new Port(this,"then",OP_PORT_TYPE_FUNCTION)),this.triggerElse=this.addOutPort(new Port(this,"else",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){t.bool.val===!0?t.triggerThen.call():t.triggerElse.call()},this.bool.onValueChanged=function(){t.exe.onTriggered()}},Ops.IfTrueThen.prototype=new Op,Ops.Interval=function(){Op.apply(this,arguments),this.name="Interval",this.timeOutId=-1,this.interval=this.addInPort(new Port(this,"interval")),this.interval.val=1e3,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exec=function(){if(-1==this.timeOutId){var t=this;this.timeOutId=setTimeout(function(){t.timeOutId=-1,t.trigger.call(),t.exec()},this.interval.val)}},this.exec()},Ops.Interval.prototype=new Op,Ops.Anim={},Ops.Anim.SinusAnim=function(){Op.apply(this,arguments),this.name="SinusAnim",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var t=this;this.exe.onTriggered=function(){t.result.val=Math.sin(Date.now()/1e3)},this.exe.onTriggered()},Ops.Anim.SinusAnim.prototype=new Op,Ops.Anim.RelativeTime=function(){Op.apply(this,arguments),this.name="RelativeTime",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var t=this,e=Date.now()/1e3;this.exe.onTriggered=function(){t.result.val=Date.now()/1e3-e},this.exe.onTriggered()},Ops.Anim.RelativeTime.prototype=new Op,Ops.Input={},Ops.Input.GamePad=function(){Op.apply(this,arguments),this.name="GamePad",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.numPads=this.addOutPort(new Port(this,"numPads")),this.axis1=this.addOutPort(new Port(this,"axis1")),this.axis2=this.addOutPort(new Port(this,"axis2")),this.axis3=this.addOutPort(new Port(this,"axis3")),this.axis4=this.addOutPort(new Port(this,"axis4")),this.button0=this.addOutPort(new Port(this,"button0")),this.button1=this.addOutPort(new Port(this,"button1")),this.button2=this.addOutPort(new Port(this,"button2")),this.button3=this.addOutPort(new Port(this,"button3")),this.button4=this.addOutPort(new Port(this,"button4"));{var t=this;Date.now()/1e3}this.exe.onTriggered=function(){var e=navigator.getGamepads(),i=0;for(var r in e)e[r].axes&&(t.axis1.val=e[r].axes[0],t.axis2.val=e[r].axes[1],t.axis3.val=e[r].axes[2],t.axis4.val=e[r].axes[3],t.button0.val=e[r].buttons[0].pressed,t.button0.val=e[r].buttons[1].pressed,t.button2.val=e[r].buttons[2].pressed,t.button3.val=e[r].buttons[3].pressed,t.button4.val=e[r].buttons[4].pressed,i++);t.numPads.val=i},this.exe.onTriggered()},Ops.Input.GamePad.prototype=new Op,Ops.Math={},Ops.Math.Random=function(){var t=this;Op.apply(this,arguments),this.name="random",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result")),this.exe.onTriggered=function(){t.result.val=Math.random()},this.exe.onTriggered()},Ops.Math.Random.prototype=new Op,Ops.Math.MapRange=function(){Op.apply(this,arguments);var t=this;this.name="map value range",this.result=this.addOutPort(new Port(this,"result")),this.v=this.addInPort(new Port(this,"value")),this.old_min=this.addInPort(new Port(this,"old min")),this.old_max=this.addInPort(new Port(this,"old max")),this.new_min=this.addInPort(new Port(this,"new min")),this.new_max=this.addInPort(new Port(this,"new max")),this.exec=function(){if(t.v.val>t.old_max.val)return void(t.result.val=t.new_max.val);if(t.v.val<t.old_min.val)return void(t.result.val=t.new_min.val);var e=parseFloat(t.new_min.val),i=parseFloat(t.new_max.val),r=parseFloat(t.old_min.val),n=parseFloat(t.old_max.val),s=parseFloat(t.v.val),a=!1,o=Math.min(r,n),h=Math.max(r,n);o!=r&&(a=!0);var l=!1,u=Math.min(e,i),p=Math.max(e,i);u!=e&&(l=!0);var d=0;d=a?(h-s)*(p-u)/(h-o):(s-o)*(p-u)/(h-o),t.result.val=l?p-d:d+u},this.v.val=0,this.old_min.val=-1,this.old_max.val=1,this.new_min.val=0,this.new_max.val=1,this.v.onValueChanged=this.exec,this.old_min.onValueChanged=this.exec,this.old_max.onValueChanged=this.exec,this.new_min.onValueChanged=this.exec,this.new_max.onValueChanged=this.exec,this.exec()},Ops.Math.MapRange.prototype=new Op,Ops.Math.Abs=function(){Op.apply(this,arguments);var t=this;this.name="abs",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){t.result.val=Math.abs(t.number.val)}},Ops.Math.Abs.prototype=new Op,Ops.Math.Sin=function(){Op.apply(this,arguments);var t=this;this.name="Sinus",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){t.result.val=Math.sin(t.number.val)}},Ops.Math.Sin.prototype=new Op,Ops.Math.Sum=function(){Op.apply(this,arguments);var t=this;this.name="sum",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=parseFloat(t.number1.val)+parseFloat(t.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Sum.prototype=new Op,Ops.Math.Multiply=function(){Op.apply(this,arguments);var t=this;this.name="multiply",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val*t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Multiply.prototype=new Op,Ops.Math.Divide=function(){Op.apply(this,arguments);var t=this;this.name="Divide",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val/t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Divide.prototype=new Op,Ops.Math.Compare={},Ops.Math.Compare.IsEven=function(){Op.apply(this,arguments);var t=this;this.name="isEven",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.exec=function(){t.result.val=!(1&t.number1.val)},this.number1.onValueChanged=this.exec},Ops.Math.Compare.IsEven.prototype=new Op,Ops.Math.Compare.Greater=function(){Op.apply(this,arguments);var t=this;this.name="Greater",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val>t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Greater.prototype=new Op,Ops.Math.Compare.Between=function(){Op.apply(this,arguments);var t=this;this.name="Between",this.result=this.addOutPort(new Port(this,"result")),this.number=this.addInPort(new Port(this,"value")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.number.val=2,this.number1.val=1,this.number2.val=3,this.exec=function(){t.result.val=t.number.val>Math.min(t.number1.val,t.number2.val)&&t.number.val<Math.max(t.number1.val,t.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number.onValueChanged=this.exec},Ops.Math.Compare.Between.prototype=new Op,
Ops.Math.Compare.Lesser=function(){Op.apply(this,arguments);var t=this;this.name="Lesser",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val<t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Lesser.prototype=new Op,Ops.Math.Compare.Equals=function(){Op.apply(this,arguments);var t=this;this.name="Equals",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val==t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Equals.prototype=new Op;
//# sourceMappingURL=cables.min.js.map