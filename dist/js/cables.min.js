function Timer(){function t(){return s=(Date.now()-i)/1e3,s+r}var e=this,i=Date.now(),r=0,n=0,s=0,a=!0;this.update=function(){return a?void 0:n=t()},this.getTime=function(){return n},this.togglePlay=function(){a?e.play():e.pause()},this.setOffset=function(t){0>n+t?(i=Date.now(),r=0,n=0):(r+=t,n=s+r)},this.play=function(){i=Date.now(),a=!1},this.pause=function(){r=n,a=!0}}function generateUUID(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e}function ajaxRequest(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(t){e(t.target.response)},i.send()}var CGL=CGL||{DEG2RAD:3.14159/180};CGL.Mesh=function(t){var e=-1,i=gl.createBuffer(),r=gl.createBuffer();this.setGeom=function(t){gl.bindBuffer(gl.ARRAY_BUFFER,i),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.vertices),gl.STATIC_DRAW),i.itemSize=3,i.numItems=t.vertices.length/3,gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,r),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.verticesIndices),gl.STATIC_DRAW),r.itemSize=1,r.numItems=t.verticesIndices.length,t.texCoords.length>0&&(-1==e&&(e=gl.createBuffer()),gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t.texCoords),gl.STATIC_DRAW),e.itemSize=2,e.numItems=t.texCoords.length/e.itemSize)},this.setGeom(t),this.render=function(t){t.bind(),GL.enableVertexAttribArray(t.getAttrVertexPos()),-1!=e&&GL.enableVertexAttribArray(t.getAttrTexCoords()),gl.bindBuffer(gl.ARRAY_BUFFER,i),gl.vertexAttribPointer(t.getAttrVertexPos(),i.itemSize,gl.FLOAT,!1,0,0),-1!=e&&(gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.vertexAttribPointer(t.getAttrTexCoords(),e.itemSize,gl.FLOAT,!1,0,0)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,r),gl.drawElements(gl.TRIANGLES,r.numItems,gl.UNSIGNED_SHORT,0)}},CGL.Geometry=function(){this.faceVertCount=3,this.vertices=[],this.verticesIndices=[],this.texCoords=[],this.texCoordsIndices=[],this.clear=function(){this.vertices.length=0,this.verticesIndices.length=0,this.texCoords.length=0,this.texCoordsIndices.length=0},this.addFace=function(t,e,i){for(var r=[-1,-1,-1],n=0;n<this.vertices;n+=3)this.vertices[n+0]==t[0]&&this.vertices[n+1]==t[1]&&this.vertices[n+2]==t[2]&&(r[0]=n/3),this.vertices[n+0]==e[0]&&this.vertices[n+1]==e[1]&&this.vertices[n+2]==e[2]&&(r[1]=n/3),this.vertices[n+0]==i[0]&&this.vertices[n+1]==i[1]&&this.vertices[n+2]==i[2]&&(r[2]=n/3);-1==r[0]&&(this.vertices.push(t[0],t[1],t[2]),r[0]=(this.vertices.length-1)/3),-1==r[1]&&(this.vertices.push(e[0],e[1],e[2]),r[1]=(this.vertices.length-1)/3),-1==r[2]&&(this.vertices.push(i[0],i[1],i[2]),r[2]=(this.vertices.length-1)/3),this.verticesIndices.push(r[0]),this.verticesIndices.push(r[1]),this.verticesIndices.push(r[2])}},parseOBJ=function(t){_readline=function(t,e){for(var i="";10!=t[e];)i+=String.fromCharCode(t[e++]);return i};var e=new CGL.Geometry;e.groups={},e.c_norms=[],e.i_norms=[];for(var i={from:0,to:0},r=0,n=new Uint8Array(t);r<n.length;){var s=_readline(n,r);r+=s.length+1,s=s.replace(/ +(?= )/g,""),s=s.replace(/(^\s+|\s+$)/g,"");var a=s.split(" ");if("g"==a[0]&&(i.to=e.verticesIndices.length,null==e.groups[a[1]]&&(e.groups[a[1]]={from:e.verticesIndices.length,to:0}),i=e.groups[a[1]]),"v"==a[0]){var o=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);e.vertices.push(o,h,l)}if("vt"==a[0]){var o=parseFloat(a[1]),h=1-parseFloat(a[2]);e.texCoords.push(o,h)}if("vn"==a[0]){var o=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);e.c_norms.push(o,h,l)}if("f"==a[0]){var u=a[1].split("/"),d=a[2].split("/"),p=a[3].split("/"),g=parseInt(u[0])-1,c=parseInt(d[0])-1,m=parseInt(p[0])-1,v=parseInt(u[1])-1,P=parseInt(d[1])-1,O=parseInt(p[1])-1,f=parseInt(u[2])-1,T=parseInt(d[2])-1,x=parseInt(p[2])-1,_=e.vertices.length/3,I=e.texCoords.length/2,w=e.c_norms.length/3;if(0>g&&(g=_+g+1),0>c&&(c=_+c+1),0>m&&(m=_+m+1),0>v&&(v=I+v+1),0>P&&(P=I+P+1),0>O&&(O=I+O+1),0>f&&(f=w+f+1),0>T&&(T=w+T+1),0>x&&(x=w+x+1),e.verticesIndices.push(g,c,m),e.texCoordsIndices.push(v,P,O),e.i_norms.push(f,T,x),5==a.length){var R=a[4].split("/"),E=parseInt(R[0])-1,C=parseInt(R[1])-1,b=parseInt(R[2])-1;0>E&&(E=_+E+1),0>C&&(C=I+C+1),0>b&&(b=w+b+1),e.verticesIndices.push(g,m,E),e.texCoordsIndices.push(v,O,C),e.i_norms.push(f,x,b)}}}return i.to=e.verticesIndices.length,e};var CGL=CGL||{};CGL.Uniform=function(t,e,i,r){var n=this,s=-1,a=i,o=e,h=0,l=t;this.needsUpdate=!0,l.addUniform(this),this.getType=function(){return o},this.getName=function(){return a},this.resetLoc=function(){s=-1},this.updateValueF=function(){-1==s&&(s=gl.getUniformLocation(l.getProgram(),a)),gl.uniform1f(s,h)},this.setValueF=function(t){n.needsUpdate=!0,h=t},this.updateValueT=function(){-1==s&&(s=gl.getUniformLocation(l.getProgram(),a),-1==s&&console.log("texture loc unknown!!")),gl.uniform1i(s,0)},this.setValueT=function(t){n.needsUpdate=!0,h=t},"f"==o&&(this.setValue=this.setValueF,this.updateValue=this.updateValueF),"t"==o&&(this.setValue=this.setValueT,this.updateValue=this.updateValueT),this.setValue(r)},CGL.Shader=function(){var t=this,e=!1,i=[],r=!0;this.removeUniform=function(t){console.log("before: "+i.length);for(var e in i)if(i[e].getName()==t){i.splice(e,1);break}r=!0,console.log(i.length)},this.addUniform=function(t){i.push(t),r=!0},this.getDefaultVertexShader=function(){return"attribute vec3 vPosition;\nattribute vec2 attrTexCoord;\nvarying vec2 texCoord;\nuniform mat4 projMatrix;\nuniform mat4 mvMatrix;\nvoid main()\n{\n   texCoord=attrTexCoord;\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"},this.getDefaultFragmentShader=function(){return"precision mediump float;\nvoid main()\n{\n   gl_FragColor = vec4(0.5,0.5,0.5,1.0);\n}\n"},this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader(),this.setSource=function(t,e){this.srcVert=t,this.srcFrag=e};var n=-1,s=-1,a=-1,o=-1;this.getAttrTexCoords=function(){return a},this.getAttrVertexPos=function(){return o},this.hasTextureUniforms=function(){for(var t in i)if("t"==i[t].getType())return!0;return!1},this.compile=function(){var n="";t.hasTextureUniforms()&&(n+="#define HAS_TEXTURES".endl()),console.log("shader compile..."),console.log("has textures: "+t.hasTextureUniforms());var a=n+t.srcVert,o=n+t.srcFrag;if(e){console.log("recompile shaders..."),t.vshader=createShader(a,gl.VERTEX_SHADER,t.vshader),t.fshader=createShader(o,gl.VERTEX_SHADER,t.fshader),linkProgram(e),s=-1;for(var h in i)i[h].resetLoc()}else console.log("create shaderprogram"),e=createProgram(a,o,e);r=!1},this.bind=function(){(!e||r)&&t.compile(),-1==s&&(a=gl.getAttribLocation(e,"attrTexCoord"),o=gl.getAttribLocation(e,"vPosition"),n=gl.getUniformLocation(e,"projMatrix"),s=gl.getUniformLocation(e,"mvMatrix")),GL.useProgram(e);for(var h in i)i[h].needsUpdate&&i[h].updateValue();gl.uniformMatrix4fv(n,!1,cgl.pMatrix),gl.uniformMatrix4fv(s,!1,cgl.mvMatrix)},this.getProgram=function(){return e},createShader=function(t,e,i){var r=i||gl.createShader(e);if(gl.shaderSource(r,t),gl.compileShader(r),!gl.getShaderParameter(r,gl.COMPILE_STATUS))throw console.log("compile status: "),e==gl.VERTEX_SHADER&&console.log("VERTEX_SHADER"),e==gl.FRAGMENT_SHADER&&console.log("FRAGMENT_SHADER"),gl.getShaderInfoLog(r);return r},linkProgram=function(t){if(gl.linkProgram(t),!gl.getProgramParameter(t,gl.LINK_STATUS))throw gl.getProgramInfoLog(t)},createProgram=function(e,i){var r=gl.createProgram();return t.vshader=createShader(e,gl.VERTEX_SHADER),t.fshader=createShader(i,gl.FRAGMENT_SHADER),gl.attachShader(r,t.vshader),gl.attachShader(r,t.fshader),linkProgram(r),r}};var CGL=CGL||{};CGL.State=function(){var t=this,e=[],i=[],r=[];this.pMatrix=mat4.create(),this.mvMatrix=mat4.create(),mat4.identity(t.mvMatrix);var n=new CGL.Shader,s=n;this.canvasWidth=640,this.canvasHeight=360,this.beginFrame=function(){t.pushShader(n)},this.endFrame=function(){t.popShader(),e.length>0&&console.warn("mvmatrix stack length !=0 at end of rendering..."),i.length>0&&console.warn("pmatrix stack length !=0 at end of rendering..."),r.length>0&&console.warn("shaderStack length !=0 at end of rendering...")},this.getShader=function(){return s},this.pushShader=function(t){r.push(t),s=t},this.popShader=function(){if(0===r.length)throw"Invalid movelview popMatrix!";s=r.pop()},this.pushMvMatrix=function(){var i=mat4.create();mat4.copy(i,t.mvMatrix),e.push(i)},this.popMvMatrix=function(){if(0===e.length)throw"Invalid movelview popMatrix!";t.mvMatrix=e.pop()},this.pushPMatrix=function(){var e=mat4.create();mat4.copy(e,t.pMatrix),i.push(e)},this.popPMatrix=function(){if(0===i.length)throw"Invalid projection popMatrix!";t.pMatrix=i.pop()}},cgl=new CGL.State;var CGL=CGL||{};CGL.Texture=function(){var t=this;this.tex=gl.createTexture(),this.bind=function(e){gl.activeTexture(gl.TEXTURE0+e),gl.bindTexture(gl.TEXTURE_2D,t.tex)},this.setSize=function(e,i){gl.bindTexture(gl.TEXTURE_2D,t.tex);for(var r=[],n=0;e>n;n++)for(var s=0;i>s;s++)r.push(parseInt(n/e*255,10)),r.push(0),r.push(parseInt(s/e*255,10)),r.push(255);var a=new Uint8Array(r);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,i,0,gl.RGBA,gl.UNSIGNED_BYTE,a),gl.bindTexture(gl.TEXTURE_2D,null)},this.initTexture=function(e){gl.bindTexture(gl.TEXTURE_2D,t.tex),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,t.image),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.bindTexture(gl.TEXTURE_2D,null)},this.setSize(8,8)},CGL.Texture.load=function(t){var e=new CGL.Texture;return e.image=new Image,e.image.onload=function(){console.log(e.image),e.initTexture(e.image)},e.image.src=t,e};var PORT_DIR_IN=0,PORT_DIR_OUT=1,OP_PORT_TYPE_VALUE=0,OP_PORT_TYPE_FUNCTION=1,OP_PORT_TYPE_TEXTURE=2,Ops={},Op=function(){this.objName="",this.portsOut=[],this.portsIn=[],this.posts=[],this.uiAttribs={},this.name="unknown",this.id=generateUUID(),this.getName=function(){return this.name},this.addOutPort=function(t){return t.direction=PORT_DIR_OUT,t.parent=this,this.portsOut.push(t),t},this.addInPort=function(t){return t.direction=PORT_DIR_IN,t.parent=this,this.portsIn.push(t),t},this.execute=function(){this.exec()},this.printInfo=function(){for(var t=0;t<this.portsIn.length;t++)console.log("in: "+this.portsIn[t].getName());for(var e in this.portsOut)console.log("out: "+this.portsOut[e].getName())},this.removeLinks=function(){for(var t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks();for(var e in this.portsOut)this.portsOut[e].removeLinks()},this.getPort=function(t){for(var e in this.portsIn)if(this.portsIn[e].getName()==t)return this.portsIn[e];for(var i in this.portsOut)if(this.portsOut[i].getName()==t)return this.portsOut[i]},this.findFittingPort=function(t){for(var e in this.portsOut)if(console.log("."),Link.canLink(t,this.portsOut[e]))return this.portsOut[e];for(var i in this.portsIn)if(console.log("."),Link.canLink(t,this.portsIn[i]))return this.portsIn[i]},this.getSerialized=function(){var t={};t.name=this.getName(),t.objName=this.objName,t.id=this.id,t.uiAttribs=this.uiAttribs,t.portsIn=[],t.portsOut=[];for(var e=0;e<this.portsIn.length;e++)t.portsIn.push(this.portsIn[e].getSerialized());for(var i in this.portsOut)t.portsOut.push(this.portsOut[i].getSerialized());return t},this.getPortByName=function(t){for(var e=0;e<this.portsIn.length;e++)if(this.portsIn[e].name==t)return this.portsIn[e];for(var i in this.portsOut)if(this.portsOut[i].name==t)return this.portsOut[i]}},Port=function(t,e,i){var r=this;this.direction=PORT_DIR_IN,this.id=generateUUID(),this.parent=t,this.links=[],this.value=null,this.name=e,this.type=i||OP_PORT_TYPE_VALUE;var n=null;this.__defineGetter__("val",function(){return this.value}),this.__defineSetter__("val",function(t){this.setValue(t)}),this.getType=function(){return this.type},this.isLinked=function(){return this.links.length>0},this.onValueChanged=function(){},this.onTriggered=function(){},this.setValue=function(t){if(t!=this.value){this.value=t,this.onValueChanged();for(var e in this.links)this.links[e].setValue()}},this.getName=function(){return this.name},this.addLink=function(t){n=r.value,this.links.push(t)},this.removeLinkTo=function(t){for(var e in this.links)(this.links[e].portIn==t||this.links[e].portOut==t)&&this.links[e].remove()},this.isLinkedTo=function(t){for(var e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},this.call=function(){for(var t in this.links)this.links[t].portIn!=this&&this.links[t].portIn.onTriggered(),this.links[t].portOut!=this&&this.links[t].portOut.onTriggered()},this.execute=function(){console.log("### execute port: "+this.getName(),this.goals.length)},this.getTypeString=function(){return this.type==OP_PORT_TYPE_VALUE?"value":this.type==OP_PORT_TYPE_FUNCTION?"function":this.type==OP_PORT_TYPE_TEXTURE?"texture":void 0},this.getSerialized=function(){var t={};if(t.name=this.getName(),t.value=this.value,this.direction==PORT_DIR_IN&&this.links.length>0){t.links=[];for(var e in this.links)t.links.push(this.links[e].getSerialized())}return t},this.removeLinks=function(){for(;this.links.length>0;)this.links[0].remove()},this.removeLink=function(t){for(var e in this.links)this.links[e]==t&&this.links.splice(e,1);r.setValue(n)}},Link=function(t){this.portIn=null,this.portOut=null,this.scene=t,this.setValue=function(){this.portIn.val!=this.portOut.val&&(this.portIn.val=this.portOut.val)},this.getOtherPort=function(t){return t==this.portIn?this.portOut:this.portIn},this.remove=function(){this.portIn.removeLink(this),this.portOut.removeLink(this),this.scene.onUnLink(this.portIn,this.portOut),this.portIn=null,this.portOut=null,this.scene=null},this.link=function(t,e){return Link.canLink(t,e)?(t.direction==PORT_DIR_IN?(this.portIn=t,this.portOut=e):(this.portIn=e,this.portOut=t),t.addLink(this),e.addLink(this),void this.setValue()):(console.log("cannot link ports!"),!1)},this.getSerialized=function(){var t={};return t.portIn=this.portIn.getName(),t.portOut=this.portOut.getName(),t.objIn=this.portIn.parent.id,t.objOut=this.portOut.parent.id,t}};Link.canLinkText=function(t,e){return t?e?t.direction==PORT_DIR_IN&&t.links.length>0?"input port already busy":e.direction==PORT_DIR_IN&&e.links.length>0?"input port already busy":t.isLinkedTo(e)?"ports already linked":t.direction==e.direction?"can not link: same direction":t.type!=e.type?"can not link: different type":t.parent==e.parent?"can not link: same op":"can link":"can not link: port 2 invalid":"can not link: port 1 invalid"},Link.canLink=function(t,e){return t&&e?t.direction==PORT_DIR_IN&&t.links.length>0?!1:e.direction==PORT_DIR_IN&&e.links.length>0?!1:t.isLinkedTo(e)?!1:t.direction==e.direction?!1:t.type!=e.type?!1:t.parent==e.parent?!1:!0:!1};var Scene=function(){var self=this;this.ops=[],this.timer=new Timer,this.animFrameOps=[],this.clear=function(){for(this.timer=new Timer;this.ops.length>0;)this.deleteOp(this.ops[0].id)},this.addOp=function(objName,uiAttribs){var op=eval("new "+objName+"();");return op.objName=objName,op.uiAttribs=uiAttribs,op.hasOwnProperty("onAnimFrame")&&this.animFrameOps.push(op),this.ops.push(op),this.onAdd&&this.onAdd(op),op},this.deleteOp=function(t,e){for(var i in this.ops)if(this.ops[i].id==t){var r=this.ops[i],n=null,s=null;r&&(e&&this.ops[i].portsIn[0].isLinked()&&this.ops[i].portsOut[0].isLinked()&&this.ops[i].portsIn[0].getType()==this.ops[i].portsOut[0].getType()&&(n=this.ops[i].portsIn[0].links[0].getOtherPort(this.ops[i].portsIn[0]),s=this.ops[i].portsOut[0].links[0].getOtherPort(this.ops[i].portsOut[0])),this.ops[i].removeLinks(),this.onDelete(this.ops[i]),this.ops.splice(i,1),null!==n&&null!==s&&self.link(n.parent,n.getName(),s.parent,s.getName()))}},this.exec=function(){requestAnimationFrame(self.exec),self.timer.update();var t=self.timer.getTime();for(var e in self.animFrameOps)self.animFrameOps[e].onAnimFrame(t)},this.link=function(t,e,i,r){var n=t.getPort(e),s=i.getPort(r);if(Link.canLink(n,s)){var a=new Link(this);return a.link(n,s),this.onLink(n,s),a}console.log(Link.canLinkText(n,s))},this.onAdd=function(t){},this.onDelete=function(t){},this.onLink=function(t,e){},this.onUnLink=function(t,e){},this.serialize=function(){var t={};t.ops=[];for(var e in this.ops)t.ops.push(this.ops[e].getSerialized());return JSON.stringify(t)},this.getOpById=function(t){for(var e in this.ops)if(this.ops[e].id==t)return this.ops[e]},this.deSerialize=function(t){function e(t,e,r,n){var s=!1;s||i.link(i.getOpById(t),r,i.getOpById(e),n)}"string"==typeof t&&(t=JSON.parse(t));var i=this;for(var r in t.ops){var n=this.addOp(t.ops[r].objName,t.ops[r].uiAttribs);n.id=t.ops[r].id;for(var s in t.ops[r].portsIn){var a=n.getPortByName(t.ops[r].portsIn[s].name);a&&a.type!=OP_PORT_TYPE_TEXTURE&&(a.val=t.ops[r].portsIn[s].value)}for(var o in t.ops[r].portsOut){var h=n.getPortByName(t.ops[r].portsOut[o].name);h&&h.type!=OP_PORT_TYPE_TEXTURE&&(h.val=t.ops[r].portsOut[o].value)}}for(r in t.ops)for(var l in t.ops[r].portsIn)for(var u in t.ops[r].portsIn[l].links)e(t.ops[r].portsIn[l].links[u].objIn,t.ops[r].portsIn[l].links[u].objOut,t.ops[r].portsIn[l].links[u].portIn,t.ops[r].portsIn[l].links[u].portOut);for(var d in this.ops)this.ops[d].id=generateUUID()},this.exec()};String.prototype.endl=function(){return this+"\n"},Ops.Gl=Ops.Gl||{};var GL=null;Ops.Gl.Renderer=function(){Op.apply(this,arguments);var t=this;this.name="render",this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var e=vec3.create();vec3.set(e,0,0,-2),this.onAnimFrame=function(i){cgl.canvasWidth=t.canvas.clientWidth,cgl.canvasHeight=t.canvas.clientHeight,gl.enable(gl.DEPTH_TEST),GL.clearColor(0,0,0,1),GL.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT),gl.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),mat4.perspective(cgl.pMatrix,45,cgl.canvasWidth/cgl.canvasHeight,.01,1100),cgl.pushPMatrix(),cgl.pushMvMatrix(),mat4.identity(cgl.mvMatrix),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,e),GL.enable(GL.BLEND),GL.blendFunc(GL.SRC_ALPHA,GL.ONE_MINUS_SRC_ALPHA),cgl.beginFrame(),t.trigger.call(),cgl.popMvMatrix(),cgl.popPMatrix(),cgl.endFrame()},this.canvas=document.getElementById("glcanvas"),GL=this.canvas.getContext("experimental-webgl"),gl=this.canvas.getContext("experimental-webgl")},Ops.Gl.Renderer.prototype=new Op,Ops.Gl.LeapMotion=function(){Op.apply(this,arguments);var t=this;this.name="LeapMotion",this.transX=this.addOutPort(new Port(this,"translationX")),this.transY=this.addOutPort(new Port(this,"translationY")),this.transZ=this.addOutPort(new Port(this,"translationZ")),this.finger0X=this.addOutPort(new Port(this,"finger0X")),this.finger0Y=this.addOutPort(new Port(this,"finger0Y")),this.finger0Z=this.addOutPort(new Port(this,"finger0Z")),Leap.loop(function(e){t.transX.val=e._translation[0],t.transY.val=e._translation[1],t.transZ.val=e._translation[2],e.fingers.length>0&&(t.finger0X.val=e.fingers[0].tipPosition[0],t.finger0Y.val=e.fingers[0].tipPosition[1],t.finger0Z.val=e.fingers[0].tipPosition[2])})},Ops.Gl.LeapMotion.prototype=new Op,Ops.Gl.ClearColor=function(){Op.apply(this,arguments);var t=this;this.name="ClearColor",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r")),this.g=this.addInPort(new Port(this,"g")),this.b=this.addInPort(new Port(this,"b")),this.r.val=.3,this.g.val=.3,this.b.val=.3,this.render.onTriggered=function(){GL.clearColor(t.r.val,t.g.val,t.b.val,1),GL.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT),t.trigger.call()}},Ops.Gl.ClearColor.prototype=new Op,Ops.Gl.ClearDepth=function(){Op.apply(this,arguments);var t=this;this.name="ClearDepth",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){GL.clear(GL.DEPTH_BUFFER_BIT),t.trigger.call()}},Ops.Gl.ClearDepth.prototype=new Op,Ops.Gl.TextureEmpty=function(){Op.apply(this,arguments);var t=this;this.name="texture empty",this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.tex=new CGL.Texture;var e=function(){t.tex.setSize(t.width.val,t.height.val),t.textureOut.val=t.tex.tex};this.width.onValueChanged=e,this.height.onValueChanged=e,this.width.val=8,this.height.val=8},Ops.Gl.TextureEmpty.prototype=new Op,Ops.Gl.Texture=function(){Op.apply(this,arguments);var t=this;this.name="texture",this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE)),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.filename.onValueChanged=function(){console.log("load texture..."),t.tex=CGL.Texture.load(t.filename.val),t.textureOut.val=t.tex.tex},this.filename.val="assets/skull.png"},Ops.Gl.Texture.prototype=new Op,Ops.Gl.Meshes={},Ops.Gl.Meshes.Rectangle=function(){Op.apply(this,arguments);var t=this;this.name="rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){t.mesh.render(cgl.getShader()),t.trigger.call()};var e=new CGL.Geometry;e.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],e.texCoords=[1,1,0,1,1,0,0,0],e.verticesIndices=[0,1,2,3,1,2],this.mesh=new CGL.Mesh(e)},Ops.Gl.Meshes.Rectangle.prototype=new Op,Ops.Gl.Meshes.FullscreenRectangle=function(){Op.apply(this,arguments);var t=this;this.name="fullscreen rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){cgl.pushPMatrix(),mat4.identity(cgl.pMatrix),cgl.pushMvMatrix(),mat4.identity(cgl.mvMatrix),t.mesh.render(cgl.getShader()),t.trigger.call(),cgl.popPMatrix(),cgl.popMvMatrix()};var e=new CGL.Geometry;e.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],e.texCoords=[1,1,0,1,1,0,0,0],e.verticesIndices=[0,1,2,3,1,2],this.mesh=new CGL.Mesh(e)},Ops.Gl.Meshes.FullscreenRectangle.prototype=new Op,Ops.Gl.Meshes.Circle=function(){function t(){i.clear();for(var t=0,n=0,s=0;s<=e.segments.val*e.percent.val;s++){var a=360/e.segments.val*s*CGL.DEG2RAD,o=Math.cos(a)*e.radius.val,h=Math.sin(a)*e.radius.val;i.addFace([o,h,0],[t,n,0],[0,0,0]),t=o,n=h}r.setGeom(i)}Op.apply(this,arguments);var e=this;this.name="Circle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.segments=this.addInPort(new Port(this,"segments")),this.radius=this.addInPort(new Port(this,"radius")),this.percent=this.addInPort(new Port(this,"percent")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){r.render(cgl.getShader()),e.trigger.call()},this.segments.val=20,this.radius.val=1,this.percent.val=1;var i=new CGL.Geometry,r=new CGL.Mesh(i);this.segments.onValueChanged=t,this.radius.onValueChanged=t,this.percent.onValueChanged=t},Ops.Gl.Meshes.Circle.prototype=new Op,Ops.Gl.Meshes.ObjMesh=function(){Op.apply(this,arguments);var t=this;this.name="OBJ Mesh",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null,this.render.onTriggered=function(){t.mesh&&t.mesh.render(cgl.getShader()),t.trigger.call()},ajaxRequest("assets/skull.obj",function(e){console.log(e);var i=parseOBJ(e);unwrap=function(t,e,i){for(var r=new Array(Math.floor(t.length/3)*i),n=0;n<t.length;n++)for(var s=0;i>s;s++)r[n*i+s]=e[t[n]*i+s];return r};var r=i.verticesIndices.length;i.vertices=unwrap(i.verticesIndices,i.vertices,3),i.texCoords=unwrap(i.texCoordsIndices,i.texCoords,2),i.verticesIndices=[];for(var n=0;r>n;n++)i.verticesIndices.push(n);t.mesh=new CGL.Mesh(i)})},Ops.Gl.Meshes.ObjMesh.prototype=new Op,Ops.Gl.Meshes.Cube=function(){Op.apply(this,arguments);var t=this;this.name="Cube",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null,this.render.onTriggered=function(){null!==t.mesh&&t.mesh.render(cgl.getShader()),t.trigger.call()};var e=new CGL.Geometry;e.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],e.texCoords=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],e.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],this.mesh=new CGL.Mesh(e)},Ops.Gl.Meshes.Cube.prototype=new Op,Ops.Gl.Meshes.Plotter=function(){function t(){gl.lineWidth(4),gl.bindBuffer(gl.ARRAY_BUFFER,e.buffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e.vertices),gl.STATIC_DRAW),e.buffer.itemSize=3,e.buffer.numItems=i}Op.apply(this,arguments);var e=this;this.name="Plotter",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.v=this.addInPort(new Port(this,"value")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){gl.vertexAttribPointer(cgl.getShader().getAttrVertexPos(),e.buffer.itemSize,gl.FLOAT,!1,0,0),cgl.getShader().bind(),gl.bindBuffer(gl.ARRAY_BUFFER,e.buffer),gl.drawArrays(gl.LINE_STRIP,0,e.buffer.numItems),e.trigger.call()},this.buffer=gl.createBuffer();var i=50;this.vertices=[];for(var r=0;i>r;r++)this.vertices.push(1/i*r),this.vertices.push(Math.random()-.5),this.vertices.push(0);t(),this.v.onValueChanged=function(){e.vertices.splice(0,3),e.vertices.push(1),e.vertices.push(e.v.val),e.vertices.push(0);for(var r=0;3*i>r;r+=3)e.vertices[r]=1/i*r;t()}},Ops.Gl.Meshes.Plotter.prototype=new Op,Ops.Gl.Meshes.Triangle=function(){Op.apply(this,arguments);var t=this;this.name="Triangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){t.mesh.render(cgl.getShader()),t.trigger.call()};var e=new CGL.Geometry;e.vertices=[0,1,0,-1,-1,0,1,-1,0],e.verticesIndices=[0,1,2],this.mesh=new CGL.Mesh(e)},Ops.Gl.Meshes.Triangle.prototype=new Op,Ops.Gl.Shader={},Ops.Gl.Shader.BasicMaterial=function(){Op.apply(this,arguments);var t=this;this.name="BasicMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){cgl.pushShader(i),t.texture.val&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,t.texture.val)),t.trigger.call(),cgl.popShader()};var e="precision highp float;\n#ifdef HAS_TEXTURES\n  varying vec2 texCoord;\n  uniform sampler2D tex;\n#endif\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\n\nvoid main()\n{\nvec4 col=vec4(r,g,b,a);\n#ifdef HAS_TEXTURES\n   col=texture2D(tex,texCoord);\n"+"col.a*=a;".endl()+"#endif\ngl_FragColor = col;\n}\n",i=new CGL.Shader;i.setSource(i.getDefaultVertexShader(),e),this.r=this.addInPort(new Port(this,"r")),this.r.onValueChanged=function(){t.r.uniform?t.r.uniform.setValue(t.r.val):t.r.uniform=new CGL.Uniform(i,"f","r",t.r.val)},this.g=this.addInPort(new Port(this,"g")),this.g.onValueChanged=function(){t.g.uniform?t.g.uniform.setValue(t.g.val):t.g.uniform=new CGL.Uniform(i,"f","g",t.g.val)},this.b=this.addInPort(new Port(this,"b")),this.b.onValueChanged=function(){t.b.uniform?t.b.uniform.setValue(t.b.val):t.b.uniform=new CGL.Uniform(i,"f","b",t.b.val)},this.a=this.addInPort(new Port(this,"a")),this.a.onValueChanged=function(){t.a.uniform?t.a.uniform.setValue(t.a.val):t.a.uniform=new CGL.Uniform(i,"f","a",t.a.val)},this.r.val=Math.random(),this.g.val=Math.random(),this.b.val=Math.random(),this.a.val=1,this.render.onTriggered=this.doRender,this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.texture.onValueChanged=function(){t.texture.val?(console.log("TEXTURE ADDED"),t.textureUniform=new CGL.Uniform(i,"t","tex",0)):i.removeUniform("tex")},this.doRender()},Ops.Gl.Shader.BasicMaterial.prototype=new Op,Ops.Gl.Shader.Schwurbel=function(){Op.apply(this,arguments);var t=this;this.name="Schwurbel",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.timer=this.addInPort(new Port(this,"time")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){cgl.pushShader(i),t.timer.uniLoc||(i.bind(),t.timer.uniLoc=gl.getUniformLocation(i.getProgram(),"time")),gl.uniform1f(t.timer.uniLoc,t.timer.val),cgl.popShader(i),t.trigger.call()};var e="precision mediump float;\nuniform float time;\n\nvoid main()\n{\nfloat c=sqrt(sin(time*0.02)*cos((time+gl_FragCoord.y)*0.02)+sin(time+gl_FragCoord.x*0.02)*sin(time+gl_FragCoord.y*0.02));\ngl_FragColor = vec4( c,c,c,1.0);\n}\n",i=new CGL.Shader;i.compile(i.getDefaultVertexShader(),e),this.doRender(),this.render.onTriggered=this.doRender},Ops.Gl.Shader.Schwurbel.prototype=new Op,Ops.Gl.Shader.Noise=function(){Op.apply(this,arguments);var t=this;this.name="Noise",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var e=-1,i=-1;this.doRender=function(){cgl.pushShader(n),-1==e&&(i=Date.now(),n.bind(),e=gl.getUniformLocation(n.getProgram(),"time")),gl.uniform1f(e,(Date.now()-i)/1e3),cgl.popShader(),t.trigger.call()};var r="precision mediump float;\nuniform float time;\n\nfloat random(vec2 co)\n{\n   return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvoid main()\n{\n   float c=random(time*gl_FragCoord.xy);   gl_FragColor = vec4( c,c,c,1.0);\n}\n",n=new CGL.Shader;n.compile(n.getDefaultVertexShader(),r),this.doRender(),this.render.onTriggered=this.doRender},Ops.Gl.Shader.Noise.prototype=new Op,Ops.Gl.Matrix={},Ops.Gl.Matrix.Translate=function(){Op.apply(this,arguments);var t=this;this.name="translate",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"x")),this.y=this.addInPort(new Port(this,"y")),this.z=this.addInPort(new Port(this,"z")),this.x.val=0,this.y.val=0,this.z.val=0;var e=vec3.create();this.render.onTriggered=function(){vec3.set(e,t.x.val,t.y.val,t.z.val),cgl.pushMvMatrix(),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,e),t.trigger.call(),cgl.popMvMatrix()}},Ops.Gl.Matrix.Translate.prototype=new Op,Ops.Gl.Matrix.Scale=function(){Op.apply(this,arguments);var t=this;this.name="scale",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.scale=this.addInPort(new Port(this,"scale"));var e=vec3.create(),i=mat4.create();mat4.identity(i);var r=!1;this.render.onTriggered=function(){cgl.pushMvMatrix(),mat4.multiply(mvMatrix,mvMatrix,i),t.trigger.call(),cgl.popMvMatrix()};var n=function(){mat4.identity(i),mat4.scale(i,i,e)};this.scaleChanged=function(){r=!1,vec3.set(e,t.scale.val,t.scale.val,t.scale.val),n()},this.scale.onValueChanged=this.scaleChanged,this.scale.val=1,n()},Ops.Gl.Matrix.Scale.prototype=new Op,Ops.Gl.Matrix.Transform=function(){Op.apply(this,arguments);var t=this;this.name="transform",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.posX=this.addInPort(new Port(this,"posX")),this.posY=this.addInPort(new Port(this,"posY")),this.posZ=this.addInPort(new Port(this,"posZ")),
this.scaleX=this.addInPort(new Port(this,"scaleX")),this.scaleY=this.addInPort(new Port(this,"scaleY")),this.scaleZ=this.addInPort(new Port(this,"scaleZ")),this.rotX=this.addInPort(new Port(this,"rotX")),this.rotY=this.addInPort(new Port(this,"rotY")),this.rotZ=this.addInPort(new Port(this,"rotZ"));var e=vec3.create(),i=vec3.create(),r=mat4.create();mat4.identity(r);var n=!1,s=!1;this.render.onTriggered=function(){cgl.pushMvMatrix(),mat4.multiply(cgl.mvMatrix,cgl.mvMatrix,r),t.trigger.call(),cgl.popMvMatrix()};var a=function(){mat4.identity(r),s&&mat4.translate(r,r,e),0!==t.rotX.val&&mat4.rotateX(r,r,t.rotX.val*CGL.DEG2RAD),0!==t.rotY.val&&mat4.rotateY(r,r,t.rotY.val*CGL.DEG2RAD),0!==t.rotZ.val&&mat4.rotateZ(r,r,t.rotZ.val*CGL.DEG2RAD),n&&mat4.scale(r,r,i)};this.translateChanged=function(){s=!1,(0!==t.posX.val||0!==t.posY.val||0!==t.posZ.val)&&(s=!0),vec3.set(e,t.posX.val,t.posY.val,t.posZ.val),a()},this.scaleChanged=function(){n=!1,(0!==t.scaleX.val||0!==t.scaleY.val||0!==t.scaleZ.val)&&(n=!0),vec3.set(i,t.scaleX.val,t.scaleY.val,t.scaleZ.val),a()},this.rotChanged=function(){a()},this.rotX.onValueChanged=this.rotChanged,this.rotY.onValueChanged=this.rotChanged,this.rotZ.onValueChanged=this.rotChanged,this.scaleX.onValueChanged=this.scaleChanged,this.scaleY.onValueChanged=this.scaleChanged,this.scaleZ.onValueChanged=this.scaleChanged,this.posX.onValueChanged=this.translateChanged,this.posY.onValueChanged=this.translateChanged,this.posZ.onValueChanged=this.translateChanged,this.rotX.val=0,this.rotY.val=0,this.rotZ.val=0,this.scaleX.val=1,this.scaleY.val=1,this.scaleZ.val=1,this.posX.val=0,this.posY.val=0,this.posZ.val=0,a()},Ops.Gl.Matrix.Transform.prototype=new Op,Ops.RandomCluster=function(){function t(){e.randoms=[],e.randomsRot=[],e.randomsFloats=[];for(var t=0;t<e.num.val;t++)e.randomsFloats.push(Math.random()),e.randoms.push(vec3.fromValues((Math.random()-.5)*e.size.val,(Math.random()-.5)*e.size.val,(Math.random()-.5)*e.size.val)),e.randomsRot.push(vec3.fromValues(360*Math.random()*CGL.DEG2RAD,360*Math.random()*CGL.DEG2RAD,360*Math.random()*CGL.DEG2RAD))}Op.apply(this,arguments);var e=this;this.name="random cluster",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.size=this.addInPort(new Port(this,"size")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.rnd=this.addOutPort(new Port(this,"rnd")),this.randoms=[],this.randomsRot=[],this.randomsFloats=[];vec3.create();this.exe.onTriggered=function(){for(var t=0;t<e.randoms.length;t++)cgl.pushMvMatrix(),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,e.randoms[t]),mat4.rotateX(cgl.mvMatrix,cgl.mvMatrix,e.randomsRot[t][0]),mat4.rotateY(cgl.mvMatrix,cgl.mvMatrix,e.randomsRot[t][1]),mat4.rotateZ(cgl.mvMatrix,cgl.mvMatrix,e.randomsRot[t][2]),e.idx.val=t,e.rnd.val=e.randomsFloats[t],e.trigger.call(),cgl.popMvMatrix()},this.num.onValueChanged=t,this.size.onValueChanged=t,this.num.val=100},Ops.RandomCluster.prototype=new Op,Ops.Gl.Render2Texture=function(){Op.apply(this,arguments);var t=this;this.name="render to texture",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var e,i=new CGL.Texture;this.width=this.addInPort(new Port(this,"texture width")),this.height=this.addInPort(new Port(this,"texture width")),this.tex=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.width.val=1024,this.height.val=1024,i.setSize(this.width.val,this.height.val),e=GL.createFramebuffer(),GL.bindFramebuffer(GL.FRAMEBUFFER,e);var r=GL.createRenderbuffer();GL.bindRenderbuffer(GL.RENDERBUFFER,r),GL.renderbufferStorage(GL.RENDERBUFFER,GL.DEPTH_COMPONENT16,this.width.val,this.height.val),GL.framebufferTexture2D(GL.FRAMEBUFFER,GL.COLOR_ATTACHMENT0,GL.TEXTURE_2D,i.tex,0),GL.framebufferRenderbuffer(GL.FRAMEBUFFER,GL.DEPTH_ATTACHMENT,GL.RENDERBUFFER,r),GL.bindTexture(GL.TEXTURE_2D,null),GL.bindRenderbuffer(GL.RENDERBUFFER,null),GL.bindFramebuffer(GL.FRAMEBUFFER,null),t.tex.val=i.tex,this.render.onTriggered=function(){cgl.pushMvMatrix(),GL.bindFramebuffer(GL.FRAMEBUFFER,e),cgl.pushPMatrix(),gl.viewport(0,0,1920,1080),mat4.perspective(cgl.pMatrix,45,t.width.val/t.height.val,.01,1100),t.trigger.call(),cgl.popPMatrix(),GL.bindFramebuffer(GL.FRAMEBUFFER,null),cgl.popMvMatrix(),gl.viewport(0,0,cgl.canvasWidth,cgl.canvasHeight)}},Ops.Gl.Render2Texture.prototype=new Op,Ops.Log=function(){Op.apply(this,arguments);var t=this;this.name="logger",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.input=this.addInPort(new Port(this,"input")),this.input.val="",this.exec=function(){console.log("[log] "+t.input.val)},this.exe.onTriggered=this.exec,this.input.onValueChanged=this.exec},Ops.Log.prototype=new Op,Ops.CallsPerSecond=function(){Op.apply(this,arguments);var t=this;this.name="CallsPerSecond",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.timeStart=0,this.cps=0,this.exe.onTriggered=function(){0===t.timeStart&&(t.timeStart=Date.now());var e=Date.now();e-t.timeStart>1e3&&(t.timeStart=Date.now(),console.log("cps: "+t.cps),t.cps=0),t.cps++}},Ops.CallsPerSecond.prototype=new Op,Ops.Value=function(){Op.apply(this,arguments);var t=this;this.name="Value",this.v=this.addInPort(new Port(this,"value")),this.result=this.addOutPort(new Port(this,"result")),this.exec=function(){t.result.val=t.v.val},this.v.onValueChanged=this.exec},Ops.Value.prototype=new Op,Ops.TimeLineTime=function(){Op.apply(this,arguments);this.name="TimeLineTime",this.theTime=this.addOutPort(new Port(this,"time")),this.onAnimFrame=function(t){this.theTime.val=t}},Ops.TimeLineTime.prototype=new Op,Ops.Repeat=function(){Op.apply(this,arguments);var t=this;this.name="Repeat",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.num.val=5,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.exe.onTriggered=function(){for(var e=0;e<t.num.value;e++)t.idx.val=e,t.trigger.call()}},Ops.Repeat.prototype=new Op,Ops.IfTrueThen=function(){Op.apply(this,arguments);var t=this;this.name="if true then",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.bool=this.addInPort(new Port(this,"boolean")),this.bool.val=!1,this.triggerThen=this.addOutPort(new Port(this,"then",OP_PORT_TYPE_FUNCTION)),this.triggerElse=this.addOutPort(new Port(this,"else",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){t.bool.val===!0?t.triggerThen.call():t.triggerElse.call()},this.bool.onValueChanged=function(){t.exe.onTriggered()}},Ops.IfTrueThen.prototype=new Op,Ops.Group=function(){Op.apply(this,arguments);var t=this;this.name="group",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.triggers=[];for(var e=0;10>e;e++)this.triggers.push(this.addOutPort(new Port(this,"trigger "+e,OP_PORT_TYPE_FUNCTION)));this.exe.onTriggered=function(){for(var e in t.triggers)t.triggers[e].call()}},Ops.Group.prototype=new Op,Ops.Interval=function(){Op.apply(this,arguments),this.name="Interval",this.timeOutId=-1,this.interval=this.addInPort(new Port(this,"interval")),this.interval.val=1e3,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exec=function(){if(-1==this.timeOutId){var t=this;this.timeOutId=setTimeout(function(){t.timeOutId=-1,t.trigger.call(),t.exec()},this.interval.val)}},this.exec()},Ops.Interval.prototype=new Op,Ops.Anim={},Ops.Anim.SinusAnim=function(){Op.apply(this,arguments),this.name="SinusAnim",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var t=this;this.exe.onTriggered=function(){t.result.val=Math.sin(Date.now()/1e3)},this.exe.onTriggered()},Ops.Anim.SinusAnim.prototype=new Op,Ops.Anim.RelativeTime=function(){Op.apply(this,arguments),this.name="RelativeTime",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var t=this,e=Date.now()/1e3;this.exe.onTriggered=function(){t.result.val=Date.now()/1e3-e},this.exe.onTriggered()},Ops.Anim.RelativeTime.prototype=new Op,Ops.Input={},Ops.Input.GamePad=function(){Op.apply(this,arguments),this.name="GamePad",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.numPads=this.addOutPort(new Port(this,"numPads")),this.axis1=this.addOutPort(new Port(this,"axis1")),this.axis2=this.addOutPort(new Port(this,"axis2")),this.axis3=this.addOutPort(new Port(this,"axis3")),this.axis4=this.addOutPort(new Port(this,"axis4")),this.button0=this.addOutPort(new Port(this,"button0")),this.button1=this.addOutPort(new Port(this,"button1")),this.button2=this.addOutPort(new Port(this,"button2")),this.button3=this.addOutPort(new Port(this,"button3")),this.button4=this.addOutPort(new Port(this,"button4"));{var t=this;Date.now()/1e3}this.exe.onTriggered=function(){var e=navigator.getGamepads(),i=0;for(var r in e)e[r].axes&&(t.axis1.val=e[r].axes[0],t.axis2.val=e[r].axes[1],t.axis3.val=e[r].axes[2],t.axis4.val=e[r].axes[3],t.button0.val=e[r].buttons[0].pressed,t.button0.val=e[r].buttons[1].pressed,t.button2.val=e[r].buttons[2].pressed,t.button3.val=e[r].buttons[3].pressed,t.button4.val=e[r].buttons[4].pressed,i++);t.numPads.val=i},this.exe.onTriggered()},Ops.Input.GamePad.prototype=new Op,Ops.Math={},Ops.Math.Random=function(){var t=this;Op.apply(this,arguments),this.name="random",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result")),this.exe.onTriggered=function(){t.result.val=Math.random()},this.exe.onTriggered()},Ops.Math.Random.prototype=new Op,Ops.Math.Clamp=function(){function t(){e.result.val=Math.min(Math.max(e.val.val,e.min.val),e.max.val)}var e=this;Op.apply(this,arguments),this.name="Clamp",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=t,this.min.onValueChanged=t,this.max.onValueChanged=t,this.val.val=.5},Ops.Math.Clamp.prototype=new Op,Ops.Math.SmoothStep=function(){function t(){var t=Math.max(0,Math.min(1,(e.val.val-e.min.val)/(e.max.val-e.min.val)));e.result.val=t*t*(3-2*t)}var e=this;Op.apply(this,arguments),this.name="SmoothStep",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=t,this.min.onValueChanged=t,this.max.onValueChanged=t,this.val.val=.5},Ops.Math.SmoothStep.prototype=new Op,Ops.Math.MapRange=function(){Op.apply(this,arguments);var t=this;this.name="map value range",this.result=this.addOutPort(new Port(this,"result")),this.v=this.addInPort(new Port(this,"value")),this.old_min=this.addInPort(new Port(this,"old min")),this.old_max=this.addInPort(new Port(this,"old max")),this.new_min=this.addInPort(new Port(this,"new min")),this.new_max=this.addInPort(new Port(this,"new max")),this.exec=function(){if(t.v.val>t.old_max.val)return void(t.result.val=t.new_max.val);if(t.v.val<t.old_min.val)return void(t.result.val=t.new_min.val);var e=parseFloat(t.new_min.val),i=parseFloat(t.new_max.val),r=parseFloat(t.old_min.val),n=parseFloat(t.old_max.val),s=parseFloat(t.v.val),a=!1,o=Math.min(r,n),h=Math.max(r,n);o!=r&&(a=!0);var l=!1,u=Math.min(e,i),d=Math.max(e,i);u!=e&&(l=!0);var p=0;p=a?(h-s)*(d-u)/(h-o):(s-o)*(d-u)/(h-o),t.result.val=l?d-p:p+u},this.v.val=0,this.old_min.val=-1,this.old_max.val=1,this.new_min.val=0,this.new_max.val=1,this.v.onValueChanged=this.exec,this.old_min.onValueChanged=this.exec,this.old_max.onValueChanged=this.exec,this.new_min.onValueChanged=this.exec,this.new_max.onValueChanged=this.exec,this.exec()},Ops.Math.MapRange.prototype=new Op,Ops.Math.Abs=function(){Op.apply(this,arguments);var t=this;this.name="abs",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){t.result.val=Math.abs(t.number.val)}},Ops.Math.Abs.prototype=new Op,Ops.Math.Sin=function(){Op.apply(this,arguments);var t=this;this.name="Sinus",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){t.result.val=Math.sin(t.number.val)}},Ops.Math.Sin.prototype=new Op,Ops.Math.Sum=function(){Op.apply(this,arguments);var t=this;this.name="sum",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=parseFloat(t.number1.val)+parseFloat(t.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=1},Ops.Math.Sum.prototype=new Op,Ops.Math.Multiply=function(){Op.apply(this,arguments);var t=this;this.name="multiply",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val*t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=2},Ops.Math.Multiply.prototype=new Op,Ops.Math.Divide=function(){Op.apply(this,arguments);var t=this;this.name="Divide",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val/t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Divide.prototype=new Op,Ops.Math.Compare={},Ops.Math.Compare.IsEven=function(){Op.apply(this,arguments);var t=this;this.name="isEven",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.exec=function(){t.result.val=!(1&t.number1.val)},this.number1.onValueChanged=this.exec},Ops.Math.Compare.IsEven.prototype=new Op,Ops.Math.Compare.Greater=function(){Op.apply(this,arguments);var t=this;this.name="Greater",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val>t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Greater.prototype=new Op,Ops.Math.Compare.Between=function(){Op.apply(this,arguments);var t=this;this.name="Between",this.result=this.addOutPort(new Port(this,"result")),this.number=this.addInPort(new Port(this,"value")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.number.val=2,this.number1.val=1,this.number2.val=3,this.exec=function(){t.result.val=t.number.val>Math.min(t.number1.val,t.number2.val)&&t.number.val<Math.max(t.number1.val,t.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number.onValueChanged=this.exec},Ops.Math.Compare.Between.prototype=new Op,Ops.Math.Compare.Lesser=function(){Op.apply(this,arguments);var t=this;this.name="Lesser",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val<t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Lesser.prototype=new Op,Ops.Math.Compare.Equals=function(){Op.apply(this,arguments);var t=this;this.name="Equals",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){t.result.val=t.number1.val==t.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Equals.prototype=new Op;
//# sourceMappingURL=cables.min.js.map