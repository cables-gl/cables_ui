Ops.Array=Ops.Array||{},Ops.Array.RandomArray=function(){var e=this;Op.apply(this,arguments),this.name="RandomArray",this.numValues=this.addInPort(new Port(this,"numValues",OP_PORT_TYPE_VALUE)),this.values=this.addOutPort(new Port(this,"values",OP_PORT_TYPE_ARRAY));var t=[];this.numValues.onValueChanged=function(){t.length=e.numValues.val;for(var r=0;r<t.length;r++)t[r]=Math.random();e.values.val=t},this.numValues.val=100},Ops.Array.RandomArray.prototype=new Op,Ops.Array.ArrayGetValue=function(){function e(){t.value.set(t.array.val[t.index.get()])}var t=this;Op.apply(this,arguments),this.name="ArrayGetValue",this.array=this.addInPort(new Port(this,"array",OP_PORT_TYPE_ARRAY)),this.index=this.addInPort(new Port(this,"index",OP_PORT_TYPE_VALUE,{type:"int"})),this.value=this.addOutPort(new Port(this,"value",OP_PORT_TYPE_VALUE));this.index.onValueChanged=e,this.array.onValueChanged=e},Ops.Array.ArrayGetValue.prototype=new Op,Ops.WebAudio=Ops.WebAudio||{},Ops.WebAudio.Output=function(){var e=this;Op.apply(this,arguments),window.audioContext||(audioContext="webkitAudioContext"in window?new webkitAudioContext:new AudioContext),this.name="audioOutput",this.audioIn=this.addInPort(new Port(this,"audio in",OP_PORT_TYPE_OBJECT)),this.oldAudioIn=null,this.audioIn.onValueChanged=function(){e.audioIn.val&&(console.log(e.audioIn.val),null===e.audioIn.val?null!==e.oldAudioIn&&e.oldAudioIn.disconnect(audioContext.destination):e.audioIn.val.connect(audioContext.destination),e.oldAudioIn=e.audioIn.val)}},Ops.WebAudio.Output.prototype=new Op,Ops.WebAudio.AudioPlayer=function(){function e(){r.media.stop(),r.media=audioContext.createBufferSource(),r.media.buffer=n,r.media.connect(r.filter),r.audioOut.val=r.filter}function t(){if(!window.gui&&CGL.getLoadingStatus()>=1)return void console.log("seek canceled",CGL.getLoadingStatus());if(window.gui){if(!r.audio)return;r.patch.timer.isPlaying()&&r.audio.paused?r.audio.play():r.patch.timer.isPlaying()||r.audio.paused||r.audio.pause(),r.audio.currentTime=r.patch.timer.getTime()}else{if(null===n)return;var t=r.patch.timer.getTime();isFinite(t)||(console.log("not finite time...",t),t=0),i&&e(),i=!1,console.log("seek.....",r.patch.timer.isPlaying()),r.patch.timer.isPlaying()&&(console.log("play!"),r.media.start(t),i=!0)}}var r=this;Op.apply(this,arguments),this.name="AudioPlayer",this.file=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",filter:"mp3"})),this.volume=this.addInPort(new Port(this,"volume",OP_PORT_TYPE_VALUE,{display:"range"})),this.volume.val=1,window.audioContext||(audioContext="webkitAudioContext"in window?new webkitAudioContext:new AudioContext),this.filter=audioContext.createGain(),r.audio=null;var n=null,i=!1;this.volume.onValueChanged=function(){r.filter.gain.value=r.volume.val};var a="";this.file.onValueChanged=function(){if(a=r.file.val,CGL.incrementLoadingAssets(),window.gui){r.audio=new Audio,r.audio.src=r.file.val;var e=function(){CGL.decrementLoadingAssets(),r.audio.removeEventListener("canplaythrough",e,!1)};r.audio.addEventListener("canplaythrough",e,!1),r.media=audioContext.createMediaElementSource(r.audio),r.media.connect(r.filter),r.audioOut.val=r.filter}else{r.media=audioContext.createBufferSource();var i=new XMLHttpRequest;i.open("GET",r.file.val,!0),i.responseType="arraybuffer",i.onload=function(){var e=i.response;audioContext.decodeAudioData(e,function(e){n=e,console.log("sound load complete"),r.media.buffer=e,r.media.connect(r.filter),r.audioOut.val=r.filter,CGL.decrementLoadingAssets()})},i.send()}r.patch.timer.onPlayPause(t),r.patch.timer.onTimeChange(t)},this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT))},Ops.WebAudio.AudioPlayer.prototype=new Op,Ops.WebAudio.Oscillator=function(){var e=this;Op.apply(this,arguments),window.audioContext||(audioContext=new AudioContext),this.oscillator=audioContext.createOscillator(),this.oscillator.start(0),this.oscillator.frequency.value=200,this.name="Oscillator",this.frequency=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE)),this.frequency.onValueChanged=function(){e.oscillator.frequency.value=e.frequency.val},this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT)),this.audioOut.val=this.oscillator},Ops.WebAudio.Oscillator.prototype=new Op,Ops.WebAudio.MicrophoneIn=function(){var e=this;Op.apply(this,arguments),this.microphone=null,this.name="microphone",this.userMediaAvailable=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT)),this.userMediaAvailable&&(window.audioContext||(audioContext=new AudioContext),navigator.getUserMedia({audio:!0},function(t){e.microphone=audioContext.createMediaStreamSource(t),e.audioOut.val=e.microphone},function(e){console.log("No live audio input "+e)}))},Ops.WebAudio.MicrophoneIn.prototype=new Op,Ops.WebAudio.Analyser=function(){var e=this;Op.apply(this,arguments),window.audioContext||(audioContext=new AudioContext),this.name="Audio Analyser",this.audioIn=this.addInPort(new Port(this,"audio in",OP_PORT_TYPE_OBJECT)),this.refresh=this.addInPort(new Port(this,"refresh",OP_PORT_TYPE_FUNCTION)),this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT)),this.avgVolume=this.addOutPort(new Port(this,"average volume",OP_PORT_TYPE_VALUE)),this.fftOut=this.addOutPort(new Port(this,"fft",OP_PORT_TYPE_ARRAY)),this.oldAudioIn=null,this.analyser=audioContext.createAnalyser(),this.analyser.smoothingTimeConstant=.3,this.analyser.fftSize=256;var t=0,r=null;this.refresh.onTriggered=function(){var t=new Uint8Array(e.analyser.frequencyBinCount);e.analyser.getByteFrequencyData(t);for(var n,i=0,a=0;a<t.length;a++)i+=t[a];n=i/t.length,e.avgVolume.val=n,e.analyser.getByteFrequencyData(r),e.fftOut.val=r},this.audioIn.onValueChanged=function(){console.log(e.audioIn.val),null===e.audioIn.val?null!==e.oldAudioIn&&e.oldAudioIn.disconnect(e.analyser):e.audioIn.val.connect(e.analyser),e.oldAudioIn=e.audioIn.val,t=e.analyser.frequencyBinCount,r=new Uint8Array(t)},this.audioOut.val=this.analyser},Ops.WebAudio.Analyser.prototype=new Op,Ops.Devices=Ops.Devices||{},Ops.Devices.MotionSensor=function(){var e=this;Op.apply(this,arguments),this.name="MotionSensor",this.mulAxis=this.addInPort(new Port(this,"mulAxis")),this.mulAxis.val=1,this.foundSensor=this.addOutPort(new Port(this,"foundSensor")),this.axis1=this.addOutPort(new Port(this,"axis1")),this.axis2=this.addOutPort(new Port(this,"axis2")),this.axis3=this.addOutPort(new Port(this,"axis3")),this.accX=this.addOutPort(new Port(this,"accX")),this.accY=this.addOutPort(new Port(this,"accY")),this.accZ=this.addOutPort(new Port(this,"accX")),this.axis1.set(0),this.axis2.set(0),this.axis3.set(0),this.accX.set(0),this.accY.set(0),this.accZ.set(0);var t=0,r=0;window.ondevicemotion=function(t){Date.now()-r>15&&(r=Date.now(),e.accX.set(t.accelerationIncludingGravity.x),e.accY.set(t.accelerationIncludingGravity.y),e.accZ.set(t.accelerationIncludingGravity.z))},window.addEventListener("deviceorientation",function(r){Date.now()-t>15&&(t=Date.now(),e.axis1.set((r.alpha||0)*e.mulAxis.get()),e.axis2.set((r.beta||0)*e.mulAxis.get()),e.axis3.set((r.gamma||0)*e.mulAxis.get()))},!0)},Ops.Devices.MotionSensor.prototype=new Op,Ops.Devices.GamePad=function(){Op.apply(this,arguments),this.name="GamePad",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.numPads=this.addOutPort(new Port(this,"numPads")),this.axis1=this.addOutPort(new Port(this,"axis1")),this.axis2=this.addOutPort(new Port(this,"axis2")),this.axis3=this.addOutPort(new Port(this,"axis3")),this.axis4=this.addOutPort(new Port(this,"axis4")),this.button0=this.addOutPort(new Port(this,"button0")),this.button1=this.addOutPort(new Port(this,"button1")),this.button2=this.addOutPort(new Port(this,"button2")),this.button3=this.addOutPort(new Port(this,"button3")),this.button4=this.addOutPort(new Port(this,"button4"));{var e=this;Date.now()/1e3}this.exe.onTriggered=function(){var t=navigator.getGamepads(),r=0;for(var n in t)t[n].axes&&(e.axis1.val=t[n].axes[0],e.axis2.val=t[n].axes[1],e.axis3.val=t[n].axes[2],e.axis4.val=t[n].axes[3],e.button0.val=t[n].buttons[0].pressed,e.button0.val=t[n].buttons[1].pressed,e.button2.val=t[n].buttons[2].pressed,e.button3.val=t[n].buttons[3].pressed,e.button4.val=t[n].buttons[4].pressed,r++);e.numPads.val=r},this.exe.onTriggered()},Ops.Devices.GamePad.prototype=new Op,Ops.Devices.LeapMotion=function(){Op.apply(this,arguments);var e=this;this.name="LeapMotion",this.transX=this.addOutPort(new Port(this,"translationX")),this.transY=this.addOutPort(new Port(this,"translationY")),this.transZ=this.addOutPort(new Port(this,"translationZ")),this.finger0X=this.addOutPort(new Port(this,"finger0X")),this.finger0Y=this.addOutPort(new Port(this,"finger0Y")),this.finger0Z=this.addOutPort(new Port(this,"finger0Z")),Leap.loop(function(t){e.transX.val=t._translation[0],e.transY.val=t._translation[1],e.transZ.val=t._translation[2],t.fingers.length>0&&(e.finger0X.val=t.fingers[0].tipPosition[0],e.finger0Y.val=t.fingers[0].tipPosition[1],e.finger0Z.val=t.fingers[0].tipPosition[2])})},Ops.Devices.LeapMotion.prototype=new Op,Ops.Experimental=Ops.Experimental||{},Ops.Experimental.ImageStream=function(){function e(){var e=new EventSource(t.url.val);e.addEventListener("message",function(e){i.src=e.data})}Op.apply(this,arguments);var t=this,r=this.patch.cgl;this.name="ImageStream",this.url=this.addInPort(new Port(this,"url")),this.url.val="http://localhost:5600/images",this.tex=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE));var n=new CGL.Texture(r);n.setSize(320,240),$("#glcanvas").append('<img id="imagestream">');var i=document.getElementById("imagestream");this.tex.val=n,i.onload=function(){n.image=i,n.initTexture(i),console.log("loaded")},setTimeout(e,500)},Ops.Experimental.ImageStream.prototype=new Op,Ops.Experimental.SaltedPerceptionMaterial=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="SaltedPerceptionMaterial",this.zBufferTex=this.addInPort(new Port(this,"zBufferTexture",OP_PORT_TYPE_TEXTURE)),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){t.setShader(i),e.zBufferTex.val&&(t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,e.zBufferTex.val.tex)),e.trigger.call(),t.setPreviousShader()};var r="".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"precision highp float;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform float time;".endl()+"uniform float zscale;".endl()+"attribute vec3 Normal;".endl()+"varying  vec2 texcoord;".endl()+"varying vec3 norm;".endl()+"uniform sampler2D texDepth;".endl()+"void main(void)".endl()+"{".endl()+"   norm=attrVertNormal;".endl()+"   texcoord=attrTexCoord;".endl()+"   float offX=1.0/640.0;".endl()+"   float offY=1.0/480.0;".endl()+"   vec4 texCol= 0.2*texture2D(texDepth, vec2(1.0-texcoord.s,1.0-texcoord.t));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s+offX,1.0-texcoord.t+offY));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s-offX,1.0-texcoord.t-offY));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s+offX,1.0-texcoord.t-offY));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s-offX,1.0-texcoord.t+offY));".endl()+"   vec3 vertex=vPosition;".endl()+"   vertex.z+=zscale*(texCol.r*190.0+sin(texCol.r*8.0+time*2.0)*5.0+sin(vertex.y+texture2D(texDepth,texcoord).r*10.0));".endl()+"   texCol.b=0.0;".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vertex,1.0);".endl()+"}",n="".endl()+"precision highp float;".endl()+"uniform sampler2D texColor;".endl()+"uniform sampler2D texDepth;".endl()+"uniform float time;".endl()+"varying  vec2 texcoord;".endl()+"void main(){ ".endl()+"vec4 color=texture2D(texDepth, vec2(1.0-texcoord.s,1.0-texcoord.t));".endl()+"color.a=1.0;".endl()+"//float d= texture2D(texDepth, vec2(1.0-texcoord.s,texcoord.t)).r;".endl()+"//if(d==1.0)color=vec4(0.0,0.0,0.0,0.0);".endl()+"gl_FragColor = color;".endl()+"}",i=new CGL.Shader(t);i.setSource(r,n),this.zBufferTexUniform=null,this.zBufferTex.onValueChanged=function(){if(e.zBufferTex.val){if(null!==e.zBufferTexUniform)return;i.removeUniform("texDepth"),i.define("HAS_TEXTURE_DIFFUSE"),e.zBufferTexUniform=new CGL.Uniform(i,"t","texDepth",0)}else i.removeUniform("texDepth"),i.removeDefine("HAS_TEXTURE_DIFFUSE"),e.zBufferTexUniform=null},this.zScale=this.addInPort(new Port(this,"zscale",OP_PORT_TYPE_VALUE)),this.zScale.onValueChanged=function(){e.zScale.uniform?e.zScale.uniform.setValue(e.zScale.val):e.zScale.uniform=new CGL.Uniform(i,"f","zscale",e.zScale.val)},this.time=this.addInPort(new Port(this,"time",OP_PORT_TYPE_VALUE)),this.time.onValueChanged=function(){e.time.uniform?e.time.uniform.setValue(e.time.val):e.time.uniform=new CGL.Uniform(i,"f","time",e.time.val)},this.zScale.val=1,this.render.onTriggered=this.doRender,this.doRender()},Ops.Experimental.SaltedPerceptionMaterial.prototype=new Op,Ops.Gl=Ops.Gl||{},Ops.Gl.TextureEffects=Ops.Gl.TextureEffects||{},Ops.Gl.TextureEffects.ImageCompose=function(){function e(){r.useVPSize.val&&(a=n.getViewPort()[2],o=n.getViewPort()[3]),a==r.tex.width&&o==r.tex.height||0===a||0===o||(r.height.val=o,r.width.val=a,r.tex.setSize(a,o),i.setSourceTexture(r.tex),r.texOut.val=i.getCurrentSourceTexture())}function t(){o=parseInt(r.height.val,10),a=parseInt(r.width.val,10),e()}Op.apply(this,arguments);var r=this,n=this.patch.cgl;this.name="image compose",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.useVPSize=this.addInPort(new Port(this,"use viewport size",OP_PORT_TYPE_VALUE,{display:"bool"})),this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.texOut=this.addOutPort(new Port(this,"texture_out",OP_PORT_TYPE_TEXTURE,{preview:!0}));var i=new CGL.TextureEffect(n);n.currentTextureEffect=i,this.tex=new CGL.Texture(n);var a=8,o=8;this.onResize=e,this.useVPSize.onValueChanged=function(){r.useVPSize.val?(r.width.onValueChanged=null,r.height.onValueChanged=null):(r.width.onValueChanged=t,r.height.onValueChanged=t)},this.useVPSize.val=!0,render=function(){n.gl.disable(n.gl.SCISSOR_TEST),e(),n.currentTextureEffect=i,i.startEffect(),r.trigger.trigger(),r.texOut.val=i.getCurrentSourceTexture(),n.gl.enable(n.gl.SCISSOR_TEST)},this.texOut.onPreviewChanged=function(){r.render.onTriggered=r.texOut.showPreview?r.texOut.val.preview:render,console.log("jaja changed")},this.width.val=1920,this.height.val=1080,this.render.onTriggered=render},Ops.Gl.TextureEffects.ImageCompose.prototype=new Op,Ops.Gl.TextureEffects.Invert=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Invert",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.rgb=1.0-col.rgb;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}\n";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Invert.prototype=new Op,Ops.Gl.TextureEffects.Scroll=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Scroll",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.amountX=this.addInPort(new Port(this,"amountX",OP_PORT_TYPE_VALUE)),this.amountY=this.addInPort(new Port(this,"amountY",OP_PORT_TYPE_VALUE));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"  uniform float amountX;".endl()+"  uniform float amountY;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,vec2(mod(texCoord.x+amountX*0.1,1.0),mod(texCoord.y+amountY*0.1,1.0) ));".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}\n";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())};var i=new CGL.Uniform(r,"f","amountX",1);this.amountX.onValueChanged=function(){i.setValue(e.amountX.val)};var a=new CGL.Uniform(r,"f","amountY",1);this.amountY.onValueChanged=function(){a.setValue(e.amountY.val)},this.amountY.val=0,this.amountX.val=0},Ops.Gl.TextureEffects.Scroll.prototype=new Op,Ops.Gl.TextureEffects.Desaturate=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Desaturate",this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"vec3 desaturate(vec3 color, float amount)".endl()+"{".endl()+"   vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));".endl()+"   return vec3(mix(color, gray, amount));".endl()+"}".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.rgb=desaturate(col.rgb,amount);".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","amount",1));this.amount.onValueChanged=function(){i.setValue(e.amount.val)},this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Desaturate.prototype=new Op,Ops.Gl.TextureEffects.PixelDisplacement=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="PixelDisplacement",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amountX",OP_PORT_TYPE_VALUE,{display:"range"})),this.amountY=this.addInPort(new Port(this,"amountY",OP_PORT_TYPE_VALUE,{display:"range"})),this.displaceTex=this.addInPort(new Port(this,"displaceTex",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D displaceTex;".endl()+"#endif".endl()+"uniform float amountX;".endl()+"uniform float amountY;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,vec2(mod(texCoord.x+texture2D(displaceTex,texCoord).g*1.0*amountX,1.0),mod(texCoord.y+texture2D(displaceTex,texCoord).g*1.0*amountY,1.0) ) );".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"t","displaceTex",1),new CGL.Uniform(r,"f","amountX",0)),a=new CGL.Uniform(r,"f","amountY",0);this.amount.onValueChanged=function(){i.setValue(e.amount.val)},this.amountY.onValueChanged=function(){a.setValue(e.amountY.val)},this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),e.displaceTex.val&&(t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.displaceTex.val.tex)),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())},e.amount.val=0,e.amountY.val=0},Ops.Gl.TextureEffects.PixelDisplacement.prototype=new Op,Ops.Gl.TextureEffects.MixImage=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="MixImage",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord)*(1.0-amount);".endl()+"       col+=texture2D(image,texCoord)*amount;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"t","image",1),new CGL.Uniform(r,"f","amount",1));this.amount.onValueChanged=function(){i.setValue(e.amount.val)},e.amount.val=1,this.render.onTriggered=function(){t.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.image.val.tex),t.currentTextureEffect.finish(),t.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.MixImage.prototype=new Op,Ops.Gl.TextureEffects.DrawImage=function(){function e(){i.currentTextureEffect&&(n.image.val&&n.image.val.tex&&(i.setShader(a),i.currentTextureEffect.bind(),i.gl.activeTexture(i.gl.TEXTURE0),i.gl.bindTexture(i.gl.TEXTURE_2D,i.currentTextureEffect.getCurrentSourceTexture().tex),i.gl.activeTexture(i.gl.TEXTURE1),i.gl.bindTexture(i.gl.TEXTURE_2D,n.image.val.tex),n.imageAlpha.val&&n.imageAlpha.val.tex&&(i.gl.activeTexture(i.gl.TEXTURE2),i.gl.bindTexture(i.gl.TEXTURE_2D,n.imageAlpha.val.tex)),i.currentTextureEffect.finish(),i.setPreviousShader()),n.trigger.trigger())}function t(){e(),n.image.val.preview()}function r(){e(),n.imageAlpha.val.preview()}Op.apply(this,arguments);var n=this,i=this.patch.cgl;this.name="DrawImage",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.blendMode=this.addInPort(new Port(this,"blendMode",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["normal","lighten","darken","multiply","average","add","substract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight"]})),n.blendMode.val="normal",this.imageAlpha=this.addInPort(new Port(this,"imageAlpha",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.alphaSrc=this.addInPort(new Port(this,"alphaSrc",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["alpha channel","luminance"]})),this.removeAlphaSrc=this.addInPort(new Port(this,"removeAlphaSrc",OP_PORT_TYPE_VALUE,{display:"bool"})),this.removeAlphaSrc.val=!0,this.invAlphaChannel=this.addInPort(new Port(this,"invert alpha channel",OP_PORT_TYPE_VALUE,{display:"bool"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var a=new CGL.Shader(i);this.onLoaded=a.compile;var o="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"#ifdef HAS_TEXTUREALPHA".endl()+"  uniform sampler2D imageAlpha;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       blendRGBA=texture2D(image,texCoord);".endl()+"vec3 blend=blendRGBA.rgb;".endl()+"vec4 baseRGBA=texture2D(tex,texCoord);".endl()+"vec3 base=baseRGBA.rgb;".endl()+"vec3 colNew=blend;".endl()+"#define Blend(base, blend, funcf)       vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))".endl()+"#ifdef BM_NORMAL".endl()+"colNew=blend;".endl()+"#endif".endl()+"#ifdef BM_MULTIPLY".endl()+"colNew=base*blend;".endl()+"#endif".endl()+"#ifdef BM_AVERAGE".endl()+"colNew=((base + blend) / 2.0);".endl()+"#endif".endl()+"#ifdef BM_ADD".endl()+"colNew=min(base + blend, vec3(1.0));".endl()+"#endif".endl()+"#ifdef BM_SUBSTRACT".endl()+"colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"#endif".endl()+"#ifdef BM_DIFFERENCE".endl()+"colNew=abs(base - blend);".endl()+"#endif".endl()+"#ifdef BM_NEGATION".endl()+"colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"#endif".endl()+"#ifdef BM_EXCLUSION".endl()+"colNew=(base + blend - 2.0 * base * blend);".endl()+"#endif".endl()+"#ifdef BM_LIGHTEN".endl()+"colNew=max(blend, base);".endl()+"#endif".endl()+"#ifdef BM_DARKEN".endl()+"colNew=min(blend, base);".endl()+"#endif".endl()+"#ifdef BM_OVERLAY".endl()+"   #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"   colNew=Blend(base, blend, BlendOverlayf);".endl()+"#endif".endl()+"#ifdef BM_SCREEN".endl()+"   #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"   colNew=Blend(base, blend, BlendScreenf);".endl()+"#endif".endl()+"#ifdef BM_SOFTLIGHT".endl()+"   #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"   colNew=Blend(base, blend, BlendSoftLightf);".endl()+"#endif".endl()+"#ifdef BM_HARDLIGHT".endl()+"   #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"   colNew=Blend(blend, base, BlendOverlayf);".endl()+"#endif".endl()+"#ifdef BM_COLORDODGE".endl()+"   #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"   colNew=Blend(base, blend, BlendColorDodgef);".endl()+"#endif".endl()+"#ifdef BM_COLORBURN".endl()+"   #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"   colNew=Blend(base, blend, BlendColorBurnf);".endl()+"#endif".endl()+"#ifdef REMOVE_ALPHA_SRC".endl()+"   blendRGBA.a=1.0;".endl()+"#endif".endl()+"#ifdef HAS_TEXTUREALPHA".endl()+"   vec4 colImgAlpha=texture2D(imageAlpha,texCoord);".endl()+"   float colImgAlphaAlpha=colImgAlpha.a;".endl()+"   #ifdef INVERT_ALPHA".endl()+"       colImgAlphaAlpha=1.0-colImgAlphaAlpha;".endl()+"   #endif".endl()+"   #ifdef ALPHA_FROM_LUMINANCE".endl()+"       vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));".endl()+"       colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;".endl()+"   #endif".endl()+"   blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;".endl()+"#endif".endl()+"blendRGBA.rgb=mix( colNew, base ,1.0-blendRGBA.a*amount);".endl()+"blendRGBA.a=baseRGBA.a+blendRGBA.a;".endl()+"#endif".endl()+"   gl_FragColor = blendRGBA;".endl()+"}";a.setSource(a.getDefaultVertexShader(),o);new CGL.Uniform(a,"t","tex",0),new CGL.Uniform(a,"t","image",1),new CGL.Uniform(a,"t","imageAlpha",2);this.invAlphaChannel.onValueChanged=function(){n.invAlphaChannel.val?a.define("INVERT_ALPHA"):a.removeDefine("INVERT_ALPHA"),a.compile()},this.removeAlphaSrc.onValueChanged=function(){n.removeAlphaSrc.val?a.define("REMOVE_ALPHA_SRC"):a.removeDefine("REMOVE_ALPHA_SRC"),a.compile()},this.alphaSrc.onValueChanged=function(){"luminance"==n.alphaSrc.val?a.define("ALPHA_FROM_LUMINANCE"):a.removeDefine("ALPHA_FROM_LUMINANCE"),a.compile()},this.alphaSrc.val="alpha channel",this.blendMode.onValueChanged=function(){"normal"==n.blendMode.val?a.define("BM_NORMAL"):a.removeDefine("BM_NORMAL"),"multiply"==n.blendMode.val?a.define("BM_MULTIPLY"):a.removeDefine("BM_MULTIPLY"),"average"==n.blendMode.val?a.define("BM_AVERAGE"):a.removeDefine("BM_AVERAGE"),"add"==n.blendMode.val?a.define("BM_ADD"):a.removeDefine("BM_ADD"),"substract"==n.blendMode.val?a.define("BM_SUBSTRACT"):a.removeDefine("BM_SUBSTRACT"),"difference"==n.blendMode.val?a.define("BM_DIFFERENCE"):a.removeDefine("BM_DIFFERENCE"),"negation"==n.blendMode.val?a.define("BM_NEGATION"):a.removeDefine("BM_NEGATION"),"exclusion"==n.blendMode.val?a.define("BM_EXCLUSION"):a.removeDefine("BM_EXCLUSION"),"lighten"==n.blendMode.val?a.define("BM_LIGHTEN"):a.removeDefine("BM_LIGHTEN"),"darken"==n.blendMode.val?a.define("BM_DARKEN"):a.removeDefine("BM_DARKEN"),"overlay"==n.blendMode.val?a.define("BM_OVERLAY"):a.removeDefine("BM_OVERLAY"),"screen"==n.blendMode.val?a.define("BM_SCREEN"):a.removeDefine("BM_SCREEN"),"softlight"==n.blendMode.val?a.define("BM_SOFTLIGHT"):a.removeDefine("BM_SOFTLIGHT"),"hardlight"==n.blendMode.val?a.define("BM_HARDLIGHT"):a.removeDefine("BM_HARDLIGHT"),"color dodge"==n.blendMode.val?a.define("BM_COLORDODGE"):a.removeDefine("BM_COLORDODGE"),"color burn"==n.blendMode.val?a.define("BM_COLORBURN"):a.removeDefine("BM_COLORBURN"),a.compile()};var s=new CGL.Uniform(a,"f","amount",1);this.amount.onValueChanged=function(){s.setValue(n.amount.val)},n.amount.val=1,this.imageAlpha.onValueChanged=function(){n.imageAlpha.val&&n.imageAlpha.val.tex?a.define("HAS_TEXTUREALPHA"):a.removeDefine("HAS_TEXTUREALPHA"),a.compile()},this.image.onPreviewChanged=function(){n.render.onTriggered=n.image.showPreview?t:e},this.imageAlpha.onPreviewChanged=function(){n.render.onTriggered=n.imageAlpha.showPreview?r:e},this.render.onTriggered=e},Ops.Gl.TextureEffects.DrawImage.prototype=new Op,Ops.Gl.TextureEffects.DepthTexture=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="DepthTexture",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.farPlane=this.addInPort(new Port(this,"farplane",OP_PORT_TYPE_VALUE)),this.nearPlane=this.addInPort(new Port(this,"nearplane",OP_PORT_TYPE_VALUE)),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"uniform float n;".endl()+"uniform float f;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(image,texCoord);".endl()+"       float z=col.r;".endl()+"       float c=(2.0*n)/(f+n-z*(f-n));".endl()+"       col=vec4(c,c,c,1.0);".endl()+"       if(c>=0.99)col.a=0.0;".endl()+"           else col.a=1.0;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";

r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","image",0),new CGL.Uniform(r,"f","f",1)),a=new CGL.Uniform(r,"f","n",1);this.farPlane.onValueChanged=function(){i.setValue(e.farPlane.val)},e.farPlane.val=5,this.nearPlane.onValueChanged=function(){a.setValue(e.nearPlane.val)},e.nearPlane.val=.01,this.render.onTriggered=function(){t.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,e.image.val.tex),t.currentTextureEffect.finish(),t.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.DepthTexture.prototype=new Op,Ops.Gl.TextureEffects.SSAO=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="SSAO",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.farPlane=this.addInPort(new Port(this,"farplane",OP_PORT_TYPE_VALUE)),this.nearPlane=this.addInPort(new Port(this,"nearplane",OP_PORT_TYPE_VALUE)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.dist=this.addInPort(new Port(this,"dist",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D image;".endl()+"  uniform sampler2D colTex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"uniform float dist;".endl()+"uniform float near;".endl()+"uniform float far;".endl()+"".endl()+"#define samples 8.0".endl()+"#define rings 4.0".endl()+"#define PI    3.14159265".endl()+"".endl()+"float readDepth(vec2 coord)".endl()+"{".endl()+"    return (2.0 * near) / (far + near - texture2D(image, coord ).x * (far-near));".endl()+"}".endl()+"float compareDepths( in float depth1, in float depth2 )".endl()+"{".endl()+"    float aoCap = 1.9;".endl()+"    float aoMultiplier =40.0;".endl()+"    float depthTolerance = 0.001;".endl()+"    float aorange = 100.0;".endl()+"    float diff = sqrt(clamp(1.0-(depth1-depth2) / (aorange/(far-near)),0.0,1.0));".endl()+"    float ao = min(aoCap,max(0.0,depth1-depth2-depthTolerance) * aoMultiplier) * diff;".endl()+"    return ao;".endl()+"}".endl()+"void main()".endl()+"{".endl()+"float d;float ao=1.0;    float depth = readDepth(texCoord);".endl()+"float w=1.0/640.0;".endl()+"float h=1.0/360.0;".endl()+"float pw;".endl()+"float ph;".endl()+"float s=0.0;".endl()+"float fade = 1.0;".endl()+"for (float i = 0.0 ; i < rings; i += 1.0)".endl()+"{".endl()+"   fade *= 0.5;".endl()+"   for (float j = 0.0 ; j < samples; j += 1.0)".endl()+"   {".endl()+"       float step = PI*2.0 / (samples*i);".endl()+"       float jj=j*2.0*i*2.0;".endl()+"       pw = (cos(jj*step)*i);".endl()+"       ph = (sin(jj*step)*i)*2.0;".endl()+"       pw*=dist;".endl()+"       ph*=dist;".endl()+"       d = readDepth( vec2(texCoord.s+pw*w,texCoord.t+ph*h));".endl()+"       ao += compareDepths(depth,d)*fade;".endl()+"       s += 1.0*fade*1.0;".endl()+"   }".endl()+"}".endl()+"ao /= s;".endl()+"ao = 1.0-ao;".endl()+"ao = 1.0-ao;".endl()+"vec4 col=vec4(ao,ao,ao,1.0);".endl()+"col=texture2D(colTex,texCoord)-col*amount;".endl()+"       col.a=1.0;".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","image",0),new CGL.Uniform(r,"t","colTex",1),new CGL.Uniform(r,"f","far",1)),a=new CGL.Uniform(r,"f","near",1),o=new CGL.Uniform(r,"f","amount",1),s=new CGL.Uniform(r,"f","dist",1);this.dist.onValueChanged=function(){s.setValue(5*e.dist.val)},e.dist.val=.2,this.amount.onValueChanged=function(){o.setValue(e.amount.val)},e.amount.val=1,this.farPlane.onValueChanged=function(){i.setValue(e.farPlane.val)},e.farPlane.val=5,this.nearPlane.onValueChanged=function(){a.setValue(e.nearPlane.val)},e.nearPlane.val=.01,this.render.onTriggered=function(){t.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,e.image.val.tex),t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.SSAO.prototype=new Op,Ops.Gl.TextureEffects.AlphaMask=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="AlphaMask",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"   #ifdef FROM_RED".endl()+"       col.a=texture2D(image,texCoord).r;".endl()+"   #endif".endl()+"   #ifdef FROM_GREEN".endl()+"       col.a=texture2D(image,texCoord).g;".endl()+"   #endif".endl()+"   #ifdef FROM_BLUE".endl()+"       col.a=texture2D(image,texCoord).b;".endl()+"   #endif".endl()+"   #ifdef FROM_ALPHA".endl()+"       col.a=texture2D(image,texCoord).a;".endl()+"   #endif".endl()+"   #ifdef FROM_LUMINANCE".endl()+"       vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), texture2D(image,texCoord).rgb ));".endl()+"       col.a=(gray.r+gray.g+gray.b)/3.0;".endl()+"   #endif".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"t","image",1);this.method=this.addInPort(new Port(this,"method",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["luminance","image alpha","red","green","blue"]})),this.method.onValueChanged=function(){"luminance"==e.method.val?r.define("FROM_LUMINANCE"):r.removeDefine("FROM_LUMINANCE"),"image alpha"==e.method.val?r.define("FROM_ALPHA"):r.removeDefine("FROM_ALPHA"),"red"==e.method.val?r.define("FROM_RED"):r.removeDefine("FROM_RED"),"green"==e.method.val?r.define("FROM_GREEN"):r.removeDefine("FROM_GREEN"),"blue"==e.method.val?r.define("FROM_BLUE"):r.removeDefine("FROM_BLUE")},this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),e.image.val&&e.image.val.tex&&(t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.image.val.tex)),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.AlphaMask.prototype=new Op,Ops.Gl.TextureEffects.WipeTransition=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="WipeTransition",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.fade=this.addInPort(new Port(this,"fade",OP_PORT_TYPE_VALUE,{display:"range"})),this.fadeWidth=this.addInPort(new Port(this,"fadeWidth",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"uniform float fade;".endl()+"uniform float fadeWidth;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec4 colWipe=texture2D(image,texCoord);".endl()+"       float w=fadeWidth;".endl()+"       float v=colWipe.r;".endl()+"       float f=fade+fade*w;".endl()+"       if(f<v) col.a=1.0;".endl()+"       else if(f>v+w) col.a=0.0;".endl()+"       else if(f>v && f<=v+w) col.a = 1.0-(f-v)/w; ;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"t","image",1),new CGL.Uniform(r,"f","fade",0)),a=new CGL.Uniform(r,"f","fadeWidth",0);this.fade.onValueChanged=function(){i.setValue(e.fade.val)},this.fadeWidth.onValueChanged=function(){a.setValue(e.fadeWidth.val)},this.fade.val=.5,this.fadeWidth.val=.2,this.render.onTriggered=function(){t.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.image.val.tex),t.currentTextureEffect.finish(),t.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.WipeTransition.prototype=new Op,Ops.Gl.TextureEffects.ColorLookup=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="ColorLookup",this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.posy=this.addInPort(new Port(this,"posy",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"  uniform float posy;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.r=col.r*(1.0-amount)+texture2D(image,vec2(col.r,posy)).r*amount;".endl()+"       col.g=col.g*(1.0-amount)+texture2D(image,vec2(col.g,posy)).g*amount;".endl()+"       col.b=col.b*(1.0-amount)+texture2D(image,vec2(col.b,posy)).b*amount;".endl()+"   #endif".endl()+"   col.a=1.0;".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"t","image",1),new CGL.Uniform(r,"f","amount",1));this.amount.onValueChanged=function(){i.setValue(e.amount.val)};var a=new CGL.Uniform(r,"f","posy",0);this.posy.onValueChanged=function(){a.setValue(e.posy.val)},this.posy.val=0,this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),e.image.val&&e.image.val.tex&&(t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.image.val.tex)),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.ColorLookup.prototype=new Op,Ops.Gl.TextureEffects.BrightnessContrast=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="BrightnessContrast",this.amount=this.addInPort(new Port(this,"contrast",OP_PORT_TYPE_VALUE,{display:"range"})),this.amountBright=this.addInPort(new Port(this,"brightness",OP_PORT_TYPE_VALUE,{display:"range"})),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"uniform float amountbright;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       // apply contrast".endl()+"       col.rgb = ((col.rgb - 0.5) * max(amount*2.0, 0.0))+0.5;".endl()+"       // apply brightness".endl()+"       col.rgb += amountbright;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","amount",.4)),a=new CGL.Uniform(r,"f","amountbright",0);this.amount.onValueChanged=function(){console.log("amount changed! "+e.amount.val),i.setValue(e.amount.val)},this.amountBright.onValueChanged=function(){a.setValue(e.amountBright.val)},this.amountBright.val=0,this.amount.val=.5,this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.BrightnessContrast.prototype=new Op,Ops.Gl.TextureEffects.RemoveAlpha=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="RemoveAlpha",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.a=1.0;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.RemoveAlpha.prototype=new Op,Ops.Gl.TextureEffects.ColorOverlay=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="ColorOverlay",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"}));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform float r;".endl()+"  uniform float g;".endl()+"  uniform float b;".endl()+"  uniform float a;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"   #endif".endl()+"   vec4 overCol=vec4(r,g,b,col.a);".endl()+"   col=mix(col,overCol, a);".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())};var i=new CGL.Uniform(r,"f","r",1),a=new CGL.Uniform(r,"f","g",1),o=new CGL.Uniform(r,"f","b",1),s=new CGL.Uniform(r,"f","a",1);this.r.onValueChanged=function(){i.setValue(e.r.val)},this.g.onValueChanged=function(){a.setValue(e.g.val)},this.b.onValueChanged=function(){o.setValue(e.b.val)},this.a.onValueChanged=function(){s.setValue(e.a.val)},this.a.val=1,this.r.val=1,this.g.val=0,this.b.val=0},Ops.Gl.TextureEffects.ColorOverlay.prototype=new Op,Ops.Gl.TextureEffects.ColorChannel=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="ColorChannel",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"   #ifdef CHANNEL_R".endl()+"       col.r=texture2D(tex,texCoord).r;".endl()+"       #ifdef MONO".endl()+"           col.g=col.b=col.r;".endl()+"       #endif".endl()+"   #endif".endl()+"   #ifdef CHANNEL_G".endl()+"       col.g=texture2D(tex,texCoord).g;".endl()+"       #ifdef MONO".endl()+"           col.r=col.b=col.g;".endl()+"       #endif".endl()+"   #endif".endl()+"   #ifdef CHANNEL_B".endl()+"       col.b=texture2D(tex,texCoord).b;".endl()+"       #ifdef MONO".endl()+"           col.g=col.r=col.b;".endl()+"       #endif".endl()+"   #endif".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())},this.channelR=this.addInPort(new Port(this,"channelR",OP_PORT_TYPE_VALUE,{display:"bool"})),this.channelR.onValueChanged=function(){e.channelR.val?r.define("CHANNEL_R"):r.removeDefine("CHANNEL_R")},this.channelR.val=!0,this.channelG=this.addInPort(new Port(this,"channelG",OP_PORT_TYPE_VALUE,{display:"bool"})),this.channelG.val=!1,this.channelG.onValueChanged=function(){e.channelG.val?r.define("CHANNEL_G"):r.removeDefine("CHANNEL_G")},this.channelB=this.addInPort(new Port(this,"channelB",OP_PORT_TYPE_VALUE,{display:"bool"})),this.channelB.val=!1,this.channelB.onValueChanged=function(){e.channelB.val?r.define("CHANNEL_B"):r.removeDefine("CHANNEL_B")},this.mono=this.addInPort(new Port(this,"mono",OP_PORT_TYPE_VALUE,{display:"bool"})),this.mono.val=!1,this.mono.onValueChanged=function(){e.mono.val?r.define("MONO"):r.removeDefine("MONO")}},Ops.Gl.TextureEffects.ColorChannel.prototype=new Op,Ops.Gl.TextureEffects.RgbMultiply=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="RgbMultiply",this.r=this.addInPort(new Port(this,"r")),this.g=this.addInPort(new Port(this,"g")),this.b=this.addInPort(new Port(this,"b")),this.r.val=1,this.g.val=1,this.b.val=1,this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float r;".endl()+"uniform float g;".endl()+"uniform float b;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.r*=r;".endl()+"       col.g*=g;".endl()+"       col.b*=b;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","r",1)),a=new CGL.Uniform(r,"f","g",1),o=new CGL.Uniform(r,"f","b",1);this.r.onValueChanged=function(){i.setValue(e.r.val)},this.g.onValueChanged=function(){a.setValue(e.g.val)},this.b.onValueChanged=function(){o.setValue(e.b.val)},this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.RgbMultiply.prototype=new Op,Ops.Gl.TextureEffects.Hue=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Hue",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.hue=this.addInPort(new Port(this,"hue",OP_PORT_TYPE_VALUE,{display:"range"})),this.hue.val=1,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float hue;".endl()+"".endl()+"vec3 rgb2hsv(vec3 c)".endl()+"{".endl()+"    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);".endl()+"    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));".endl()+"    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));".endl()+"".endl()+"    float d = q.x - min(q.w, q.y);".endl()+"    float e = 1.0e-10;".endl()+"    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);".endl()+"}".endl()+"vec3 hsv2rgb(vec3 c)".endl()+"{".endl()+"    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);".endl()+"    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);".endl()+"    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);".endl()+"}".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec3 hsv = rgb2hsv(col.rgb);".endl()+"       hsv.x=hsv.x+hue;".endl()+"       col.rgb = hsv2rgb(hsv);".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","hue",1));this.hue.onValueChanged=function(){i.setValue(e.hue.val)},this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Hue.prototype=new Op,Ops.Gl.TextureEffects.Color=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Color",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float r;".endl()+"uniform float g;".endl()+"uniform float b;".endl()+"uniform float a;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(r,g,b,a);".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","r",1)),a=new CGL.Uniform(r,"f","g",1),o=new CGL.Uniform(r,"f","b",1),s=new CGL.Uniform(r,"f","a",1);this.r.onValueChanged=function(){i.setValue(e.r.val)},this.g.onValueChanged=function(){a.setValue(e.g.val)},this.b.onValueChanged=function(){o.setValue(e.b.val)},this.a.onValueChanged=function(){s.setValue(e.a.val)},this.r.val=1,this.g.val=1,this.b.val=1,this.a.val=1,this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Color.prototype=new Op,Ops.Gl.TextureEffects.Vignette=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Vignette",this.lensRadius1=this.addInPort(new Port(this,"lensRadius1")),this.lensRadius2=this.addInPort(new Port(this,"lensRadius2")),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float lensRadius1;".endl()+"uniform float lensRadius2;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec2 tcPos=vec2(texCoord.x,texCoord.y/1.777+0.25);".endl()+"       float dist = distance(tcPos, vec2(0.5,0.5));".endl()+"       col.rgb *= smoothstep(lensRadius1, lensRadius2, dist);".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","lensRadius1",.4)),a=new CGL.Uniform(r,"f","lensRadius2",.3);this.lensRadius1.onValueChanged=function(){i.setValue(e.lensRadius1.val)},this.lensRadius2.onValueChanged=function(){a.setValue(e.lensRadius2.val)},this.lensRadius1.val=.8,this.lensRadius2.val=.4,this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Vignette.prototype=new Op,Ops.Gl.TextureEffects.Blur=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Blur",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.iterations=this.addInPort(new Port(this,"iterations",OP_PORT_TYPE_VALUE)),this.iterations.val=10;var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform float dirX;".endl()+"  uniform float dirY;".endl()+"  uniform float width;".endl()+"  uniform float height;".endl()+"#endif".endl()+"".endl()+"vec4 blur9(sampler2D texture, vec2 uv, vec2 red, vec2 dir)".endl()+"{".endl()+"   vec4 color = vec4(0.0);".endl()+"   vec2 offset1 = vec2(1.3846153846) * dir;".endl()+"   vec2 offset2 = vec2(3.2307692308) * dir;".endl()+"   color += texture2D(texture, uv) * 0.2270270270;".endl()+"   color += texture2D(texture, uv + (offset1 / red)) * 0.3162162162;".endl()+"   color += texture2D(texture, uv - (offset1 / red)) * 0.3162162162;".endl()+"   color += texture2D(texture, uv + (offset2 / red)) * 0.0702702703;".endl()+"   color += texture2D(texture, uv - (offset2 / red)) * 0.0702702703;".endl()+"   return color;".endl()+"}".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=blur9(tex,texCoord,vec2(width,height),vec2(dirX,dirY));".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","dirX",0)),a=new CGL.Uniform(r,"f","dirY",0),o=new CGL.Uniform(r,"f","width",0),s=new CGL.Uniform(r,"f","height",0);this.render.onTriggered=function(){if(t.currentTextureEffect){t.setShader(r),o.setValue(t.currentTextureEffect.getCurrentSourceTexture().width),s.setValue(t.currentTextureEffect.getCurrentSourceTexture().height);for(var n=0;n<e.iterations.val;n++)t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),i.setValue(0),a.setValue(1),t.currentTextureEffect.finish(),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),i.setValue(1),a.setValue(0),t.currentTextureEffect.finish();t.setPreviousShader(),e.trigger.trigger()}}},Ops.Gl.TextureEffects.Blur.prototype=new Op,Ops.Gl.TextureEffects.FXAA=function(){function e(){l.setValue(t.texWidth.val),d.setValue(t.texHeight.val)}Op.apply(this,arguments);var t=this,r=this.patch.cgl;this.name="FXAA",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.fxaa_span=this.addInPort(new Port(this,"span",OP_PORT_TYPE_VALUE,{display:"dropdown",values:[0,2,4,8,16,32,64]})),this.fxaa_reduceMin=this.addInPort(new Port(this,"reduceMin",OP_PORT_TYPE_VALUE)),this.fxaa_reduceMul=this.addInPort(new Port(this,"reduceMul",OP_PORT_TYPE_VALUE)),this.texWidth=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.texHeight=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var n=new CGL.Shader(r);this.onLoaded=n.compile;var i="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"    uniform float FXAA_SPAN_MAX;".endl()+"    uniform float FXAA_REDUCE_MUL;".endl()+"    uniform float FXAA_REDUCE_MIN;".endl()+"    uniform float width;".endl()+"    uniform float height;".endl()+"vec4 getColorFXAA(vec2 coord)".endl()+"{".endl()+"    vec2 invtexsize=vec2(1.0/width,1.0/height);".endl()+"".endl()+"    float step=1.0;".endl()+"".endl()+"    vec3 rgbNW = texture2D(tex, coord.xy + (vec2(-step, -step)*invtexsize )).xyz;".endl()+"    vec3 rgbNE = texture2D(tex, coord.xy + (vec2(+step, -step)*invtexsize )).xyz;".endl()+"    vec3 rgbSW = texture2D(tex, coord.xy + (vec2(-step, +step)*invtexsize )).xyz;".endl()+"    vec3 rgbSE = texture2D(tex, coord.xy + (vec2(+step, +step)*invtexsize )).xyz;".endl()+"    vec3 rgbM  = texture2D(tex, coord.xy).xyz;".endl()+"".endl()+"    vec3 luma = vec3(0.299, 0.587, 0.114);".endl()+"    float lumaNW = dot(rgbNW, luma);".endl()+"    float lumaNE = dot(rgbNE, luma);".endl()+"    float lumaSW = dot(rgbSW, luma);".endl()+"    float lumaSE = dot(rgbSE, luma);".endl()+"    float lumaM  = dot( rgbM, luma);".endl()+"".endl()+"    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));".endl()+"    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));".endl()+"".endl()+"    vec2 dir;".endl()+"    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));".endl()+"    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));".endl()+"".endl()+"    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);".endl()+"".endl()+"    float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);".endl()+"".endl()+"    dir = min(vec2(FXAA_SPAN_MAX,  FXAA_SPAN_MAX),".endl()+"          max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin))*invtexsize ;".endl()+"".endl()+"    vec3 rgbA = (1.0/2.0) * (".endl()+"                texture2D(tex, coord.xy + dir * (1.0/3.0 - 0.5)).xyz +".endl()+"                texture2D(tex, coord.xy + dir * (2.0/3.0 - 0.5)).xyz);".endl()+"    vec3 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (".endl()+"                texture2D(tex, coord.xy + dir * (0.0/3.0 - 0.5)).xyz +".endl()+"                texture2D(tex, coord.xy + dir * (3.0/3.0 - 0.5)).xyz);".endl()+"    float lumaB = dot(rgbB, luma);".endl()+"".endl()+"    vec4 color=texture2D(tex,coord).rgba;".endl()+"".endl()+"    if((lumaB < lumaMin) || (lumaB > lumaMax)){".endl()+"      color.xyz=rgbA;".endl()+"    } else {".endl()+"      color.xyz=rgbB;".endl()+"    }".endl()+"    return color;".endl()+"}".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   gl_FragColor = getColorFXAA(texCoord);".endl()+"}";

n.setSource(n.getDefaultVertexShader(),i);new CGL.Uniform(n,"t","tex",0);this.render.onTriggered=function(){r.currentTextureEffect&&(r.setShader(n),r.currentTextureEffect.bind(),r.gl.activeTexture(r.gl.TEXTURE0),r.gl.bindTexture(r.gl.TEXTURE_2D,r.currentTextureEffect.getCurrentSourceTexture().tex),r.currentTextureEffect.finish(),r.setPreviousShader(),t.trigger.trigger())};var a=new CGL.Uniform(n,"f","FXAA_SPAN_MAX",0),o=new CGL.Uniform(n,"f","FXAA_REDUCE_MUL",0),s=new CGL.Uniform(n,"f","FXAA_REDUCE_MIN",0);this.fxaa_span.onValueChanged=function(){a.setValue(parseInt(t.fxaa_span.val,10))};var l=new CGL.Uniform(n,"f","width",0),d=new CGL.Uniform(n,"f","height",0);this.texWidth.onValueChanged=e,this.texHeight.onValueChanged=e,this.fxaa_span.val=8,this.texWidth.val=1920,this.texHeight.val=1080,this.fxaa_reduceMul.onValueChanged=function(){o.setValue(1/t.fxaa_reduceMul.val)},this.fxaa_reduceMin.onValueChanged=function(){s.setValue(1/t.fxaa_reduceMin.val)},this.fxaa_reduceMul.val=8,this.fxaa_reduceMin.val=128},Ops.Gl.TextureEffects.FXAA.prototype=new Op,Ops.Gl.TextureEffects.Noise=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Noise",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"uniform float time;".endl()+"float random(vec2 co)".endl()+"{".endl()+"   return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);".endl()+"}".endl()+"void main()".endl()+"{".endl()+"   float c=random(time*texCoord.xy);".endl()+"   vec4 col=texture2D(tex,texCoord);".endl()+"   col.rgb=mix(col.rgb,vec3(c),amount);".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){t.currentTextureEffect&&(a.setValue(e.patch.timer.getTime()),t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())};var i=new CGL.Uniform(r,"f","amount",1),a=new CGL.Uniform(r,"f","time",1);this.amount.onValueChanged=function(){i.setValue(e.amount.val)},this.amount.val=.3},Ops.Gl.TextureEffects.Noise.prototype=new Op,Ops.Gl.TextureEffects.ChromaticAberration=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="ChromaticAberration",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=new CGL.Shader(t);this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec2 tcPos=vec2(texCoord.x,texCoord.y/1.777+0.25);".endl()+"       float dist = distance(tcPos, vec2(0.5,0.5));".endl()+"       col.r=texture2D(tex,texCoord+(dist)*-amount).r;".endl()+"       col.b=texture2D(tex,texCoord+(dist)*amount).b;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);var i=(new CGL.Uniform(r,"t","tex",0),new CGL.Uniform(r,"f","amount",0));this.amount.onValueChanged=function(){i.setValue(.1*e.amount.val)},this.amount.val=.5,this.render.onTriggered=function(){t.currentTextureEffect&&(t.setShader(r),t.currentTextureEffect.bind(),t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,t.currentTextureEffect.getCurrentSourceTexture().tex),t.currentTextureEffect.finish(),t.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.ChromaticAberration.prototype=new Op,Ops.Gl=Ops.Gl||{},Ops.Gl.Renderer=function(){Op.apply(this,arguments);var e=this;this.patch.cgl||console.log(" no cgl!");var t=this.patch.cgl;this.name="renderer",this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var r=vec3.create();vec3.set(r,0,0,-2),this.onDelete=function(){e.patch.removeOnAnimFrame(e)},this.onAnimFrame=function(n){return-1==t.canvasWidth?void t.setCanvas(e.patch.config.glCanvasId):((t.canvasWidth!=t.canvas.clientWidth||t.canvasHeight!=t.canvas.clientHeight)&&(t.canvasWidth=t.canvas.clientWidth,e.width.set(t.canvasWidth),t.canvasHeight=t.canvas.clientHeight,e.height.set(t.canvasHeight)),Ops.Gl.Renderer.renderStart(t,r),e.trigger.trigger(),CGL.Texture.previewTexture&&(CGL.Texture.texturePreviewer||(CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(t)),CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)),void Ops.Gl.Renderer.renderEnd(t))}},Ops.Gl.Renderer.renderStart=function(e,t){e.gl.enable(e.gl.DEPTH_TEST),e.gl.clearColor(0,0,0,1),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.setViewPort(0,0,e.canvas.clientWidth,e.canvas.clientHeight),mat4.perspective(e.pMatrix,45,e.canvasWidth/e.canvasHeight,.01,1100),e.pushPMatrix(),e.pushMvMatrix(),mat4.identity(e.mvMatrix),mat4.translate(e.mvMatrix,e.mvMatrix,t),e.gl.enable(e.gl.BLEND),e.gl.blendFunc(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA),e.beginFrame()},Ops.Gl.Renderer.renderEnd=function(e,t){e.popMvMatrix(),e.popPMatrix(),e.endFrame()},Ops.Gl.Renderer.prototype=new Op,Ops.Gl.Perspective=function(){function e(){r.frameStore.perspective={fovy:t.fovY.val,zFar:t.zFar.val,zNear:t.zNear.val}}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="Perspective",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.fovY=this.addInPort(new Port(this,"fov y",OP_PORT_TYPE_VALUE)),this.fovY.val=45,this.zNear=this.addInPort(new Port(this,"frustum near",OP_PORT_TYPE_VALUE)),this.zNear.val=.01,this.zFar=this.addInPort(new Port(this,"frustum far",OP_PORT_TYPE_VALUE)),this.zFar.val=2e3,this.render.onTriggered=function(){mat4.perspective(r.pMatrix,.0174533*t.fovY.val,r.getViewPort()[2]/r.getViewPort()[3],t.zNear.val,t.zFar.val),r.pushPMatrix(),t.trigger.trigger(),r.popPMatrix()},this.fovY.onValueChanged=e,this.zFar.onValueChanged=e,this.zNear.onValueChanged=e},Ops.Gl.Perspective.prototype=new Op,Ops.Gl.LetterBox=function(){function e(){var e=r.canvasHeight*t.ratio.val,s=r.canvasHeight,l=0,d=0;if(e>r.canvasWidth&&(e=r.canvasWidth,s=r.canvasWidth/t.ratio.val),e<r.canvasWidth&&(l=(r.canvasWidth-e)/2),s<r.canvasHeight&&(d=(r.canvasHeight-s)/2),e!=a||s!=o||l!=n||d!=i){a=e,o=s,n=l,i=d,r.setViewPort(n,i,a,o);for(var h=0;h<t.patch.ops.length;h++)t.patch.ops[h].onResize&&t.patch.ops[h].onResize()}}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="letterbox",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.ratio=this.addInPort(new Port(this,"ratio",OP_PORT_TYPE_VALUE,{display:"dropdown",values:[1.25,1.3333333333,1.777777777778,2.33333333333333]})),this.ratio.val=1.777777777778;var n=0,i=0,a=1e3,o=1e3;this.render.onTriggered=function(){r.gl.enable(r.gl.SCISSOR_TEST),e(),r.gl.scissor(n,i,a,o),r.setViewPort(n,i,a,o),mat4.perspective(r.pMatrix,45,t.ratio.val,.01,1100),t.trigger.trigger(),r.gl.disable(r.gl.SCISSOR_TEST)}},Ops.Gl.LetterBox.prototype=new Op,Ops.Gl.AspectRatioBorder=Ops.Gl.LetterBox,Ops.Gl.ClearAlpha=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="ClearAlpha",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.a.val=1,this.render.onTriggered=function(){t.gl.colorMask(!1,!1,!1,!0),t.gl.clearColor(0,0,0,e.a.val),t.gl.clear(t.gl.GL_COLOR_BUFFER_BIT|t.gl.GL_DEPTH_BUFFER_BIT),t.gl.colorMask(!0,!0,!0,!0),e.trigger.trigger()}},Ops.Gl.ClearAlpha.prototype=new Op,Ops.Gl.ClearColor=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="ClearColor",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.r.val=.3,this.g.val=.3,this.b.val=.3,this.a.val=1,this.render.onTriggered=function(){t.gl.clearColor(e.r.val,e.g.val,e.b.val,e.a.val),t.gl.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),e.trigger.trigger()}},Ops.Gl.ClearColor.prototype=new Op,Ops.Gl.FaceCulling=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="FaceCulling",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.enable=this.addInPort(new Port(this,"enable",OP_PORT_TYPE_VALUE,{display:"bool"})),this.enable.val=!0,this.facing=this.addInPort(new Port(this,"facing",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["back","front","both"]})),this.facing.val="back";var r=t.gl.BACK;this.render.onTriggered=function(){t.gl.cullFace(r),e.enable.val?t.gl.enable(t.gl.CULL_FACE):t.gl.disable(t.gl.CULL_FACE),e.trigger.trigger(),t.gl.disable(t.gl.CULL_FACE)},this.facing.onValueChanged=function(){r=t.gl.BACK,"front"==e.facing.val&&(r=t.gl.FRONT),"both"==e.facing.val&&(r=t.gl.FRONT_AND_BACK)}},Ops.Gl.FaceCulling.prototype=new Op,Ops.Gl.Depth=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="Depth",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.clear=this.addInPort(new Port(this,"clear depth",OP_PORT_TYPE_VALUE,{display:"bool"})),this.enable=this.addInPort(new Port(this,"enable depth testing",OP_PORT_TYPE_VALUE,{display:"bool"})),this.write=this.addInPort(new Port(this,"write to depth buffer",OP_PORT_TYPE_VALUE,{display:"bool"})),this.depthFunc=this.addInPort(new Port(this,"ratio",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["never","always","less","less or equal","greater","greater or equal","equal","not equal"]}));var r=t.gl.LEQUAL;this.depthFunc.onValueChanged=function(){"never"==e.depthFunc.val&&(r=t.gl.NEVER),"always"==e.depthFunc.val&&(r=t.gl.ALWAYS),"less"==e.depthFunc.val&&(r=t.gl.LESS),"less or equal"==e.depthFunc.val&&(r=t.gl.LEQUAL),"greater"==e.depthFunc.val&&(r=t.gl.GREATER),"greater or equal"==e.depthFunc.val&&(r=t.gl.EQUAL),"equal"==e.depthFunc.val&&(r=t.gl.EQUAL),"not equal"==e.depthFunc.val&&(r=t.gl.NOTEQUAL)},this.depthFunc.val="less or equal",this.clear.val=!1,this.enable.val=!0,this.write.val=!0,this.render.onTriggered=function(){!0===e.clear.val&&t.gl.clear(t.gl.DEPTH_BUFFER_BIT),!0!==e.enable.val&&t.gl.disable(t.gl.DEPTH_TEST),!0!==e.write.val&&t.gl.depthMask(!1),t.gl.depthFunc(r),e.trigger.trigger(),t.gl.enable(t.gl.DEPTH_TEST),t.gl.depthMask(!0),t.gl.depthFunc(t.gl.LEQUAL)}},Ops.Gl.Depth.prototype=new Op,Ops.Gl.ClearDepth=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="ClearDepth",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){t.gl.clear(t.gl.DEPTH_BUFFER_BIT),e.trigger.trigger()}},Ops.Gl.ClearDepth.prototype=new Op,Ops.Gl.Wireframe=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="Wireframe",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.lineWidth=this.addInPort(new Port(this,"lineWidth")),this.render.onTriggered=function(){t.wireframe=!0,t.gl.lineWidth(e.lineWidth.val),e.trigger.trigger(),t.wireframe=!1},this.lineWidth.val=2},Ops.Gl.Wireframe.prototype=new Op,Ops.Gl.Points=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="Points",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.pointSize=this.addInPort(new Port(this,"pointSize")),this.render.onTriggered=function(){t.points=!0,e.trigger.trigger(),t.points=!1},this.pointSize.val=5},Ops.Gl.Points.prototype=new Op,Ops.Gl.ColorPick=function(){function e(){r.gl.readPixels(t.x.val,r.canvas.height-t.y.val,1,1,r.gl.RGBA,r.gl.UNSIGNED_BYTE,n),t.r.val=n[0]/255,t.g.val=n[1]/255,t.b.val=n[2]/255,t.a.val=n[3]/255}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="ColorPick",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"x",OP_PORT_TYPE_VALUE)),this.y=this.addInPort(new Port(this,"y",OP_PORT_TYPE_VALUE)),this.r=this.addOutPort(new Port(this,"r",OP_PORT_TYPE_VALUE)),this.g=this.addOutPort(new Port(this,"g",OP_PORT_TYPE_VALUE)),this.b=this.addOutPort(new Port(this,"b",OP_PORT_TYPE_VALUE)),this.a=this.addOutPort(new Port(this,"a",OP_PORT_TYPE_VALUE));var n=new Uint8Array(4);this.render.onTriggered=e},Ops.Gl.ColorPick.prototype=new Op,Ops.Gl.ReadPixel=Ops.Gl.ColorPick,Ops.Gl.Mouse=function(){function e(e,t){n.normalize.get()?(n.mouseX.set((e/i.canvas.width*2-1)*n.multiply.get()),n.mouseY.set((t/i.canvas.height*2-1)*n.multiply.get())):(n.mouseX.set(e*n.multiply.get()),n.mouseY.set(t*n.multiply.get()))}function t(){0>=o&&(o=.01);var t=Math.abs(d-s),r=Math.round(t/o,0);s=d>s?s+r:s-r;var n=Math.abs(h-l),i=Math.round(n/o,0);l=h>l?l+i:l-i,e(s,l)}function r(e){o=100,n.smooth.get()&&(d=i.canvas.width/2,h=i.canvas.height/2)}Op.apply(this,arguments);var n=this,i=n.patch.cgl;this.name="mouse",this.mouseX=this.addOutPort(new Port(this,"x",OP_PORT_TYPE_VALUE)),this.mouseY=this.addOutPort(new Port(this,"y",OP_PORT_TYPE_VALUE)),this.normalize=this.addInPort(new Port(this,"normalize",OP_PORT_TYPE_VALUE,{display:"bool"})),this.smooth=this.addInPort(new Port(this,"smooth",OP_PORT_TYPE_VALUE,{display:"bool"})),this.smoothSpeed=this.addInPort(new Port(this,"smoothSpeed",OP_PORT_TYPE_VALUE)),this.multiply=this.addInPort(new Port(this,"multiply",OP_PORT_TYPE_VALUE)),this.multiply.set(1),this.smoothSpeed.set(20);var a,o=this.smoothSpeed.get();this.smooth.onValueChanged=function(){n.smooth.get()?a=setInterval(t,15):clearTimeout(a)};var s=0,l=0,d=i.canvas.width/2,h=i.canvas.height/2;s=d,l=h,this.mouseX.set(d),this.mouseY.set(h),i.canvas.onmouseenter=function(e){o=n.smoothSpeed.get()},i.canvas.onmouseleave=r,i.canvas.onmousemove=function(t){n.smooth.get()?(d=t.offsetX,h=t.offsetY):e(t.offsetX,t.offsetY)}},Ops.Gl.Mouse.prototype=new Op,Ops.Gl.TextureEmpty=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="texture empty",this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.tex=new CGL.Texture(t);var r=function(){e.tex.setSize(e.width.val,e.height.val),e.textureOut.val=e.tex};this.width.onValueChanged=r,this.height.onValueChanged=r,this.width.val=8,this.height.val=8},Ops.Gl.TextureEmpty.prototype=new Op,Ops.Gl.TextureCycler=function(){function e(){i.length=0;for(var e in n.portsIn)n.portsIn[e].isLinked()&&n.portsIn[e].get()&&i.push(n.portsIn[e].get())}function t(){var t=!0;for(var i in n.portsIn)n.portsIn[i].isLinked()||(t=!1);t&&r(),e()}function r(e){e||(e="texture"+a.length);var r=n.addInPort(new Port(n,e,OP_PORT_TYPE_TEXTURE));r.onLinkChanged=t,r.onValueChanged=t,a.push(r),t()}Op.apply(this,arguments);{var n=this;n.patch.cgl}this.name="TextureCycler",this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION));var i=[],a=[];this.getPort=function(e){var t=n.getPortByName(e);return t?t:(e.startsWith("texture")&&(t=r(e)),t)},r();var o=0;this.exe.onTriggered=function(){return 0===i.length?void n.textureOut.set(null):(o++,o>i.length-1&&(o=0),void n.textureOut.set(i[o]))},this.textureOut.onPreviewChanged=function(){n.textureOut.showPreview&&(CGL.Texture.previewTexture=n.textureOut.get())}},Ops.Gl.TextureCycler.prototype=new Op,Ops.Gl.Texture=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="texture",this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:"image"})),this.filter=this.addInPort(new Port(this,"filter",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["nearest","linear","mipmap"]})),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.cgl_filter=CGL.Texture.FILTER_MIPMAP;var r=function(){e.filename.val&&(e.tex=CGL.Texture.load(t,e.patch.getFilePath(e.filename.val),function(){e.textureOut.val=e.tex,e.width.val=e.tex.width,e.height.val=e.tex.height,e.uiAttr(e.tex.isPowerOfTwo()?{warning:""}:{warning:"texture dimensions not power of two! - texture filtering will not work."})},{filter:e.cgl_filter}),e.textureOut.val=e.tex)};this.filename.onValueChanged=r,this.filter.onValueChanged=function(){"nearest"==e.filter.val&&(e.cgl_filter=CGL.Texture.FILTER_NEAREST),"linear"==e.filter.val&&(e.cgl_filter=CGL.Texture.FILTER_LINEAR),"mipmap"==e.filter.val&&(e.cgl_filter=CGL.Texture.FILTER_MIPMAP),r()},this.filter.val="linear",this.textureOut.onPreviewChanged=function(){e.textureOut.showPreview&&(CGL.Texture.previewTexture=e.textureOut.val)}},Ops.Gl.Texture.prototype=new Op,Ops.Gl.TextureText=function(){function e(){o.clearRect(0,0,n.width,n.height),o.fillStyle="white",o.font=t.fontSize.val+"px "+t.font.val,o.textAlign=t.align.val,"center"==t.align.val&&o.fillText(t.text.val,o.canvas.width/2,o.canvas.height/2),"left"==t.align.val&&o.fillText(t.text.val,0,o.canvas.height/2),"right"==t.align.val&&o.fillText(t.text.val,o.canvas.width,o.canvas.height/2),o.restore(),t.textureOut.val?t.textureOut.val.initTexture(a):t.textureOut.val=new CGL.Texture.fromImage(r,a)}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="TextureText",this.text=this.addInPort(new Port(this,"text",OP_PORT_TYPE_VALUE,{type:"string"})),this.fontSize=this.addInPort(new Port(this,"fontSize")),this.align=this.addInPort(new Port(this,"align",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["left","center","right"]})),this.font=this.addInPort(new Port(this,"font")),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.fontSize.val=30,this.font.val="Arial",this.align.val="center";var n=document.createElement("canvas");n.id="hiddenCanvas",n.width=512,n.height=512,n.style.display="none";var i=document.getElementsByTagName("body")[0];i.appendChild(n);var a=document.getElementById("hiddenCanvas"),o=a.getContext("2d");this.align.onValueChanged=e,this.text.onValueChanged=e,this.fontSize.onValueChanged=e,this.font.onValueChanged=e,this.text.val="cables"},Ops.Gl.TextureText.prototype=new Op,Ops.Gl.Meshes=Ops.Gl.Meshes||{},Ops.Gl.Meshes.Plotter=function(){function e(){r.gl.lineWidth(4),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,t.buffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,new Float32Array(t.vertices),r.gl.STATIC_DRAW),t.buffer.itemSize=3,t.buffer.numItems=n}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="Plotter",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.v=this.addInPort(new Port(this,"value")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){r.getShader().bind(),r.gl.enableVertexAttribArray(r.getShader().getAttrVertexPos()),r.gl.vertexAttribPointer(r.getShader().getAttrVertexPos(),t.buffer.itemSize,r.gl.FLOAT,!1,0,0),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,t.buffer),r.gl.drawArrays(r.gl.LINE_STRIP,0,t.buffer.numItems),t.trigger.trigger()},this.buffer=r.gl.createBuffer();var n=50;this.vertices=[];for(var i=0;n>i;i++)this.vertices.push(1/n*i),this.vertices.push(Math.random()-.5),this.vertices.push(0);e(),this.v.onValueChanged=function(){t.vertices.splice(0,3),t.vertices.push(1),t.vertices.push(t.v.val),t.vertices.push(0);for(var r=0;3*n>r;r+=3)t.vertices[r]=1/n*r;e()}},Ops.Gl.Meshes.Plotter.prototype=new Op,Ops.Gl.Matrix={},Ops.Gl.Matrix.Translate=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="translate",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"x")),this.y=this.addInPort(new Port(this,"y")),this.z=this.addInPort(new Port(this,"z")),this.x.val=0,this.y.val=0,this.z.val=0;var r=vec3.create();this.render.onTriggered=function(){vec3.set(r,e.x.val,e.y.val,e.z.val),t.pushMvMatrix(),mat4.translate(t.mvMatrix,t.mvMatrix,r),e.trigger.trigger(),t.popMvMatrix()}},Ops.Gl.Matrix.Translate.prototype=new Op,Ops.Gl.Matrix.Scale=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="scale",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.scale=this.addInPort(new Port(this,"scale"));var r=vec3.create(),n=mat4.create();mat4.identity(n);var i=!1;this.render.onTriggered=function(){t.pushMvMatrix(),mat4.multiply(t.mvMatrix,t.mvMatrix,n),e.trigger.trigger(),t.popMvMatrix()};var a=function(){mat4.identity(n),mat4.scale(n,n,r)};this.scaleChanged=function(){i=!1,vec3.set(r,e.scale.get(),e.scale.get(),e.scale.get()),a()},this.scale.onValueChanged=this.scaleChanged,this.scale.val=1,a()},Ops.Gl.Matrix.Scale.prototype=new Op,Ops.Gl.Matrix.LookatCamera=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="LookatCamera",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.centerX=this.addInPort(new Port(this,"centerX")),this.centerY=this.addInPort(new Port(this,"centerY")),this.centerZ=this.addInPort(new Port(this,"centerZ")),this.eyeX=this.addInPort(new Port(this,"eyeX")),this.eyeY=this.addInPort(new Port(this,"eyeY")),this.eyeZ=this.addInPort(new Port(this,"eyeZ")),this.vecUpX=this.addInPort(new Port(this,"upX")),this.vecUpY=this.addInPort(new Port(this,"upY")),this.vecUpZ=this.addInPort(new Port(this,"upZ")),this.centerX.val=0,this.centerY.val=0,this.centerZ.val=0,this.eyeX.val=5,this.eyeY.val=5,this.eyeZ.val=5,this.vecUpX.val=0,this.vecUpY.val=1,this.vecUpZ.val=0;var r=vec3.create(),n=vec3.create(),i=vec3.create(),a=mat4.create();mat4.identity(a),this.render.onTriggered=function(){t.pushMvMatrix(),vec3.set(r,e.vecUpX.val,e.vecUpY.val,e.vecUpZ.val),vec3.set(n,e.eyeX.val,e.eyeY.val,e.eyeZ.val),vec3.set(i,e.centerX.val,e.centerY.val,e.centerZ.val),mat4.lookAt(t.mvMatrix,n,i,r),e.trigger.trigger(),t.popMvMatrix()}},Ops.Gl.Matrix.LookatCamera.prototype=new Op,Ops.Gl.Matrix.Shear=function(){function e(){mat4.identity(n),n[1]=Math.tan(t.shearX.val),n[4]=Math.tan(t.shearY.val)}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="Shear",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.shearX=this.addInPort(new Port(this,"shearX")),this.shearY=this.addInPort(new Port(this,"shearY"));var n=mat4.create();this.shearY.onValueChanged=e,this.shearX.onValueChanged=e,this.render.onTriggered=function(){r.pushMvMatrix(),mat4.multiply(r.mvMatrix,r.mvMatrix,n),t.trigger.trigger(),r.popMvMatrix()},t.shearX.val=0,t.shearY.val=0},Ops.Gl.Matrix.Shear.prototype=new Op,Ops.Gl.Matrix.Transform=function(){function e(){l=!1,(0!==r.posX.get()||0!==r.posY.get()||0!==r.posZ.get())&&(l=!0),vec3.set(i,r.posX.get(),r.posY.get(),r.posZ.get()),d=!1}function t(){s=!1,(0!==r.scaleX.get()||0!==r.scaleY.get()||0!==r.scaleZ.get())&&(s=!0),vec3.set(a,r.scaleX.get(),r.scaleY.get(),r.scaleZ.get()),h=!1}Op.apply(this,arguments);var r=this,n=r.patch.cgl;this.name="transform",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.posX=this.addInPort(new Port(this,"posX")),this.posY=this.addInPort(new Port(this,"posY")),this.posZ=this.addInPort(new Port(this,"posZ")),this.scaleX=this.addInPort(new Port(this,"scaleX")),this.scaleY=this.addInPort(new Port(this,"scaleY")),this.scaleZ=this.addInPort(new Port(this,"scaleZ")),this.rotX=this.addInPort(new Port(this,"rotX")),this.rotY=this.addInPort(new Port(this,"rotY")),this.rotZ=this.addInPort(new Port(this,"rotZ"));var i=vec3.create(),a=vec3.create(),o=mat4.create();mat4.identity(o);var s=!1,l=!1,d=!0,h=!0,u=!0;this.render.onTriggered=function(){var i=!1;d&&(e(),i=!0),h&&(t(),i=!0),u&&(i=!0),i&&g(),n.pushMvMatrix(),mat4.multiply(n.mvMatrix,n.mvMatrix,o),r.trigger.trigger(),n.popMvMatrix()};var g=function(){mat4.identity(o),l&&mat4.translate(o,o,i),0!==r.rotX.get()&&mat4.rotateX(o,o,r.rotX.get()*CGL.DEG2RAD),0!==r.rotY.get()&&mat4.rotateY(o,o,r.rotY.get()*CGL.DEG2RAD),0!==r.rotZ.get()&&mat4.rotateZ(o,o,r.rotZ.get()*CGL.DEG2RAD),s&&mat4.scale(o,o,a),u=!1};this.translateChanged=function(){d=!0},this.scaleChanged=function(){h=!0},this.rotChanged=function(){u=!0},this.rotX.onValueChanged=this.rotChanged,this.rotY.onValueChanged=this.rotChanged,this.rotZ.onValueChanged=this.rotChanged,this.scaleX.onValueChanged=this.scaleChanged,this.scaleY.onValueChanged=this.scaleChanged,this.scaleZ.onValueChanged=this.scaleChanged,this.posX.onValueChanged=this.translateChanged,this.posY.onValueChanged=this.translateChanged,this.posZ.onValueChanged=this.translateChanged,this.rotX.set(0),this.rotY.set(0),this.rotZ.set(0),this.scaleX.set(1),this.scaleY.set(1),this.scaleZ.set(1),this.posX.set(0),this.posY.set(0),this.posZ.set(0),g()},Ops.Gl.Matrix.Transform.prototype=new Op,Ops.Gl.Matrix.MatrixMul=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="matrix",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.matrix=this.addInPort(new Port(this,"matrix"),OP_PORT_TYPE_ARRAY),this.render.onTriggered=function(){t.pushMvMatrix(),mat4.multiply(t.mvMatrix,t.mvMatrix,e.matrix.val),e.trigger.trigger(),t.popMvMatrix()},this.matrix.val=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Ops.Gl.Matrix.MatrixMul.prototype=new Op,Ops.RandomCluster=function(){function e(){t.randoms=[],t.randomsRot=[],t.randomsFloats=[];for(var e=0;e<t.num.get();e++)t.randomsFloats.push(Math.random()),t.randoms.push(vec3.fromValues((Math.random()-.5)*t.size.get(),(Math.random()-.5)*t.size.get(),(Math.random()-.5)*t.size.get())),t.randomsRot.push(vec3.fromValues(360*Math.random()*CGL.DEG2RAD,360*Math.random()*CGL.DEG2RAD,360*Math.random()*CGL.DEG2RAD))}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="random cluster",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.size=this.addInPort(new Port(this,"size")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.rnd=this.addOutPort(new Port(this,"rnd")),this.randoms=[],this.randomsRot=[],this.randomsFloats=[];vec3.create();this.exe.onTriggered=function(){for(var e=0;e<t.randoms.length;e++)r.pushMvMatrix(),mat4.translate(r.mvMatrix,r.mvMatrix,t.randoms[e]),mat4.rotateX(r.mvMatrix,r.mvMatrix,t.randomsRot[e][0]),mat4.rotateY(r.mvMatrix,r.mvMatrix,t.randomsRot[e][1]),mat4.rotateZ(r.mvMatrix,r.mvMatrix,t.randomsRot[e][2]),t.idx.set(e),t.rnd.set(t.randomsFloats[e]),t.trigger.trigger(),r.popMvMatrix()},this.size.set(40),this.num.onValueChanged=e,this.size.onValueChanged=e,this.num.set(100)},Ops.RandomCluster.prototype=new Op,Ops.Gl.Render2Texture=function(){function e(){i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,a),n.width.val=i.getViewPort()[2],n.height.val=i.getViewPort()[3],l&&i.gl.deleteRenderbuffer(l),l=i.gl.createRenderbuffer(),i.gl.bindRenderbuffer(i.gl.RENDERBUFFER,l),i.gl.renderbufferStorage(i.gl.RENDERBUFFER,i.gl.DEPTH_COMPONENT16,n.width.val,n.height.val),i.gl.framebufferTexture2D(i.gl.FRAMEBUFFER,i.gl.COLOR_ATTACHMENT0,i.gl.TEXTURE_2D,o.tex,0),i.gl.framebufferRenderbuffer(i.gl.FRAMEBUFFER,i.gl.DEPTH_ATTACHMENT,i.gl.RENDERBUFFER,l),i.gl.framebufferTexture2D(i.gl.FRAMEBUFFER,i.gl.DEPTH_ATTACHMENT,i.gl.TEXTURE_2D,s.tex,0),i.gl.bindTexture(i.gl.TEXTURE_2D,null),i.gl.bindRenderbuffer(i.gl.RENDERBUFFER,null),i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,null),o.setSize(n.width.val,n.height.val),s.setSize(n.width.val,n.height.val)}function t(){if(i.pushMvMatrix(),i.gl.disable(i.gl.SCISSOR_TEST),n.useVPSize.val&&(o.width!=i.getViewPort()[2]||o.height!=i.getViewPort()[3])){console.log("not the same ? ",o.width,i.getViewPort()[2],o.height,i.getViewPort()[3]);for(var e=0;e<n.patch.ops.length;e++)n.patch.ops[e].onResize&&n.patch.ops[e].onResize()}i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,a),i.pushPMatrix(),i.gl.viewport(0,0,n.width.val,n.height.val),i.gl.clearColor(0,0,0,0),i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT),n.trigger.trigger(),i.popPMatrix(),i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,null),i.popMvMatrix(),i.resetViewPort(),i.gl.enable(i.gl.SCISSOR_TEST)}function r(){t(),n.tex.val.preview()}Op.apply(this,arguments);{var n=this,i=n.patch.cgl;i.gl.getExtension("WEBKIT_WEBGL_depth_texture")||i.gl.getExtension("MOZ_WEBGL_depth_texture")||i.gl.getExtension("WEBGL_depth_texture")}this.name="render to texture",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var a,o=new CGL.Texture(i),s=new CGL.Texture(i,{isDepthTexture:!0});this.useVPSize=this.addInPort(new Port(this,"use viewport size",OP_PORT_TYPE_VALUE,{display:"bool"})),this.width=this.addInPort(new Port(this,"texture width")),this.height=this.addInPort(new Port(this,"texture height")),this.tex=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.texDepth=this.addOutPort(new Port(this,"textureDepth",OP_PORT_TYPE_TEXTURE));var l=null;a=i.gl.createFramebuffer(),n.tex.val=o,n.texDepth.val=s,this.useVPSize.onValueChanged=function(){n.useVPSize.val?(n.width.onValueChanged=null,n.height.onValueChanged=null):(n.width.onValueChanged=e,n.height.onValueChanged=e)},this.width.val=1920,this.height.val=1080,this.useVPSize.val=!0;this.onResize=e,this.tex.onPreviewChanged=function(){n.render.onTriggered=n.tex.showPreview?r:t},n.render.onTriggered=t},Ops.Gl.Render2Texture.prototype=new Op,Ops.Gl.Spray=function(){function e(){this.pos=null,this.startPos=null,this.startTime=0,this.lifeTime=0,this.lifeTimePercent=0,this.endTime=0,this.pos=[0,0,0],this.moveVec=[0,0,0],this.idDead=!1,this.update=function(e){var t=e-this.startTime;e>this.endTime&&(this.isDead=!0),this.lifeTimePercent=t/this.lifeTime,this.pos=vec3.fromValues(this.startPos[0]+t*this.moveVec[0],this.startPos[1]+t*this.moveVec[1],this.startPos[2]+t*this.moveVec[2])},this.reAnimate=function(e){this.isDead=!1,
this.startTime=e,this.lifeTime=Math.random()*r.lifetime.val,this.endTime=e+this.lifeTime,this.startPos=vec3.fromValues(.5*Math.random(),.5*Math.random(),.5*Math.random()),this.moveVec=[.2*Math.random(),.2*Math.random(),.2*Math.random()]},this.reAnimate(0)}function t(){i.length=0;for(var t=0;t<r.num.val;t++){var n=new e;n.reAnimate(0),i.push(n)}}Op.apply(this,arguments);var r=this,n=r.patch.cgl;this.name="spray",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.timer=this.addInPort(new Port(this,"time")),this.num=this.addInPort(new Port(this,"num")),this.size=this.addInPort(new Port(this,"size")),this.lifetime=this.addInPort(new Port(this,"lifetime")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.lifeTimePercent=this.addOutPort(new Port(this,"lifeTimePercent"));{var i=[];vec3.create()}this.exe.onTriggered=function(){for(var e=r.timer.val,t=0;t<i.length;t++)i[t].isDead&&i[t].reAnimate(e),i[t].update(e),n.pushMvMatrix(),mat4.translate(n.mvMatrix,n.mvMatrix,i[t].pos),r.idx.val=t,r.lifeTimePercent.val=i[t].lifeTimePercent,r.trigger.trigger(),n.popMvMatrix()},this.num.onValueChanged=t,this.size.onValueChanged=t,this.lifetime.onValueChanged=t,this.num.val=100,t()},Ops.Gl.Spray.prototype=new Op,Ops.Gl.Identity=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="Identity",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){t.pushMvMatrix(),mat4.identity(t.mvMatrix),e.trigger.trigger(),t.popMvMatrix()}},Ops.Gl.Identity.prototype=new Op,Ops.Gl.CanvasSize=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="CanvasSize",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var r=0,n=0;this.exe.onTriggered=function(){t.canvasHeight!=n&&(n=e.height.val=t.canvasHeight),t.canvasWidth!=r&&(r=e.width.val=t.canvasWidth),e.trigger.trigger()}},Ops.Gl.CanvasSize.prototype=new Op,Ops.Gl.ViewPortSize=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="ViewPortSize",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addOutPort(new Port(this,"x",OP_PORT_TYPE_VALUE)),this.y=this.addOutPort(new Port(this,"y",OP_PORT_TYPE_VALUE)),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var r=0,n=0,i=0,a=0;this.exe.onTriggered=function(){t.getViewPort()[0]!=i&&(r=e.x.val=t.getViewPort()[0]),t.getViewPort()[1]!=a&&(n=e.y.val=t.getViewPort()[1]),t.getViewPort()[2]!=n&&(n=e.width.val=t.getViewPort()[2]),t.getViewPort()[3]!=r&&(r=e.height.val=t.getViewPort()[3]),e.trigger.trigger()}},Ops.Gl.ViewPortSize.prototype=new Op,Ops.Gl.Performance=function(){function e(){T=performance.now();var e=performance.now()-u;if(P.push(e),P.shift(),c.push(g),c.shift(),l++,0===h&&(h=Date.now()),Date.now()-h>=1e3){d=l,l=0,s=t.patch.config.glCanvasId+" fps: "+d,h=Date.now();for(var i=0,f=P.length;f>P.length-P.length/3;f--)P[f]>-1&&(p+=P[f],i++),c[f]>-1&&(m+=c[f]);p/=i,m/=i,O="frame: "+Math.round(100*p)/100+" ms",v="child ops: "+Math.round(100*m)/100+" ms ("+Math.round(m/p*100)+"%) uniforms/s: "+CGL.profileUniformCount,_>=1.25&&(v+=" (self: "+Math.round(100*_)/100+" ms) "),CGL.profileUniformCount=0}o.clearRect(0,0,n.width,n.height),o.fillStyle="#222222",o.fillRect(0,0,n.width,n.height),o.fillStyle="#aaaaaa";for(var w=0;512>w;w++)o.fillRect(w,n.height-2.5*P[w],1,2.5*P[w]);for(o.fillStyle="#ffffff",w=0;512>w;w++)o.fillRect(w,n.height-2.5*c[w],1,2.5*c[w]);o.fillStyle="#bbbbbb",o.fillText(s,10,20),o.fillText(O,10,35),o.fillText(v,10,50),x&&(o.fillStyle="#ff8844",o.fillText("has errors!",10,65)),o.restore(),t.textureOut.get()?t.textureOut.get().initTexture(r,a):t.textureOut.set(new CGL.Texture.fromImage(r,a)),u=performance.now(),_=performance.now()-T;var C=performance.now();if(t.trigger.trigger(),g=performance.now()-C,E++,30==E){x=!1;var R=r.gl.getError();R!=r.gl.NO_ERROR&&(x=!0),E=0}}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="Performance",this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var n=document.createElement("canvas");n.id="performance_"+t.patch.config.glCanvasId,n.width=512,n.height=128,n.style.display="block";var i=document.getElementsByTagName("body")[0];i.appendChild(n);var a=document.getElementById(n.id),o=a.getContext("2d"),s="";o.font="13px arial",o.fillStyle="white";for(var l=0,d=0,h=0,u=0,g=0,P=[],c=[],f=0;f<n.width;f++)P[f]=-1,c[f]=-1;var p=0,m=0,O="",v="",T=0,_=0,x=!1,E=0;this.onDelete=function(){document.getElementById(n.id).remove()},t.exe.onTriggered=e,CABLES.UI&&gui.setLayout()},Ops.Gl.Performance.prototype=new Op,Ops.Gl.Shader=Ops.Gl.Shader||{},Ops.Gl.Shader.Shader=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="Shader",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.shader=this.addInPort(new Port(this,"shader",OP_PORT_TYPE_OBJECT)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){e.shader.val&&(t.setShader(e.shader.val),e.shader.val.bindTextures(),e.trigger.trigger(),t.setPreviousShader())},this.render.onTriggered=this.doRender,this.doRender()},Ops.Gl.Shader.Shader.prototype=new Op,Ops.Gl.Shader.ShowNormalsMaterial=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="ShowNormalsMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){t.setShader(n),e.trigger.trigger(),t.setPreviousShader()};var r="".endl()+"precision highp float;".endl()+"varying vec3 norm;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(norm.x,norm.y,norm.z,1.0);".endl()+"   gl_FragColor = col;".endl()+"}",n=new CGL.Shader(t);this.onLoaded=n.compile,n.setSource(n.getDefaultVertexShader(),r),this.render.onTriggered=this.doRender,this.doRender()},Ops.Gl.Shader.ShowNormalsMaterial.prototype=new Op,Ops.Gl.Shader.MatCapMaterial=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="MatCapMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.shaderOut=this.addOutPort(new Port(this,"shader",OP_PORT_TYPE_OBJECT)),this.shaderOut.ignoreValueSerialize=!0,this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureUniform=null,this.textureDiffuse=this.addInPort(new Port(this,"diffuse",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureDiffuseUniform=null,this.textureNormal=this.addInPort(new Port(this,"normal",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureNormalUniform=null,this.normalScale=this.addInPort(new Port(this,"normalScale",OP_PORT_TYPE_VALUE,{display:"range"})),this.normalScale.val=.4,this.normalScaleUniform=null,this.diffuseRepeatX=this.addInPort(new Port(this,"diffuseRepeatX",OP_PORT_TYPE_VALUE)),this.diffuseRepeatY=this.addInPort(new Port(this,"diffuseRepeatY",OP_PORT_TYPE_VALUE)),this.diffuseRepeatX.val=1,this.diffuseRepeatY.val=1,this.diffuseRepeatX.onValueChanged=function(){e.diffuseRepeatXUniform.setValue(e.diffuseRepeatX.val)},this.diffuseRepeatY.onValueChanged=function(){e.diffuseRepeatYUniform.setValue(e.diffuseRepeatY.val)},this.projectCoords=this.addInPort(new Port(this,"projectCoords",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["no","xy","yz"]})),this.projectCoords.val="no",this.projectCoords.onValueChanged=function(){i.removeDefine("DO_PROJECT_COORDS_XY"),i.removeDefine("DO_PROJECT_COORDS_YZ"),"xy"==e.projectCoords.val&&i.define("DO_PROJECT_COORDS_XY"),"yz"==e.projectCoords.val&&i.define("DO_PROJECT_COORDS_YZ")},this.normalRepeatX=this.addInPort(new Port(this,"normalRepeatX",OP_PORT_TYPE_VALUE)),this.normalRepeatY=this.addInPort(new Port(this,"normalRepeatY",OP_PORT_TYPE_VALUE)),this.normalRepeatX.val=1,this.normalRepeatY.val=1,this.normalRepeatX.onValueChanged=function(){e.normalRepeatXUniform.setValue(e.normalRepeatX.val)},this.normalRepeatY.onValueChanged=function(){e.normalRepeatYUniform.setValue(e.normalRepeatY.val)},this.normalScale.onValueChanged=function(){e.normalScaleUniform.setValue(2*e.normalScale.val)},this.texture.onPreviewChanged=function(){e.render.onTriggered=e.texture.showPreview?e.texture.val.preview:e.doRender},this.textureDiffuse.onPreviewChanged=function(){e.render.onTriggered=e.textureDiffuse.showPreview?e.textureDiffuse.val.preview:e.doRender},this.textureNormal.onPreviewChanged=function(){e.render.onTriggered=e.textureNormal.showPreview?e.textureNormal.val.preview:e.doRender},this.texture.onValueChanged=function(){if(e.texture.get()){if(null!==e.textureUniform)return;i.removeUniform("tex"),e.textureUniform=new CGL.Uniform(i,"t","tex",0)}else console.log("TEXTURE REMOVED"),i.removeUniform("tex"),e.textureUniform=null},this.textureDiffuse.onValueChanged=function(){if(e.textureDiffuse.val){if(null!==e.textureDiffuseUniform)return;i.define("HAS_DIFFUSE_TEXTURE"),i.removeUniform("texDiffuse"),e.textureDiffuseUniform=new CGL.Uniform(i,"t","texDiffuse",1)}else i.removeDefine("HAS_DIFFUSE_TEXTURE"),i.removeUniform("texDiffuse"),e.textureDiffuseUniform=null},this.textureNormal.onValueChanged=function(){if(e.textureNormal.val){if(null!==e.textureNormalUniform)return;i.define("HAS_NORMAL_TEXTURE"),i.removeUniform("texNormal"),e.textureNormalUniform=new CGL.Uniform(i,"t","texNormal",2)}else i.removeDefine("HAS_NORMAL_TEXTURE"),i.removeUniform("texNormal"),e.textureNormalUniform=null},this.bindTextures=function(){e.texture.get()&&(t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,e.texture.val.tex)),e.textureDiffuse.val&&(t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.textureDiffuse.val.tex)),e.textureNormal.val&&(t.gl.activeTexture(t.gl.TEXTURE2),t.gl.bindTexture(t.gl.TEXTURE_2D,e.textureNormal.val.tex))},this.doRender=function(){t.setShader(i),e.bindTextures(),e.trigger.trigger(),t.setPreviousShader()};var r="".endl()+"{{MODULES_HEAD}}".endl()+"precision mediump float;".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"varying vec2 texCoord;".endl()+"varying vec3 norm;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform mat4 normalMatrix;".endl()+"varying vec2 vNorm;".endl()+"varying vec3 e;".endl()+"".endl()+"void main()".endl()+"{".endl()+"    texCoord=attrTexCoord;".endl()+"    norm=attrVertNormal;".endl()+"   vec4 pos = vec4( vPosition, 1. );".endl()+"    {{MODULE_VERTEX_POSITION}}".endl()+"    e = normalize( vec3( mvMatrix * pos ) );".endl()+"    vec3 n = normalize( mat3(normalMatrix) * norm );".endl()+"    vec3 r = reflect( e, n );".endl()+"    float m = 2. * sqrt( ".endl()+"        pow(r.x, 2.0)+".endl()+"        pow(r.y, 2.0)+".endl()+"        pow(r.z + 1.0, 2.0)".endl()+"    );".endl()+"    vNorm = r.xy / m + 0.5;".endl()+"   #ifdef DO_PROJECT_COORDS_XY".endl()+"       texCoord=(projMatrix * mvMatrix*pos).xy*0.1;".endl()+"   #endif".endl()+"   #ifdef DO_PROJECT_COORDS_YZ".endl()+"       texCoord=(projMatrix * mvMatrix*pos).yz*0.1;".endl()+"   #endif".endl()+"    gl_Position = projMatrix * mvMatrix * pos;".endl()+"}",n="".endl()+"{{MODULES_HEAD}}".endl()+"precision mediump float;".endl()+"varying vec3 norm;".endl()+"varying vec2 texCoord;".endl()+"uniform sampler2D tex;".endl()+"varying vec2 vNorm;".endl()+"uniform float diffuseRepeatX;".endl()+"uniform float diffuseRepeatY;".endl()+"#ifdef HAS_DIFFUSE_TEXTURE".endl()+"   uniform sampler2D texDiffuse;".endl()+"#endif".endl()+"#ifdef HAS_NORMAL_TEXTURE".endl()+"   uniform sampler2D texNormal;".endl()+"   uniform mat4 normalMatrix;".endl()+"   uniform float normalScale;".endl()+"   uniform float normalRepeatX;".endl()+"   uniform float normalRepeatY;".endl()+"   varying vec3 e;".endl()+"   vec2 vNormt;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec2 vn=vNorm;".endl()+"   #ifdef HAS_NORMAL_TEXTURE".endl()+"       vec3 tnorm=texture2D( texNormal, vec2(texCoord.x*normalRepeatX,texCoord.y*normalRepeatY) ).xyz * 2.0 - 1.0;".endl()+"       tnorm = normalize(tnorm*normalScale);".endl()+"vec3 tangent;".endl()+"vec3 binormal;".endl()+"vec3 c1 = cross(norm, vec3(0.0, 0.0, 1.0));".endl()+"vec3 c2 = cross(norm, vec3(0.0, 1.0, 0.0));".endl()+"if(length(c1)>length(c2)) tangent = c1;".endl()+"    else tangent = c2;".endl()+"tangent = normalize(tangent);".endl()+"binormal = cross(norm, tangent);".endl()+"binormal = normalize(binormal);".endl()+"tnorm=normalize(tangent*tnorm.x + binormal*tnorm.y + norm*tnorm.z);".endl()+"       vec3 n = normalize( mat3(normalMatrix) * (norm+tnorm*normalScale) );".endl()+"       vec3 r = reflect( e, n );".endl()+"       float m = 2. * sqrt( ".endl()+"           pow(r.x, 2.0)+".endl()+"           pow(r.y, 2.0)+".endl()+"           pow(r.z + 1.0, 2.0)".endl()+"       );".endl()+"       vn = r.xy / m + 0.5;".endl()+"vn.t=clamp(vn.t, 0.0, 1.0);".endl()+"vn.s=clamp(vn.s, 0.0, 1.0);".endl()+"    #endif".endl()+"    vec4 col = texture2D( tex, vn );".endl()+"    #ifdef HAS_DIFFUSE_TEXTURE".endl()+"       col = col*texture2D( texDiffuse, vec2(texCoord.x*diffuseRepeatX,texCoord.y*diffuseRepeatY));".endl()+"    #endif".endl()+"    {{MODULE_COLOR}}".endl()+"    gl_FragColor = col;".endl()+"".endl()+"}",i=new CGL.Shader(t);i.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR"]),i.bindTextures=this.bindTextures,this.shaderOut.val=i,this.onLoaded=i.compile,i.setSource(r,n),this.normalScaleUniform=new CGL.Uniform(i,"f","normalScale",e.normalScale.val),this.normalRepeatXUniform=new CGL.Uniform(i,"f","normalRepeatX",e.normalRepeatX.val),this.normalRepeatYUniform=new CGL.Uniform(i,"f","normalRepeatY",e.normalRepeatY.val),this.diffuseRepeatXUniform=new CGL.Uniform(i,"f","diffuseRepeatX",e.diffuseRepeatX.val),this.diffuseRepeatYUniform=new CGL.Uniform(i,"f","diffuseRepeatY",e.diffuseRepeatY.val),this.render.onTriggered=this.doRender,this.doRender()},Ops.Gl.Shader.MatCapMaterial.prototype=new Op,Ops.Gl.Shader.GradientMaterial=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="GradientMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.screenSpace=this.addInPort(new Port(this,"screen space",OP_PORT_TYPE_VALUE,{display:"bool"})),this.screenSpace.val=!1,this.r=this.addInPort(new Port(this,"r1",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g1",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b1",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a1",OP_PORT_TYPE_VALUE,{display:"range"})),this.r2=this.addInPort(new Port(this,"r2",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g2=this.addInPort(new Port(this,"g2",OP_PORT_TYPE_VALUE,{display:"range"})),this.b2=this.addInPort(new Port(this,"b2",OP_PORT_TYPE_VALUE,{display:"range"})),this.a2=this.addInPort(new Port(this,"a2",OP_PORT_TYPE_VALUE,{display:"range"})),this.r3=this.addInPort(new Port(this,"r3",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g3=this.addInPort(new Port(this,"g3",OP_PORT_TYPE_VALUE,{display:"range"})),this.b3=this.addInPort(new Port(this,"b3",OP_PORT_TYPE_VALUE,{display:"range"})),this.a3=this.addInPort(new Port(this,"a3",OP_PORT_TYPE_VALUE,{display:"range"})),this.r.val=.2,this.g.val=.2,this.b.val=.2,this.a.val=1,this.r2.val=.73,this.g2.val=.73,this.b2.val=.73,this.a2.val=1,this.r3.val=1,this.g3.val=1,this.b3.val=1,this.a3.val=1;var r=[],n=[],i=[],a=0,o=0;this.doRender=function(){(a!=t.getViewPort()[2]||o!=t.getViewPort()[3])&&(a=t.getViewPort()[2],o=t.getViewPort()[3]),d.setValue(a),h.setValue(o),t.setShader(l),e.trigger.trigger(),t.setPreviousShader()};var s="".endl()+"precision highp float;".endl()+"varying vec3 norm;".endl()+"varying vec2 texCoord;".endl()+"uniform vec4 colA;".endl()+"uniform vec4 colB;".endl()+"uniform vec4 colC;".endl()+"uniform float width,height;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   #ifdef USE_TEXCOORDS".endl()+"       vec2 coords=texCoord;".endl()+"   #endif".endl()+"   #ifdef USE_FRAGCOORDS".endl()+"       vec2 coords=vec2(gl_FragCoord.x/width,gl_FragCoord.y/height);".endl()+"   #endif".endl()+"   if(coords.y<=0.5)".endl()+"   {".endl()+"       gl_FragColor = vec4(mix(colA, colB, coords.y*2.0));".endl()+"   }".endl()+"   if(coords.y>0.5)".endl()+"   {".endl()+"       gl_FragColor = vec4(mix(colB, colC, (coords.y-0.5)*2.0));".endl()+"   }".endl()+"}",l=new CGL.Shader(t);this.onLoaded=l.compile,l.setSource(l.getDefaultVertexShader(),s),l.define("USE_TEXCOORDS");var d=new CGL.Uniform(l,"f","width",a),h=new CGL.Uniform(l,"f","height",o);this.doRender(),this.r.onValueChanged=this.g.onValueChanged=this.b.onValueChanged=this.a.onValueChanged=function(){r=[e.r.val,e.g.val,e.b.val,e.a.val],e.r.uniform?e.r.uniform.setValue(r):e.r.uniform=new CGL.Uniform(l,"4f","colA",r)},this.r2.onValueChanged=this.g2.onValueChanged=this.b2.onValueChanged=this.a2.onValueChanged=function(){n=[e.r2.val,e.g2.val,e.b2.val,e.a2.val],e.r2.uniform?e.r2.uniform.setValue(n):e.r2.uniform=new CGL.Uniform(l,"4f","colB",n)},this.r3.onValueChanged=this.g3.onValueChanged=this.b3.onValueChanged=this.a3.onValueChanged=function(){i=[e.r3.val,e.g3.val,e.b3.val,e.a3.val],e.r3.uniform?e.r3.uniform.setValue(i):e.r3.uniform=new CGL.Uniform(l,"4f","colC",i)},this.screenSpace.onValueChanged=function(){e.screenSpace.val?(l.define("USE_FRAGCOORDS"),l.removeDefine("USE_TEXCOORDS")):(l.define("USE_TEXCOORDS"),l.removeDefine("USE_FRAGCOORDS"))},this.r3.onValueChanged(),this.r2.onValueChanged(),this.r.onValueChanged(),this.render.onTriggered=this.doRender},Ops.Gl.Shader.GradientMaterial.prototype=new Op,Ops.Gl.Shader.BasicMaterial=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="BasicMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.shaderOut=this.addOutPort(new Port(this,"shader",OP_PORT_TYPE_OBJECT)),this.shaderOut.ignoreValueSerialize=!0,this.bindTextures=function(){e.texture.get()&&(t.gl.activeTexture(t.gl.TEXTURE0),t.gl.bindTexture(t.gl.TEXTURE_2D,e.texture.val.tex)),e.textureOpacity.get()&&(t.gl.activeTexture(t.gl.TEXTURE1),t.gl.bindTexture(t.gl.TEXTURE_2D,e.textureOpacity.val.tex))},this.doRender=function(){t.setShader(i),i.bindTextures(),e.trigger.trigger(),t.setPreviousShader()};var r="".endl()+"{{MODULES_HEAD}}".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"varying vec2 texCoord;".endl()+"varying vec3 norm;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform mat4 normalMatrix;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   norm=attrVertNormal;".endl()+"{{MODULE_VERTEX_POSITION}}".endl()+"#ifdef BILLBOARD".endl()+"   vec3 position=vPosition;".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(( ".endl()+"       position.x * vec3(".endl()+"           mvMatrix[0][0],".endl()+"           mvMatrix[1][0], ".endl()+"           mvMatrix[2][0] ) +".endl()+"       position.y * vec3(".endl()+"           mvMatrix[0][1],".endl()+"           mvMatrix[1][1], ".endl()+"           mvMatrix[2][1]) ), 1.0);".endl()+"#endif ".endl()+"".endl()+"#ifndef BILLBOARD".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);".endl()+"#endif ".endl()+"}",n="".endl()+"precision mediump float;".endl()+"{{MODULES_HEAD}}".endl()+"#ifdef HAS_TEXTURES".endl()+"   varying vec2 texCoord;".endl()+"   #ifdef HAS_TEXTURE_DIFFUSE".endl()+"       uniform sampler2D tex;".endl()+"   #endif".endl()+"   #ifdef HAS_TEXTURE_OPACITY".endl()+"       uniform sampler2D texOpacity;".endl()+"   #endif".endl()+"#endif".endl()+"uniform float r;".endl()+"uniform float g;".endl()+"uniform float b;".endl()+"uniform float a;".endl()+"".endl()+"void main()".endl()+"{".endl()+"#ifdef HAS_TEXTURES".endl()+"   vec2 texCoords=texCoord;".endl()+"#endif".endl()+"{{MODULE_BEGIN_FRAG}}".endl()+"   vec4 col=vec4(r,g,b,a);".endl()+"   #ifdef HAS_TEXTURES".endl()+"      #ifdef HAS_TEXTURE_DIFFUSE".endl()+"          col=texture2D(tex,vec2(texCoords.x,1.0-texCoords.y));".endl()+"           #ifdef COLORIZE_TEXTURE".endl()+"               col.r*=r;".endl()+"               col.g*=g;".endl()+"               col.b*=b;".endl()+"           #endif".endl()+"      #endif".endl()+"      #ifdef HAS_TEXTURE_OPACITY".endl()+"          col.a*=texture2D(texOpacity,texCoords).g;".endl()+"       #endif".endl()+"       col.a*=a;".endl()+"   #endif".endl()+"{{MODULE_COLOR}}".endl()+"   gl_FragColor = col;".endl()+"}",i=new CGL.Shader(t);i.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]),i.bindTextures=this.bindTextures,this.shaderOut.val=i,this.onLoaded=i.compile,i.setSource(r,n),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.r.onValueChanged=function(){e.r.uniform?e.r.uniform.setValue(e.r.get()):e.r.uniform=new CGL.Uniform(i,"f","r",e.r.get())},this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.g.onValueChanged=function(){e.g.uniform?e.g.uniform.setValue(e.g.get()):e.g.uniform=new CGL.Uniform(i,"f","g",e.g.get())},this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.b.onValueChanged=function(){e.b.uniform?e.b.uniform.setValue(e.b.get()):e.b.uniform=new CGL.Uniform(i,"f","b",e.b.get())},this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.a.onValueChanged=function(){e.a.uniform?e.a.uniform.setValue(e.a.get()):e.a.uniform=new CGL.Uniform(i,"f","a",e.a.get())},this.r.val=Math.random(),this.g.val=Math.random(),this.b.val=Math.random(),this.a.val=1,this.render.onTriggered=this.doRender,this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureUniform=null,this.texture.onPreviewChanged=function(){e.render.onTriggered=e.texture.showPreview?e.texture.val.preview:e.doRender,console.log("show preview!")},this.texture.onValueChanged=function(){if(e.texture.get()){if(null!==e.textureUniform)return;i.removeUniform("tex"),i.define("HAS_TEXTURE_DIFFUSE"),e.textureUniform=new CGL.Uniform(i,"t","tex",0)}else i.removeUniform("tex"),i.removeDefine("HAS_TEXTURE_DIFFUSE"),e.textureUniform=null},this.textureOpacity=this.addInPort(new Port(this,"textureOpacity",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureOpacityUniform=null,this.textureOpacity.onPreviewChanged=function(){e.render.onTriggered=e.textureOpacity.showPreview?e.textureOpacity.val.preview:e.doRender,console.log("show preview!")},this.textureOpacity.onValueChanged=function(){if(e.textureOpacity.get()){if(null!==e.textureOpacityUniform)return;console.log("TEXTURE OPACITY ADDED"),i.removeUniform("texOpacity"),i.define("HAS_TEXTURE_OPACITY"),e.textureOpacityUniform=new CGL.Uniform(i,"t","texOpacity",1)}else console.log("TEXTURE OPACITY REMOVED"),i.removeUniform("texOpacity"),i.removeDefine("HAS_TEXTURE_OPACITY"),e.textureOpacityUniform=null},this.colorizeTexture=this.addInPort(new Port(this,"colorizeTexture",OP_PORT_TYPE_VALUE,{display:"bool"})),this.colorizeTexture.val=!1,this.colorizeTexture.onValueChanged=function(){e.colorizeTexture.val?i.define("COLORIZE_TEXTURE"):i.removeDefine("COLORIZE_TEXTURE")},this.doBillboard=this.addInPort(new Port(this,"billboard",OP_PORT_TYPE_VALUE,{display:"bool"})),this.doBillboard.val=!1,this.doBillboard.onValueChanged=function(){e.doBillboard.val?i.define("BILLBOARD"):i.removeDefine("BILLBOARD")},this.doRender()},Ops.Gl.Shader.BasicMaterial.prototype=new Op,Ops.Gl.Shader.TextureSinusWobble=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="texture sinus wobble",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){t.setShader(n),e.texture.get()&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,e.texture.val.tex)),e.trigger.trigger(),t.setPreviousShader()};var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"   varying vec2 texCoord;".endl()+"   #ifdef HAS_TEXTURE_DIFFUSE".endl()+"       uniform sampler2D tex;".endl()+"   #endif".endl()+"#endif".endl()+"uniform float a;".endl()+"uniform float time;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1,1,1,a);".endl()+"   #ifdef HAS_TEXTURES".endl()+"      #ifdef HAS_TEXTURE_DIFFUSE".endl()+"           float x=texCoord.x+sin(time+texCoord.y*(3.0))*0.15 ;".endl()+"           float y=texCoord.y+sin(time+texCoord.x*(3.0))*0.15 ;".endl()+"           vec2 tc=vec2(x,y );".endl()+"          col=texture2D(tex,tc);".endl()+"      #endif".endl()+"       col.a*=a;".endl()+"   #endif".endl()+"gl_FragColor = col;".endl()+"}",n=new CGL.Shader(t);this.onLoaded=n.compile,n.setSource(n.getDefaultVertexShader(),r),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.a.onValueChanged=function(){e.a.uniform?e.a.uniform.setValue(e.a.val):e.a.uniform=new CGL.Uniform(n,"f","a",e.a.val)},this.a.val=1,this.time=this.addInPort(new Port(this,"time",OP_PORT_TYPE_VALUE,{})),this.time.onValueChanged=function(){e.time.uniform?e.time.uniform.setValue(e.time.val):e.time.uniform=new CGL.Uniform(n,"f","time",e.a.val)},this.time.val=1,this.render.onTriggered=this.doRender,this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.textureUniform=null,this.texture.onValueChanged=function(){if(e.texture.get()){if(null!==e.textureUniform)return;n.removeUniform("tex"),n.define("HAS_TEXTURE_DIFFUSE"),e.textureUniform=new CGL.Uniform(n,"t","tex",0)}else n.removeUniform("tex"),n.removeDefine("HAS_TEXTURE_DIFFUSE"),e.textureUniform=null},this.doRender()},Ops.Gl.Shader.TextureSinusWobble.prototype=new Op,Ops.Gl.Meshes=Ops.Gl.Meshes||{},Ops.Gl.Meshes.Triangle=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Triangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){e.mesh.render(t.getShader()),e.trigger.trigger()};var r=new CGL.Geometry;r.vertices=[0,1,0,-1,-1,0,1,-1,0],r.verticesIndices=[0,1,2],this.mesh=new CGL.Mesh(t,r)},Ops.Gl.Meshes.Triangle.prototype=new Op,Ops.Gl.Meshes.Rectangle=function(){function e(){var e=0,i=0;"center"==t.pivotX.get()&&(e=0),"right"==t.pivotX.get()&&(e=-t.width.get()/2),"left"==t.pivotX.get()&&(e=+t.width.get()/2),"center"==t.pivotY.get()&&(i=0),"top"==t.pivotY.get()&&(i=-t.height.get()/2),"bottom"==t.pivotY.get()&&(i=+t.height.get()/2),n.vertices=[t.width.get()/2+e,t.height.get()/2+i,0,-t.width.get()/2+e,t.height.get()/2+i,0,t.width.get()/2+e,-t.height.get()/2+i,0,-t.width.get()/2+e,-t.height.get()/2+i,0],n.texCoords=[1,0,0,0,1,1,0,1],n.verticesIndices=[0,1,2,2,1,3],t.mesh||(t.mesh=new CGL.Mesh(r,n)),t.mesh.setGeom(n)}Op.apply(this,arguments);var t=this,r=this.patch.cgl;this.name="rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.width=this.addInPort(new Port(this,"width")),this.height=this.addInPort(new Port(this,"height")),this.pivotX=this.addInPort(new Port(this,"pivot x",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["center","left","right"]})),this.pivotX.val="center",this.pivotY=this.addInPort(new Port(this,"pivot y",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["center","top","bottom"]})),this.pivotY.val="center",this.width.val=1,this.height.val=1,this.render.onTriggered=function(){t.mesh.render(r.getShader()),t.trigger.trigger()};var n=new CGL.Geometry;this.mesh=null,e(),this.pivotX.onValueChanged=e,this.pivotY.onValueChanged=e,this.width.onValueChanged=e,this.height.onValueChanged=e},Ops.Gl.Meshes.Rectangle.prototype=new Op,Ops.Gl.Meshes.FullscreenRectangle=function(){function e(){var e=r.getViewPort().slice();i=e[0],a=e[1],o=e[2],h=e[3];var s=0,l=0;n.vertices=[s+o,l+h,0,s,l+h,0,s+o,l,0,s,l,0],n.texCoords=[1,1,0,1,1,0,0,0],n.verticesIndices=[0,1,2,3,1,2],t.mesh?t.mesh.setGeom(n):t.mesh=new CGL.Mesh(r,n)}Op.apply(this,arguments);var t=this,r=this.patch.cgl;this.name="fullscreen rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null;var n=new CGL.Geometry,i=0,a=0,o=0;this.render.onTriggered=function(){(r.getViewPort()[2]!=o||r.getViewPort()[3]!=h)&&e(),r.pushPMatrix(),mat4.identity(r.pMatrix),mat4.ortho(r.pMatrix,0,o,h,0,-10,1e3),r.pushMvMatrix(),mat4.identity(r.mvMatrix),t.mesh.render(r.getShader()),r.gl.clear(r.gl.DEPTH_BUFFER_BIT),r.popPMatrix(),r.popMvMatrix(),t.trigger.trigger()},this.onResize=this.rebuild},Ops.Gl.Meshes.FullscreenRectangle.prototype=new Op,Ops.Gl.Meshes.Circle=function(){function e(){n.clear();var e=0,r=0,a=0,o=0,s=0,l=0,d=0,h=0,u=0,g=0,P=0,c=0,f=0,p=0;if(t.innerRadius.get()<=0)for(e=0;e<=t.segments.get()*t.percent.get();e++)r=360/t.segments.get()*e*CGL.DEG2RAD,f=Math.cos(r)*t.radius.get(),p=Math.sin(r)*t.radius.get(),P=(Math.cos(r)+1)/2,c=(Math.sin(r)+1)/2,n.addFace([f,p,0],[a,o,0],[0,0,0]),n.texCoords.push(P,c,s,l,.5,.5),s=P,l=c,a=f,o=p;else{var m=0;for(e=0;e<=t.segments.get()*t.percent.get();e++){m++,r=360/t.segments.get()*e*CGL.DEG2RAD,f=Math.cos(r)*t.radius.get(),p=Math.sin(r)*t.radius.get();var O=Math.cos(r)*t.innerRadius.get()*t.radius.get(),v=Math.sin(r)*t.innerRadius.get()*t.radius.get();P=(Math.cos(r)+1)/2,c=(Math.sin(r)+1)/2;var T=(Math.cos(r)+1)/2*t.innerRadius.get(),_=(Math.sin(r)+1)/2*t.innerRadius.get();(0===t.steps.get()||m%parseInt(t.steps.get(),10)===0&&!t.invertSteps.get()||m%parseInt(t.steps.get(),10)!==0&&t.invertSteps.get())&&(n.addFace([f,p,0],[a,o,0],[O,v,0]),n.addFace([O,v,0],[a,o,0],[d,h,0]),n.texCoords.push(P,c,s,l,T,_),n.texCoords.push(T,_,s,l,u,g)),u=T,g=_,s=P,l=c,a=f,o=p,d=O,h=v}}i.setGeom(n)}Op.apply(this,arguments);var t=this,r=this.patch.cgl;this.name="Circle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.segments=this.addInPort(new Port(this,"segments")),this.radius=this.addInPort(new Port(this,"radius")),this.innerRadius=this.addInPort(new Port(this,"innerRadius",OP_PORT_TYPE_VALUE,{display:"range"})),this.percent=this.addInPort(new Port(this,"percent")),this.steps=this.addInPort(new Port(this,"steps",OP_PORT_TYPE_VALUE,{type:"int"})),this.steps.val=0,this.invertSteps=this.addInPort(new Port(this,"invertSteps",OP_PORT_TYPE_VALUE,{display:"bool"})),this.invertSteps.val=!1,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){i.render(r.getShader()),t.trigger.trigger()},this.segments.val=40,this.radius.val=1,this.innerRadius.val=0,this.percent.val=1;var n=new CGL.Geometry,i=new CGL.Mesh(r,n);this.segments.onValueChanged=e,this.radius.onValueChanged=e,this.innerRadius.onValueChanged=e,this.percent.onValueChanged=e,this.steps.onValueChanged=e,this.invertSteps.onValueChanged=e,e()},Ops.Gl.Meshes.Circle.prototype=new Op,Ops.Gl.Meshes.ObjMesh=function(){
Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="OBJ Mesh",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.calcNormals=this.addInPort(new Port(this,"calcNormals",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["no","face","vertex"]})),this.calcNormals.val="no",this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:"mesh"})),this.mesh=null,this.render.onTriggered=function(){e.mesh&&e.mesh.render(t.getShader()),e.trigger.trigger()};var r=function(){return CGL.incrementLoadingAssets(),0===e.filename.val?void CGL.decrementLoadingAssets():void ajaxRequest(e.patch.getFilePath(e.filename.val),function(r){console.log("parse obj");var n=parseOBJ(r);unwrap=function(e,t,r){for(var n=new Array(Math.floor(e.length/3)*r),i=0;i<e.length;i++)for(var a=0;r>a;a++)n[i*r+a]=t[e[i]*r+a];return n};var i=n.verticesIndices.length;n.vertices=unwrap(n.verticesIndices,n.vertices,3),n.texCoords=unwrap(n.texCoordsIndices,n.texCoords,2),n.vertexNormals=unwrap(n.vertexNormalIndices,n.vertexNormals,3),n.verticesIndices=[];for(var a=0;i>a;a++)n.verticesIndices.push(a);"face"==e.calcNormals.val?n.calcNormals():"vertex"==e.calcNormals.val&&n.calcNormals(!0),e.mesh=new CGL.Mesh(t,n),CGL.decrementLoadingAssets()})};this.filename.onValueChanged=r,this.calcNormals.onValueChanged=function(){r()}},Ops.Gl.Meshes.ObjMesh.prototype=new Op,Ops.Gl.Meshes.Cube=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="Cube",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null,this.render.onTriggered=function(){null!==e.mesh&&e.mesh.render(t.getShader()),e.trigger.trigger()};var r=new CGL.Geometry;r.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],r.texCoords=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],r.vertexNormals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],r.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],this.mesh=new CGL.Mesh(t,r)},Ops.Gl.Meshes.Cube.prototype=new Op,Ops.Gl.Meshes.Spline=function(){function e(){t.subDivs.val;if(t.centerpoint.val){for(var e=[],i=0;i<r.frameStore.SplinePoints.length;i+=3)e.push(r.frameStore.SplinePoints[0]),e.push(r.frameStore.SplinePoints[1]),e.push(r.frameStore.SplinePoints[2]),e.push(r.frameStore.SplinePoints[i+0]),e.push(r.frameStore.SplinePoints[i+1]),e.push(r.frameStore.SplinePoints[i+2]);r.frameStore.SplinePoints=e}r.gl.lineWidth(t.thickness.val),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,n),r.gl.bufferData(r.gl.ARRAY_BUFFER,new Float32Array(r.frameStore.SplinePoints),r.gl.STATIC_DRAW),n.itemSize=3,n.numItems=r.frameStore.SplinePoints.length/n.itemSize}Op.apply(this,arguments);var t=this,r=t.patch.cgl;r.frameStore.SplinePoints=[],this.name="Spline",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.thickness=this.addInPort(new Port(this,"thickness",OP_PORT_TYPE_VALUE)),this.thickness.val=1,this.subDivs=this.addInPort(new Port(this,"subDivs",OP_PORT_TYPE_VALUE)),this.centerpoint=this.addInPort(new Port(this,"centerpoint",OP_PORT_TYPE_VALUE,{display:"bool"})),this.centerpoint.val=!1,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.triggerPoints=this.addOutPort(new Port(this,"triggerPoints",OP_PORT_TYPE_FUNCTION));var n=r.gl.createBuffer();this.render.onTriggered=function(){t.trigger.trigger(),e(),r.pushMvMatrix(),mat4.identity(r.mvMatrix),r.getShader().bind(),r.gl.vertexAttribPointer(r.getShader().getAttrVertexPos(),n.itemSize,r.gl.FLOAT,!1,0,0),r.gl.enableVertexAttribArray(r.getShader().getAttrVertexPos()),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,n),t.centerpoint.val?r.gl.drawArrays(r.gl.LINES,0,n.numItems):r.gl.drawArrays(r.gl.LINE_STRIP,0,n.numItems);for(var i=0;i<r.frameStore.SplinePoints.length;i+=3){var a=[0,0,0];vec3.set(a,r.frameStore.SplinePoints[i+0],r.frameStore.SplinePoints[i+1],r.frameStore.SplinePoints[i+2]),r.pushMvMatrix(),mat4.translate(r.mvMatrix,r.mvMatrix,a),t.triggerPoints.trigger(),r.popMvMatrix()}r.popMvMatrix(),r.frameStore.SplinePoints.length=0},e()},Ops.Gl.Meshes.Spline.prototype=new Op,Ops.Gl.Meshes.SplinePoint=function(){Op.apply(this,arguments);var e=this,t=e.patch.cgl;this.name="SplinePoint",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){if(t.frameStore.SplinePoints){var r=[0,0,0];vec3.transformMat4(r,[0,0,0],t.mvMatrix),t.frameStore.SplinePoints.push(r[0]),t.frameStore.SplinePoints.push(r[1]),t.frameStore.SplinePoints.push(r[2]),e.trigger.trigger()}}},Ops.Gl.Meshes.SplinePoint.prototype=new Op,Ops.Gl.Meshes.TransformToGeometryVertices=function(){Op.apply(this,arguments);var e=this,t=this.patch.cgl;this.name="TransformToGeometryVertices",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.geometry=this.addInPort(new Port(this,"geometry",OP_PORT_TYPE_OBJECT)),this.geometry.ignoreValueSerialize=!0,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addOutPort(new Port(this,"x",OP_PORT_TYPE_VALUE)),this.y=this.addOutPort(new Port(this,"y",OP_PORT_TYPE_VALUE)),this.z=this.addOutPort(new Port(this,"z",OP_PORT_TYPE_VALUE)),this.index=this.addOutPort(new Port(this,"index",OP_PORT_TYPE_VALUE));var r=[0,0,0];this.render.onTriggered=function(){if(e.geometry.val)for(var n=0;n<e.geometry.val.vertices.length;n+=3)vec3.set(r,e.geometry.val.vertices[n+0],e.geometry.val.vertices[n+1],e.geometry.val.vertices[n+2]),e.x.val=e.geometry.val.vertices[n+0],e.y.val=e.geometry.val.vertices[n+1],e.z.val=e.geometry.val.vertices[n+2],e.index.val=n,t.pushMvMatrix(),mat4.translate(t.mvMatrix,t.mvMatrix,r),e.trigger.trigger(),t.popMvMatrix()}},Ops.Gl.Meshes.TransformToGeometryVertices.prototype=new Op,Ops.Gl.ShaderEffects=Ops.Gl.ShaderEffects||{},Ops.Gl.ShaderEffects.TextureShiftGlitch=function(){function e(){o&&d&&(o.removeModule(d),o=null)}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="TextureShiftGlitch",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.pos=this.addInPort(new Port(this,"pos",OP_PORT_TYPE_VALUE,{display:"range"})),this.height=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE,{display:"range"})),this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE,{display:"range"})),this.extrude=this.addInPort(new Port(this,"extrude",OP_PORT_TYPE_VALUE)),this.pos.onValueChanged=function(){n&&n.setValue(t.pos.val)},this.height.onValueChanged=function(){i&&i.setValue(t.height.val)},this.width.onValueChanged=function(){a&&a.setValue(t.width.val)};var n,i,a,o=null,s="".endl()+"uniform float {{mod}}_pos;".endl()+"uniform float {{mod}}_height;".endl()+"uniform float {{mod}}_width;".endl(),l="".endl()+"   if( texCoords.y > {{mod}}_pos - {{mod}}_height*0.5 && texCoords.y<{{mod}}_pos+{{mod}}_height*0.5) texCoords.x+={{mod}}_width; ".endl(),d=null;this.render.onLinkChanged=e,this.render.onTriggered=function(){r.getShader()!=o&&(o&&e(),o=r.getShader(),d=o.addModule({name:"MODULE_BEGIN_FRAG",srcHeadFrag:s,srcBodyFrag:l}),n=new CGL.Uniform(o,"f",d.prefix+"_pos",t.pos.val),i=new CGL.Uniform(o,"f",d.prefix+"_height",t.height.val),a=new CGL.Uniform(o,"f",d.prefix+"_width",t.width.val)),t.trigger.trigger()}},Ops.Gl.ShaderEffects.TextureShiftGlitch.prototype=new Op,Ops.Gl.ShaderEffects.VertexSinusWobble=function(){function e(){a&&(n.toAxisX.val?a.define(module.prefix+"_TO_AXIS_X"):a.removeDefine(module.prefix+"_TO_AXIS_X"),n.toAxisY.val?a.define(module.prefix+"_TO_AXIS_Y"):a.removeDefine(module.prefix+"_TO_AXIS_Y"),n.toAxisZ.val?a.define(module.prefix+"_TO_AXIS_Z"):a.removeDefine(module.prefix+"_TO_AXIS_Z"))}function t(){a&&module&&(a.removeModule(module),a=null)}Op.apply(this,arguments);var r,n=this,i=n.patch.cgl,a=null;this.name="VertexSinusWobble",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.frequency=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE));var o=null;this.frequency.val=1,this.frequency.onValueChanged=function(){o&&o.setValue(n.frequency.val)},this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE));var s=null;this.amount.val=1,this.amount.onValueChanged=function(){s&&s.setValue(n.amount.val)},this.phase=this.addInPort(new Port(this,"phase",OP_PORT_TYPE_VALUE));var l=null;this.phase.val=1,this.phase.onValueChanged=function(){s&&s.setValue(n.phase.val)},this.toAxisX=this.addInPort(new Port(this,"axisX",OP_PORT_TYPE_VALUE,{display:"bool"})),this.toAxisX.val=!0,this.toAxisX.onValueChanged=e,this.toAxisY=this.addInPort(new Port(this,"axisY",OP_PORT_TYPE_VALUE,{display:"bool"})),this.toAxisY.val=!0,this.toAxisY.onValueChanged=e,this.toAxisZ=this.addInPort(new Port(this,"axisZ",OP_PORT_TYPE_VALUE,{display:"bool"})),this.toAxisZ.val=!0,this.toAxisZ.onValueChanged=e;var d="".endl()+"uniform float {{mod}}_time;".endl()+"uniform float {{mod}}_frequency;".endl()+"uniform float {{mod}}_amount;".endl()+"uniform float {{mod}}_phase;".endl(),h="".endl()+"float {{mod}}_v=sin( (pos.x)*3.0 + {{mod}}_time * {{mod}}_frequency + {{mod}}_phase ) * {{mod}}_amount;".endl()+"#ifdef {{mod}}_TO_AXIS_X".endl()+"   pos.x+={{mod}}_v;".endl()+"#endif".endl()+"#ifdef {{mod}}_TO_AXIS_Y".endl()+"   pos.y+={{mod}}_v;".endl()+"#endif".endl()+"#ifdef {{mod}}_TO_AXIS_Z".endl()+"   pos.z+={{mod}}_v;".endl()+"#endif".endl(),u=Date.now()/1e3;this.render.onLinkChanged=t,this.render.onTriggered=function(){i.getShader()!=a&&(a&&t(),a=i.getShader(),module=a.addModule({name:"MODULE_VERTEX_POSITION",srcHeadVert:d,srcBodyVert:h}),r=new CGL.Uniform(a,"f",module.prefix+"_time",0),o=new CGL.Uniform(a,"f",module.prefix+"_frequency",n.frequency.val),s=new CGL.Uniform(a,"f",module.prefix+"_amount",n.amount.val),l=new CGL.Uniform(a,"f",module.prefix+"_phase",n.phase.val),e()),r.setValue(Date.now()/1e3-u),n.trigger.trigger()}},Ops.Gl.ShaderEffects.VertexSinusWobble.prototype=new Op,Ops.Gl.ShaderEffects.VertexExtrudeGlitch=function(){function e(){console.log("remove module?",s,h),s&&h&&(s.removeModule(h),s=null,console.log("remove module!"))}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="VertexExtrudeGlitch",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.min=this.addInPort(new Port(this,"min",OP_PORT_TYPE_VALUE,{display:"range"})),this.max=this.addInPort(new Port(this,"max",OP_PORT_TYPE_VALUE,{display:"range"})),this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE,{display:"range"})),this.extrude=this.addInPort(new Port(this,"extrude",OP_PORT_TYPE_VALUE)),this.min.onValueChanged=function(){n&&n.setValue(t.min.val)},this.max.onValueChanged=function(){i&&i.setValue(t.max.val)},this.width.onValueChanged=function(){a&&a.setValue(t.width.val)},this.extrude.onValueChanged=function(){o&&o.setValue(t.extrude.val)};var n,i,a,o,s=null,l="".endl()+"uniform float {{mod}}_x;".endl()+"uniform float {{mod}}_y;".endl()+"uniform float {{mod}}_width;".endl()+"uniform float {{mod}}_extrude;".endl(),d="".endl()+"   if(texCoord.x>{{mod}}_x && texCoord.x<{{mod}}_x+{{mod}}_width && texCoord.y>{{mod}}_y && texCoord.y<{{mod}}_y+{{mod}}_width)pos.xyz*={{mod}}_extrude;".endl(),h=null;this.render.onLinkChanged=e,this.render.onTriggered=function(){r.getShader()!=s&&(s&&e(),s=r.getShader(),h=s.addModule({name:"MODULE_VERTEX_POSITION",srcHeadVert:l,srcBodyVert:d}),n=new CGL.Uniform(s,"f",h.prefix+"_x",t.min.val),i=new CGL.Uniform(s,"f",h.prefix+"_y",t.max.val),a=new CGL.Uniform(s,"f",h.prefix+"_width",t.width.val),o=new CGL.Uniform(s,"f",h.prefix+"_extrude",t.extrude.val)),t.trigger.trigger()}},Ops.Gl.ShaderEffects.VertexExtrudeGlitch.prototype=new Op,Ops.Gl.ShaderEffects.VertexGlitch=Ops.Gl.ShaderEffects.VertexExtrudeGlitch,Ops.Gl.ShaderEffects.VertexDisplacementMap=function(){function e(){a&&l&&(a.removeModule(l),a=null)}Op.apply(this,arguments);var t=this,r=t.patch.cgl;this.name="VertexDisplacementMap",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.extrude=this.addInPort(new Port(this,"extrude",OP_PORT_TYPE_VALUE)),this.extrude.onValueChanged=function(){n&&n.setValue(t.extrude.val)};var n,i,a=null,o="".endl()+"uniform float {{mod}}_extrude;".endl()+"uniform sampler2D {{mod}}_texture;".endl(),s="".endl()+"float {{mod}}_texVal=texture2D( {{mod}}_texture, texCoord ).b+1.0;".endl()+"pos.xyz*={{mod}}_texVal * {{mod}}_extrude;".endl(),l=("".endl()+"uniform sampler2D {{mod}}_texture;".endl(),"".endl()+"col=texture2D( {{mod}}_texture, texCoord );".endl(),null);this.render.onLinkChanged=e,this.render.onTriggered=function(){r.getShader()!=a&&(a&&e(),a=r.getShader(),l=a.addModule({name:"MODULE_VERTEX_POSITION",srcHeadVert:o,srcBodyVert:s}),i=new CGL.Uniform(a,"t",l.prefix+"_texture",4),n=new CGL.Uniform(a,"f",l.prefix+"_extrude",t.extrude.val)),t.texture.val&&(r.gl.activeTexture(r.gl.TEXTURE4),r.gl.bindTexture(r.gl.TEXTURE_2D,t.texture.val.tex)),t.trigger.trigger()}},Ops.Gl.ShaderEffects.VertexDisplacementMap.prototype=new Op,Ops.Gl.ShaderEffects.MeshMorphTargets=function(){function e(){o&&module&&(o.removeModule(module),o=null)}function t(){if(r.geometry0.val&&r.geometry1.val){console.log("self.geometry0.val",r.geometry0.val);var e=r.geometry0.val,t=JSON.parse(JSON.stringify(e));console.log("g",t),t.morphTargets[0]=JSON.parse(JSON.stringify(r.geometry1.val.vertices)),console.log("geom.morphTargets[0].length",r.geometry0.val.vertices.length),console.log("geom.morphTargets[0].length",r.geometry1.val.vertices.length),a=new CGL.Mesh(n,t)}else a=null}Op.apply(this,arguments);var r=this,n=this.patch.cgl;this.name="MeshMorphTargets",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.geometry0=this.addInPort(new Port(this,"geometry 0",OP_PORT_TYPE_OBJECT)),this.geometry1=this.addInPort(new Port(this,"geometry 1",OP_PORT_TYPE_OBJECT)),this.fade=this.addInPort(new Port(this,"fade",OP_PORT_TYPE_VALUE,{display:"range"})),this.fade.onValueChanged=function(){i&&i.setValue(r.fade.val)};var i,a=null,o=null,s="".endl()+"attribute vec3 attrMorphTargetA;".endl()+"uniform float {{mod}}_fade;".endl(),l="".endl()+"   pos = vec4( vPosition*{{mod}}_fade+attrMorphTargetA*(1.0-{{mod}}_fade), 1. );".endl();this.render.onLinkChanged=e,this.render.onTriggered=function(){a&&(n.getShader()!=o&&(o&&e(),o=n.getShader(),module=o.addModule({name:"MODULE_VERTEX_POSITION",srcHeadVert:s,srcBodyVert:l}),console.log("morph module inited"),i=new CGL.Uniform(o,"f",module.prefix+"_fade",r.fade.val)),a.render(n.getShader()))},this.geometry0.onValueChanged=t,this.geometry1.onValueChanged=t},Ops.Gl.ShaderEffects.MeshMorphTargets.prototype=new Op,Ops.Gl.Meshes.MorphMesh=Ops.Gl.ShaderEffects.MeshMorphTargets,Ops.Log=function(){Op.apply(this,arguments);var e=this;this.name="logger",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.input=this.addInPort(new Port(this,"input")),this.input.val="",this.exec=function(){console.log("[log] "+e.input.val)},this.exe.onTriggered=this.exec,this.input.onValueChanged=this.exec},Ops.Log.prototype=new Op,Ops.Profiler=function(){Op.apply(this,arguments);var e=this;this.name="Profiler",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.input=this.addInPort(new Port(this,"input")),this.input.val="",this.exec=function(){console.log("[log] "+e.input.val)},this.exe.onTriggered=this.exec,this.input.onValueChanged=this.exec},Ops.Profiler.prototype=new Op,Ops.CallsPerSecond=function(){Op.apply(this,arguments);var e=this;this.name="CallsPerSecond",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.cps=this.addOutPort(new Port(this,"cps",OP_PORT_TYPE_VALUE)),this.timeStart=0,this.cpsCount=0,this.exe.onTriggered=function(){0===e.timeStart&&(e.timeStart=Date.now());var t=Date.now();t-e.timeStart>1e3&&(e.timeStart=Date.now(),e.cps.val=e.cpsCount,e.cpsCount=0),e.cpsCount++}},Ops.CallsPerSecond.prototype=new Op,Ops.Value=function(){Op.apply(this,arguments);var e=this;this.name="Value",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.v=this.addInPort(new Port(this,"value",OP_PORT_TYPE_VALUE)),this.result=this.addOutPort(new Port(this,"result")),this.exec=function(){e.result.val!=e.v.val&&(e.result.val=e.v.val)},this.exe.onTriggered=this.exec,this.v.onValueChanged=this.exec},Ops.Value.prototype=new Op,Ops.Value2d=function(){Op.apply(this,arguments);var e=this;this.name="Value2d",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"value x",OP_PORT_TYPE_VALUE)),this.y=this.addInPort(new Port(this,"value y",OP_PORT_TYPE_VALUE)),this.resultX=this.addOutPort(new Port(this,"result x")),this.resultY=this.addOutPort(new Port(this,"result y")),this.exec=function(){e.resultX.val!=e.x.val&&(e.resultX.val=e.x.val),e.resultY.val!=e.y.val&&(e.resultY.val=e.y.val)},this.exe.onTriggered=this.exec,this.x.onValueChanged=this.exec,this.y.onValueChanged=this.exec},Ops.Value2d.prototype=new Op,Ops.Value3d=function(){Op.apply(this,arguments);var e=this;this.name="Value3d",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"value x",OP_PORT_TYPE_VALUE)),this.y=this.addInPort(new Port(this,"value y",OP_PORT_TYPE_VALUE)),this.z=this.addInPort(new Port(this,"value z",OP_PORT_TYPE_VALUE)),this.resultX=this.addOutPort(new Port(this,"result x")),this.resultY=this.addOutPort(new Port(this,"result y")),this.resultZ=this.addOutPort(new Port(this,"result z")),this.exec=function(){e.resultX.val!=e.x.val&&(e.resultX.val=e.x.val),e.resultY.val!=e.y.val&&(e.resultY.val=e.y.val),e.resultZ.val!=e.z.val&&(e.resultZ.val=e.z.val)},this.exe.onTriggered=this.exec,this.x.onValueChanged=this.exec,this.y.onValueChanged=this.exec,this.z.onValueChanged=this.exec},Ops.Value3d.prototype=new Op,Ops.ColorValue=function(){Op.apply(this,arguments);var e=this;this.name="ColorValue",this.g=this.addInPort(new Port(this,"ignore",OP_PORT_TYPE_FUNCTION,{display:"readonly"})),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.outR=this.addOutPort(new Port(this,"outr",OP_PORT_TYPE_VALUE)),this.outG=this.addOutPort(new Port(this,"outg",OP_PORT_TYPE_VALUE)),this.outB=this.addOutPort(new Port(this,"outb",OP_PORT_TYPE_VALUE)),this.outA=this.addOutPort(new Port(this,"outa",OP_PORT_TYPE_VALUE));var t=function(){e.outR.val=e.r.val,e.outG.val=e.g.val,e.outB.val=e.b.val,e.outA.val=e.a.val};this.r.onValueChanged=t,this.g.onValueChanged=t,this.b.onValueChanged=t,this.a.onValueChanged=t},Ops.ColorValue.prototype=new Op,Ops.TimeLineTime=function(){Op.apply(this,arguments);this.name="TimeLineTime",this.theTime=this.addOutPort(new Port(this,"time")),this.onAnimFrame=function(e){this.theTime.val=e}},Ops.TimeLineTime.prototype=new Op,Ops.TimeLineDelay=function(){Op.apply(this,arguments);var e=this;this.name="TimeLineDelay",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.theTime=this.addOutPort(new Port(this,"time")),this.delay=this.addInPort(new Port(this,"delay")),this.delay.val=0,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.patch.timer.pauseEvents(!0),e.patch.timer.setDelay(e.delay.val),e.theTime.val=e.patch.timer.getTime(),e.trigger.trigger(),e.patch.timer.setDelay(0),e.patch.timer.pauseEvents(!1)}},Ops.TimeLineDelay.prototype=new Op,Ops.TimeLineDelayFrames=function(){Op.apply(this,arguments);var e=this;this.name="TimeLineDelayFrames",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.theTime=this.addOutPort(new Port(this,"time")),this.delay=this.addInPort(new Port(this,"delay")),this.delay.val=0,this.fps=this.addInPort(new Port(this,"fps")),this.fps.val=30,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.patch.timer.setDelay(e.delay.val/e.fps.val),e.theTime.val=e.patch.timer.getTime(),e.trigger.trigger(),e.patch.timer.setDelay(0)}},Ops.TimeLineDelayFrames.prototype=new Op,Ops.TimeLineOverwrite=function(){Op.apply(this,arguments);var e=this;this.name="TimeLineOverwrite",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.newTime=this.addInPort(new Port(this,"new time")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.theTime=this.addOutPort(new Port(this,"time")),this.newTime.val=0;var t=0;this.exe.onTriggered=function(){t=e.patch.timer.getTime(),e.patch.timer.overwriteTime=e.newTime.val,e.trigger.trigger(),e.patch.timer.overwriteTime=-1}},Ops.TimeLineOverwrite.prototype=new Op,Ops.Repeat=function(){Op.apply(this,arguments);var e=this;this.name="Repeat",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.num.val=5,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.exe.onTriggered=function(){for(var t=e.num.get()-1;t>-1;t--)e.idx.set(t),e.trigger.trigger()}},Ops.Repeat.prototype=new Op,Ops.ArrayIterator=function(){Op.apply(this,arguments);var e=this;this.name="ArrayIterator",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.arr=this.addInPort(new Port(this,"array",OP_PORT_TYPE_ARRAY)),this.num=this.addInPort(new Port(this,"num")),this.num.val=5,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.val=this.addOutPort(new Port(this,"value")),this.exe.onTriggered=function(){if(e.arr.val)for(var t in e.arr.val)e.idx.val=t,e.val.val=e.arr.val[t],e.trigger.trigger()}},Ops.ArrayIterator.prototype=new Op,Ops.IfTrueThen=function(){Op.apply(this,arguments);var e=this;this.name="if true then",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.bool=this.addInPort(new Port(this,"boolean")),this.bool.val=!1,this.triggerThen=this.addOutPort(new Port(this,"then",OP_PORT_TYPE_FUNCTION)),this.triggerElse=this.addOutPort(new Port(this,"else",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.bool.val||e.bool.val>=1?e.triggerThen.trigger():e.triggerElse.trigger()}},Ops.IfTrueThen.prototype=new Op,Ops.IfBetweenThen=function(){Op.apply(this,arguments);var e=this;this.name="if between then",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.number=this.addInPort(new Port(this,"number")),this.number.val=0,this.min=this.addInPort(new Port(this,"min")),this.min.val=0,this.max=this.addInPort(new Port(this,"max")),this.max.val=1,this.triggerThen=this.addOutPort(new Port(this,"then",OP_PORT_TYPE_FUNCTION)),this.triggerElse=this.addOutPort(new Port(this,"else",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.number.get()>=e.min.get()&&e.number.get()<e.max.get()?e.triggerThen.trigger():e.triggerElse.trigger()}},Ops.IfBetweenThen.prototype=new Op,Ops.ToggleBool=function(){Op.apply(this,arguments);this.name="ToggleBool",this.bool=this.addInPort(new Port(this,"boolean")),this.bool.val=!1,this.boolOut=this.addOutPort(new Port(this,"result")),this.boolOut.val=!0,this.bool.onValueChanged=function(){this.boolOut=!this.bool.val}},Ops.ToggleBool.prototype=new Op,Ops.Group=function(){Op.apply(this,arguments);var e=this;this.name="group",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.triggers=[];for(var t=0;10>t;t++)this.triggers.push(this.addOutPort(new Port(this,"trigger "+t,OP_PORT_TYPE_FUNCTION)));this.exe.onTriggered=function(){for(var t in e.triggers)e.triggers[t].trigger()},this.uiAttribs.warning='"group" is deprecated, please use "sequence now"'},Ops.Group.prototype=new Op,Ops.Sequence=function(){Op.apply(this,arguments);var e=this;this.name="sequence",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.triggers=[];for(var t=0;10>t;t++)this.triggers.push(this.addOutPort(new Port(this,"trigger "+t,OP_PORT_TYPE_FUNCTION)));this.exe.onTriggered=function(){for(var t=0;t<e.triggers.length;t++)e.triggers[t].trigger()}},Ops.Sequence.prototype=new Op,Ops.TimedSequence=function(){Op.apply(this,arguments);var e=this;this.name="TimedSequence",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.current=this.addInPort(new Port(this,"current",OP_PORT_TYPE_VALUE)),this.current.val=0,this.overwriteTime=this.addInPort(new Port(this,"overwriteTime",OP_PORT_TYPE_VALUE,{display:"bool"})),this.overwriteTime.val=!1,this.ignoreInSubPatch=this.addInPort(new Port(this,"ignoreInSubPatch",OP_PORT_TYPE_VALUE,{display:"bool"})),this.ignoreInSubPatch.val=!1,this.triggerAlways=this.addOutPort(new Port(this,"triggerAlways",OP_PORT_TYPE_FUNCTION)),this.currentKeyTime=this.addOutPort(new Port(this,"currentKeyTime",OP_PORT_TYPE_VALUE));for(var t=[],r=0;30>r;r++)t.push(this.addOutPort(new Port(this,"trigger "+r,OP_PORT_TYPE_FUNCTION)));this.onLoaded=function(){};var n=-1;this.exe.onTriggered=function(r){if(window.gui&&e.current.val!=n){n=parseInt(e.current.val,10);for(var i=0;i<t.length;i++)t[i].setUiActiveState(i==n?!0:!1)}if(e.current.anim){var a=r;void 0===r&&(a=e.current.parent.patch.timer.getTime()),e.currentKeyTime.val=a-e.current.anim.getKey(a).time,e.current.isAnimated()&&e.overwriteTime.val&&(e.current.parent.patch.timer.overwriteTime=e.currentKeyTime.val)}if(e.patch.gui&&e.ignoreInSubPatch.val)for(var o=0;o<t.length;o++)for(var i=0;i<t[o].links.length;i++)if(t[o].links[i]&&t[o].links[i].portIn.parent.patchId&&gui.patch().getCurrentSubPatch()==t[o].links[i].portIn.parent.patchId.val)return e.patch.timer.overwriteTime=-1,void t[o].trigger();var s=Math.round(e.current.val-.5);s>=0&&s<t.length&&t[s].trigger(),e.patch.timer.overwriteTime=-1,e.triggerAlways.trigger()}},Ops.TimedSequence.prototype=new Op,Ops.Interval=function(){Op.apply(this,arguments),this.name="Interval",this.timeOutId=-1,this.interval=this.addInPort(new Port(this,"interval")),this.interval.val=1e3,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exec=function(){if(-1==this.timeOutId){var e=this;this.timeOutId=setTimeout(function(){e.timeOutId=-1,e.trigger.trigger(),e.exec()},this.interval.val)}},this.exec()},Ops.Interval.prototype=new Op,Ops.Anim={},Ops.Anim.SinusAnim=function(){Op.apply(this,arguments),this.name="SinusAnim",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result")),this.phase=this.addInPort(new Port(this,"phase",OP_PORT_TYPE_VALUE)),this.mul=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE)),this.amplitude=this.addInPort(new Port(this,"amplitude",OP_PORT_TYPE_VALUE));var e=this;this.exe.onTriggered=function(){e.result.val=e.amplitude.val*Math.sin(Date.now()/1e3*e.mul.val+parseFloat(e.phase.val))},this.mul.val=1,this.amplitude.val=1,this.phase.val=1,this.exe.onTriggered()},Ops.Anim.SinusAnim.prototype=new Op,Ops.Anim.RelativeTime=function(){Op.apply(this,arguments),this.name="RelativeTime",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var e=this,t=Date.now()/1e3;this.exe.onTriggered=function(){e.result.val=Date.now()/1e3-t},this.exe.onTriggered()},Ops.Anim.RelativeTime.prototype=new Op,Ops.Anim.Frequency=function(){Op.apply(this,arguments),this.name="Frequency",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.frequency=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var e=this,t=0;this.exe.onTriggered=function(){Date.now()-t>e.frequency.val&&(t=Date.now(),e.trigger.trigger())}},Ops.Anim.Frequency.prototype=new Op,Ops.Anim.TimeDiff=function(){Op.apply(this,arguments),this.name="TimeDiff",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var e=this,t=Date.now();this.exe.onTriggered=function(){e.result.val=Date.now()-t,t=Date.now(),e.trigger.trigger()},this.exe.onTriggered()},Ops.Anim.TimeDiff.prototype=new Op;var cableVars={};Ops.Anim.Variable=function(){function e(){cableVars[r.varName.val]=r.val.val,r.result.val=r.val.val}function t(){r.val.val=cableVars[r.varName.val]}var r=this;Op.apply(this,arguments),this.name="Variable",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.varName=this.addInPort(new Port(this,"name")),this.val=this.addInPort(new Port(this,"value")),this.result=this.addOutPort(new Port(this,"result")),this.val.onValueChanged=e,this.varName.onValueChanged=e,this.exe.onTriggered=t},Ops.Anim.Variable.prototype=new Op,Ops.String=Ops.String||{},Ops.String.concat=function(){Op.apply(this,arguments);var e=this;this.name="concat",this.result=this.addOutPort(new Port(this,"result")),this.string1=this.addInPort(new Port(this,"string1",OP_PORT_TYPE_VALUE,{type:"string"})),this.string2=this.addInPort(new Port(this,"string2",OP_PORT_TYPE_VALUE,{type:"string"})),this.exec=function(){e.result.val=e.string1.val+e.string2.val},this.string1.onValueChanged=this.exec,this.string2.onValueChanged=this.exec,this.string1.val="wurst",this.string2.val="tuete"},Ops.String.concat.prototype=new Op,Ops.LoadingStatus=function(){function e(){s.length>0&&i==a&&(i++,o=s[i]),t.preRenderStatus.val=i/s.length,0===s.length||a==s.length-1?(t.onAnimFrame=function(){},CGL.decrementLoadingAssets(),n=!0):setTimeout(e,30)}Op.apply(this,arguments);var t=this,r=this.patch.cgl;this.name="loadingStatus",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.finished=this.addOutPort(new Port(this,"finished",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"status",OP_PORT_TYPE_VALUE)),this.preRenderStatus=this.addOutPort(new Port(this,"preRenderStatus",OP_PORT_TYPE_VALUE)),this.preRenderTimeFrames=this.addInPort(new Port(this,"preRenderTimes",OP_PORT_TYPE_VALUE)),this.preRenderStatus.val=0,this.numAssets=this.addOutPort(new Port(this,"numAssets",OP_PORT_TYPE_VALUE)),this.loading=this.addOutPort(new Port(this,"loading",OP_PORT_TYPE_FUNCTION));var n=!1,i=0,a=0,o=0,s=[],l=!0,d=vec3.create();vec3.set(d,0,0,-2);var h=function(e){t.patch.timer.setTime(o),t.finished.trigger(),Ops.Gl.Renderer.renderStart(r,d),r.gl.clearColor(0,0,0,1),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),t.loading.trigger(),Ops.Gl.Renderer.renderEnd(r),a=i};this.onAnimFrame=function(){},this.exe.onTriggered=function(){if(t.result.val=CGL.getLoadingStatus(),t.numAssets.val=CGL.numMaxLoadingAssets,n||this.onAnimFrame==h||(t.onAnimFrame=h),n)l&&(CGL.incrementLoadingAssets(),console.log("finished loading complete...",CGL.getLoadingStatus()),t.patch.timer.setTime(0),t.patch.timer.play(),CGL.decrementLoadingAssets(),l=!1),t.finished.trigger();else if(t.loading.trigger(),t.patch.timer.pause(),t.result.val>=1||0===CGL.numMaxLoadingAssets){CGL.incrementLoadingAssets();

var r=0;for(r=0;r<t.patch.ops.length;r++)t.patch.ops[r].onLoaded&&t.patch.ops[r].onLoaded();if(t.preRenderTimeFrames.isAnimated())for(r=0;r<t.preRenderTimeFrames.anim.keys.length;r++)s.push(t.preRenderTimeFrames.anim.keys[r].time);s.push(0),e()}}},Ops.LoadingStatus.prototype=new Op,Ops.TriggerCounter=function(){Op.apply(this,arguments);var e=this;this.name="TriggerCounter",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.reset=this.addInPort(new Port(this,"reset",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.num=this.addOutPort(new Port(this,"timesTriggered",OP_PORT_TYPE_VALUE));var t=0;this.exe.onTriggered=function(){t++,e.num.val=t,e.trigger.trigger()},this.reset.onTriggered=function(){t=0,e.num.val=t}},Ops.TriggerCounter.prototype=new Op,Ops.Json=Ops.Json||{},Ops.Json.jsonValue=function(){var e=this;Op.apply(this,arguments),this.name="jsonValue",this.data=this.addInPort(new Port(this,"data",OP_PORT_TYPE_OBJECT)),this.key=this.addInPort(new Port(this,"key")),this.result=this.addOutPort(new Port(this,"result")),this.data.onValueChanged=function(){e.data.val&&e.data.val.hasOwnProperty(e.key.val)&&(e.result.val=e.data.val[e.key.val])}},Ops.Json.jsonValue.prototype=new Op,Ops.Json.jsonFile=function(){var e=this;Op.apply(this,arguments),this.name="jsonFile",this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:"json"})),this.result=this.addOutPort(new Port(this,"result",OP_PORT_TYPE_OBJECT));var t=function(){ajaxRequest(e.patch.getFilePath(e.filename.val),function(t){e.result.val=t,console.log("data",t)})};this.filename.onValueChanged=t},Ops.Json.jsonFile.prototype=new Op,Ops.Json3d=Ops.Json3d||{},Ops.Json3d.json3dFile=function(){function e(){var e=n.frameStore.currentScene;n.frameStore.currentScene=i,r.trigger.trigger(),n.frameStore.currentScene=e}function t(e,n,i,o,s){if(s.hasOwnProperty("transformation")){a=Math.max(e,a);var l=r.uiAttribs.translate.x+130*e;s.children&&s.children.length>1&&(l+=130*(s.children.length+1)/2);var d=r.uiAttribs.translate.y+50*n,h=r.patch.addOp("Ops.Gl.Matrix.MatrixMul",{translate:{x:l,y:d}}),u=s.transformation;mat4.transpose(u,u),h.matrix.val=s.transformation,s.name&&(h.uiAttribs.title=h.name=s.name),s.children&&console.log("ch ",s.name,s.children.length),r.patch.link(i,o,h,"render");var g=0;if(s.hasOwnProperty("meshes"))for(g=0;g<s.meshes.length;g++){var P=s.meshes[g],c=r.patch.addOp("Ops.Json3d.Mesh",{translate:{x:l,y:d+50}});c.index.val=P,c.uiAttribs.title=c.name=h.name+" Mesh",r.patch.link(h,"trigger",c,"render")}if(s.hasOwnProperty("children"))for(n++,g=0;g<s.children.length;g++){var f=a;s.children.length>1&&f++,t(f,n,h,"trigger",s.children[g])}}}Op.apply(this,arguments);var r=this,n=this.patch.cgl;this.name="json3dFile";var i=new CABLES.Variable;n.frameStore.currentScene=null,this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:"json"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=e;var a=-3,o=function(){r.filename.val&&(CGL.incrementLoadingAssets(),CABLES.ajax(r.patch.getFilePath(r.filename.val),function(n,o,s){if(n)return console.log("ajax error:",n),void CGL.decrementLoadingAssets();var l=JSON.parse(o);if(i.setValue(l),!r.trigger.isLinked()){console.log("data.meshes "+l.meshes.length);var d=r.patch.addOp("Ops.Sequence",{translate:{x:r.uiAttribs.translate.x,y:r.uiAttribs.translate.y+50}});r.patch.link(r,"trigger",d,"exe");for(var h=0;h<l.rootnode.children.length;h++)t(a-2,3,d,"trigger 0",l.rootnode.children[h])}e(),CGL.decrementLoadingAssets()}))};this.filename.onValueChanged=o},Ops.Json3d.json3dFile.prototype=new Op,Ops.Json3d.Mesh=function(){function e(){(!i&&n.frameStore.currentScene&&n.frameStore.currentScene.getValue()||a!=r.index.val)&&t(),null!==i&&i.render(n.getShader()),r.trigger.trigger()}function t(){if(n.frameStore.currentScene&&n.frameStore.currentScene.getValue()){r.uiAttr({warning:""}),r.uiAttr({info:""});var e=null;if(a=r.index.val,isNumeric(r.index.val)){if(r.index.val<0||r.index.val>=n.frameStore.currentScene.getValue().meshes.length)return void r.uiAttr({warning:"mesh not found - index out of range "});e=n.frameStore.currentScene.getValue().meshes[parseInt(r.index.val,10)]}else{n.frameStore.currentScene.getValue()}if(!e)return i=null,void r.uiAttr({warning:"mesh not found"});r.uiAttribs.warning="";var t=0,o=JSON.parse(JSON.stringify(e.vertices));if(r.centerPivot.val){var s=[-998999999,-998999999,-998999999],l=[998999999,998999999,998999999];for(t=0;t<o.length;t+=3)s[0]=Math.max(s[0],o[t+0]),s[1]=Math.max(s[1],o[t+1]),s[2]=Math.max(s[2],o[t+2]),l[0]=Math.min(l[0],o[t+0]),l[1]=Math.min(l[1],o[t+1]),l[2]=Math.min(l[2],o[t+2]);console.log("max",s),console.log("min",l);var d=[Math.abs(Math.abs(s[0])-Math.abs(l[0])),Math.abs(Math.abs(s[1])-Math.abs(l[1])),Math.abs(Math.abs(s[2])-Math.abs(l[2]))];for(console.log("off",d),t=0;t<o.length;t+=3)o[t+0]+=d[0],o[t+1]+=d[1],o[t+2]+=d[2];for(s=[-998999999,-998999999,-998999999],l=[998999999,998999999,998999999],t=0;t<o.length;t+=3)s[0]=Math.max(s[0],o[t+0]),s[1]=Math.max(s[1],o[t+1]),s[2]=Math.max(s[2],o[t+2]),l[0]=Math.min(l[0],o[t+0]),l[1]=Math.min(l[1],o[t+1]),l[2]=Math.min(l[2],o[t+2]);console.log("after max",s),console.log("after min",l)}var h=new CGL.Geometry;for(h.calcNormals=!0,h.vertices=o,h.vertexNormals=e.normals,e.texturecoords&&(h.texCoords=e.texturecoords[0]),h.verticesIndices=[],t=0;t<e.faces.length;t++)h.verticesIndices=h.verticesIndices.concat(e.faces[t]);var u="";u+=h.verticesIndices.length+" faces <br/>",u+=h.vertices.length+" vertices <br/>",u+=h.texCoords.length+" texturecoords <br/>",u+=h.vertexNormals.length+" normals <br/>",r.uiAttr({info:u}),r.geometryOut.val=h,i=new CGL.Mesh(n,h)}}Op.apply(this,arguments);var r=this,n=this.patch.cgl;this.name="json3d Mesh",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.index=this.addInPort(new Port(this,"mesh index",OP_PORT_TYPE_VALUE,{type:"string"})),this.centerPivot=this.addInPort(new Port(this,"center pivot",OP_PORT_TYPE_VALUE,{display:"bool"})),this.centerPivot.val=!1,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.geometryOut=this.addOutPort(new Port(this,"geometry",OP_PORT_TYPE_OBJECT)),this.geometryOut.ignoreValueSerialize=!0;var i=null,a=-1;this.render.onTriggered=e,this.centerPivot.onValueChanged=function(){i=null}},Ops.Json3d.Mesh.prototype=new Op,Ops.Math=Ops.Math||{},Ops.Math.Random=function(){var e=this;Op.apply(this,arguments),this.name="random",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result")),this.minusPlusOne=this.addInPort(new Port(this,"0 to x / -x to x ",OP_PORT_TYPE_VALUE,{display:"bool"})),this.max=this.addInPort(new Port(this,"max")),this.exe.onTriggered=function(){e.result.val=e.minusPlusOne.val?Math.random()*e.max.val*2-e.max.val/2:Math.random()*e.max.val},this.exe.onTriggered(),this.max.val=1},Ops.Math.Random.prototype=new Op,Ops.Math.Clamp=function(){function e(){t.updateAnims(),t.result.val=Math.min(Math.max(t.val.val,t.min.val),t.max.val)}var t=this;Op.apply(this,arguments),this.name="Clamp",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=e,this.min.onValueChanged=e,this.max.onValueChanged=e,this.val.val=.5},Ops.Math.Clamp.prototype=new Op,Ops.Math.SmoothStep=function(){function e(){t.updateAnims();var e=Math.max(0,Math.min(1,(t.val.val-t.min.val)/(t.max.val-t.min.val)));t.result.val=e*e*(3-2*e)}var t=this;Op.apply(this,arguments),this.name="SmoothStep",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=e,this.min.onValueChanged=e,this.max.onValueChanged=e,this.val.val=.5},Ops.Math.SmoothStep.prototype=new Op,Ops.Math.SmootherStep=function(){function e(){var e=Math.max(0,Math.min(1,(t.val.val-t.min.val)/(t.max.val-t.min.val)));t.result.val=e*e*e*(e*(6*e-15)+10)}var t=this;Op.apply(this,arguments),this.name="SmootherStep",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=e,this.min.onValueChanged=e,this.max.onValueChanged=e,this.val.val=.5},Ops.Math.SmootherStep.prototype=new Op,Ops.Math.MapRange=function(){Op.apply(this,arguments);var e=this;this.name="map value range",this.result=this.addOutPort(new Port(this,"result")),this.v=this.addInPort(new Port(this,"value")),this.old_min=this.addInPort(new Port(this,"old min")),this.old_max=this.addInPort(new Port(this,"old max")),this.new_min=this.addInPort(new Port(this,"new min")),this.new_max=this.addInPort(new Port(this,"new max")),this.exec=function(){if(e.updateAnims(),e.v.val>e.old_max.val)return void(e.result.val=e.new_max.val);if(e.v.val<e.old_min.val)return void(e.result.val=e.new_min.val);var t=parseFloat(e.new_min.val),r=parseFloat(e.new_max.val),n=parseFloat(e.old_min.val),i=parseFloat(e.old_max.val),a=parseFloat(e.v.val),o=!1,s=Math.min(n,i),l=Math.max(n,i);s!=n&&(o=!0);var d=!1,h=Math.min(t,r),u=Math.max(t,r);h!=t&&(d=!0);var g=0;g=o?(l-a)*(u-h)/(l-s):(a-s)*(u-h)/(l-s),e.result.val=d?u-g:g+h},this.v.val=0,this.old_min.val=-1,this.old_max.val=1,this.new_min.val=0,this.new_max.val=1,this.v.onValueChanged=this.exec,this.old_min.onValueChanged=this.exec,this.old_max.onValueChanged=this.exec,this.new_min.onValueChanged=this.exec,this.new_max.onValueChanged=this.exec,this.exec()},Ops.Math.MapRange.prototype=new Op,Ops.Math.Abs=function(){Op.apply(this,arguments);var e=this;this.name="abs",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){e.result.val=Math.abs(e.number.val)}},Ops.Math.Abs.prototype=new Op,Ops.Math.Sin=function(){Op.apply(this,arguments);var e=this;this.name="Sinus",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){e.result.val=Math.sin(e.number.val)}},Ops.Math.Sin.prototype=new Op,Ops.Math.SmoothStep=function(){function e(){r=t.min.val,n=t.max.val}Op.apply(this,arguments);var t=this;this.name="SmoothStep",this.result=this.addOutPort(new Port(this,"result")),this.number=this.addInPort(new Port(this,"number")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max"));var r=0,n=1;this.exec=function(){var e=t.number.val,i=Math.max(0,Math.min(1,(e-r)/(n-r)));t.result.val=i*i*(3-2*i)},this.min.val=0,this.max.val=1,this.number.val=0,this.number.onValueChanged=this.exec,this.max.onValueChanged=e,this.min.onValueChanged=e,e()},Ops.Math.SmoothStep.prototype=new Op,Ops.Math.Sum=function(){Op.apply(this,arguments);var e=this;this.name="sum",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims();var t=parseFloat(e.number1.get())+parseFloat(e.number2.get());isNaN(t)||e.result.set(t)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.set(1),this.number2.set(1)},Ops.Math.Sum.prototype=new Op,Ops.Math.Subtract=function(){function e(){t.updateAnims();var e=parseFloat(t.number1.get())-parseFloat(t.number2.get());isNaN(e)||t.result.set(e)}Op.apply(this,arguments);var t=this;this.name="subtract",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.number1.onValueChanged=e,this.number2.onValueChanged=e,this.number1.set(1),this.number2.set(1)},Ops.Math.Subtract.prototype=new Op,Ops.Math.Multiply=function(){Op.apply(this,arguments);var e=this;this.name="multiply",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.set(e.number1.get()*e.number2.get())},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.set(1),this.number2.set(2)},Ops.Math.Multiply.prototype=new Op,Ops.Math.Modulo=function(){Op.apply(this,arguments);var e=this;this.name="Modulo",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.pingpong=this.addInPort(new Port(this,"pingpong",OP_PORT_TYPE_VALUE,{display:"bool"}));var t=!1;this.exec=function(){return e.updateAnims(),t?(e.result.val=e.number1.val%e.number2.val*2,void(e.result.val>e.number2.val&&(e.result.val=2*e.number2.val-e.result.val))):void(e.result.val=e.number1.val%e.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=2,this.pingpong.onValueChanged=function(){t=e.pingpong.val}},Ops.Math.Modulo.prototype=new Op,Ops.Math.Divide=function(){Op.apply(this,arguments);var e=this;this.name="Divide",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val/e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Divide.prototype=new Op,Ops.Math.Compare={},Ops.Math.Compare.IsEven=function(){Op.apply(this,arguments);var e=this;this.name="isEven",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.exec=function(){e.result.val=!(1&e.number1.val)},this.number1.onValueChanged=this.exec},Ops.Math.Compare.IsEven.prototype=new Op,Ops.Math.Compare.Greater=function(){Op.apply(this,arguments);var e=this;this.name="Greater",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val>e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Greater.prototype=new Op,Ops.Math.Compare.Between=function(){Op.apply(this,arguments);var e=this;this.name="Between",this.result=this.addOutPort(new Port(this,"result")),this.number=this.addInPort(new Port(this,"value")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.number.val=2,this.number1.val=1,this.number2.val=3,this.exec=function(){e.updateAnims(),e.result.val=e.number.val>Math.min(e.number1.val,e.number2.val)&&e.number.val<Math.max(e.number1.val,e.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number.onValueChanged=this.exec},Ops.Math.Compare.Between.prototype=new Op,Ops.Math.Compare.Lesser=function(){Op.apply(this,arguments);var e=this;this.name="Lesser",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val<e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Lesser.prototype=new Op,Ops.Math.Compare.Equals=function(){Op.apply(this,arguments);var e=this;this.name="Equals",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val==e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Equals.prototype=new Op,Ops.Net=Ops.Net||{},Ops.Net.Websocket=function(){function e(){r.connected.val===!1&&t(),i=setTimeout(e,1e3)}function t(){if(r.connected.val!==!0||a!=r.url.val){r.connected.val===!0&&n.close(),window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket||console.error("Sorry, but your browser doesn't support WebSockets.");try{null!=n&&n.close(),n=new WebSocket(r.url.val)}catch(e){console.log("could not connect to",r.url.val)}n.onerror=function(e){r.connected.val=!1},n.onclose=function(e){r.connected.val=!1},n.onopen=function(e){r.connected.val=!0,a=r.url.val},n.onmessage=function(e){try{var t=JSON.parse(e.data);r.result.val=t}catch(n){return void console.log("This doesn't look like a valid JSON: ",e.data)}}}}var r=this;Op.apply(this,arguments),this.name="Websocket",this.url=this.addInPort(new Port(this,"url",OP_PORT_TYPE_VALUE,{type:"string"})),this.result=this.addOutPort(new Port(this,"result",OP_PORT_TYPE_OBJECT)),this.connected=this.addOutPort(new Port(this,"connected"));var n=null,i=null,a="";this.url.onValueChanged=t,i=setTimeout(e,1e3),this.url.val="ws://127.0.0.1:1337"},Ops.Net.Websocket.prototype=new Op,Ops=Ops||{},Ops.Ui=Ops.Ui||{},Ops.Ui.Comment=function(){Op.apply(this,arguments),this.name="Comment",this.title=this.addInPort(new Port(this,"title")),this.text=this.addInPort(new Port(this,"text"))},Ops.Ui.Comment.prototype=new Op,Ops.Ui.Patch=function(){var e=this;Op.apply(this,arguments),this.name="Patch",this.patchId=this.addInPort(new Port(this,"patchId",OP_PORT_TYPE_VALUE,{display:"readonly"}));var t=function(){for(var t in e.portsIn){if(e.portsIn[t].type==OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==e.portsIn[t].getName())return!0}return!1},r=function(t){for(var r in this.portsIn)if(this.portsIn[r].type==OP_PORT_TYPE_DYNAMIC)return this.portsIn[r].name=t,this.portsIn[r];var n=e.addInPort(new Port(e,t,OP_PORT_TYPE_DYNAMIC));return n.shouldLink=e.shouldLink,n};this.getPort=function(t){for(var n in e.portsIn)if(e.portsIn[n].getName()==t)return e.portsIn[n];var i=r(t);return i};var n=function(){var t=e.patch.getSubPatchOp(e.patchId.val,"Ops.Ui.PatchInput");return t||(console.log("no patchinput!"),e.patch.addOp("Ops.Ui.PatchInput",{subPatch:e.patchId.val}),t=e.patch.getSubPatchOp(e.patchId.val,"Ops.Ui.PatchInput"),t||console.warn("no patchinput2!")),t};this.shouldLink=function(i,a){if(i.type!=OP_PORT_TYPE_DYNAMIC&&a.type!=OP_PORT_TYPE_DYNAMIC)return!0;var o=a,s=i;i.type==OP_PORT_TYPE_DYNAMIC&&(o=i,s=a),o.type=s.type,o.name="in_"+s.getName();var l=n(),d=l.addOutPort(new Port(e,"out_"+s.getName(),o.type));return o.type==OP_PORT_TYPE_FUNCTION?(o.onTriggered=function(){d.trigger()},o.onTriggered()):(o.onValueChanged=function(){d.val=o.val},o.onValueChanged()),CABLES.UI&&gui.patch().updateSubPatches(),t()||r("dyn"),!0},this.patchId.onValueChanged=function(){Ops.Ui.Patch.maxPatchId=Math.max(Ops.Ui.Patch.maxPatchId,e.patchId.val)},this.patchId.val=Ops.Ui.Patch.maxPatchId+1,this.onCreate=function(){t()||r("dyn"),n(),CABLES.UI&&gui.patch().updateSubPatches()},this.onDelete=function(){for(var t=0;t<e.patch.ops.length;t++)e.patch.ops[t].uiAttribs&&e.patch.ops[t].uiAttribs.subPatch==e.patchId.val&&e.patch.deleteOp(e.patch.ops[t].id)}},Ops.Ui.Patch.maxPatchId=0,Ops.Ui.Patch.prototype=new Op,Ops.Ui.PatchInput=function(){var e=this;Op.apply(this,arguments),this.name="PatchInput",this.getPatchOp=function(){for(var t in e.patch.ops)if(e.patch.ops[t].patchId&&e.patch.ops[t].patchId.val==e.uiAttribs.subPatch)return e.patch.ops[t];console.log("NOT FOUND PATCHOP")}},Ops.Ui.PatchInput.prototype=new Op,Ops.Ui.PatchOutput=function(){Op.apply(this,arguments),this.name="PatchOutput",this.patchOutput=this.addInPort(new Port(this,"out"))},Ops.Ui.PatchOutput.prototype=new Op,Ops.Gl.Matrix.WASDCamera=function(){function e(){var e=0,t=0,r=0,n=0,i=0;if(f&&(n=Math.cos(s*o.rotX.val),e+=g*Math.sin(s*o.rotY.val)*n,t+=g*Math.sin(s*o.rotX.val)*-1,i=Math.cos(s*o.rotX.val),r+=g*Math.cos(s*o.rotY.val)*-1*i),m&&(n=Math.cos(s*o.rotX.val),e+=g*Math.sin(s*o.rotY.val)*-1*n,t+=g*Math.sin(s*o.rotX.val),i=Math.cos(s*o.rotX.val),r+=g*Math.cos(s*o.rotY.val)*i),p){var a=s*o.rotY.val;e+=-g*Math.cos(a),r+=-g*Math.sin(a)}if(O){var a=s*o.rotY.val;e+=g*Math.cos(a),r+=g*Math.sin(a)}d=e,h=t,u=r,d>g&&(d=g),-g>d&&(d=-g),h>g&&(h=g),-g>h&&(h=-g),u>g&&(u=g),-g>u&&(u=-g)}function t(e){var t=.1;o.rotX.val+=e.movementY*t,o.rotY.val+=e.movementX*t,o.rotX.val<-90&&(o.rotX.val=-90),o.rotX.val>90&&(o.rotX.val=90),o.rotY.val<-180&&(o.rotY.val+=360),o.rotY.val>180&&(o.rotY.val-=360)}function r(e){document.pointerLockElement===P||document.mozPointerLockElement===P||document.webkitPointerLockElement===P?(document.addEventListener("mousemove",t,!1),document.addEventListener("keydown",i,!1),document.addEventListener("keyup",a,!1),console.log("lock start"),o.isLocked.val=!0):(document.removeEventListener("mousemove",t,!1),document.removeEventListener("keydown",i,!1),document.removeEventListener("keyup",a,!1),o.isLocked.val=!1,f=!1,p=!1,m=!1,O=!1,console.log("lock exit"))}function n(){window.performance.now()-c;o.posX.val+=d,o.posY.val+=h,o.posZ.val+=u,c=window.performance.now()}function i(e){switch(e.which){case 87:f=!0;break;case 65:p=!0;break;case 83:m=!0;break;case 68:O=!0;break;default:console.log("key:",e.which)}}function a(e){switch(console.log("key"),e.which){case 87:f=!1;break;case 65:p=!1;break;case 83:m=!1;break;case 68:O=!1}}Op.apply(this,arguments);var o=this,s=3.14159/180;this.name="WASDCamera",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.isLocked=this.addOutPort(new Port(this,"isLocked",OP_PORT_TYPE_VALUE)),this.isLocked.val=!1;var l=vec3.create(),d=0,h=0,u=0,g=.5;this.posX=this.addInPort(new Port(this,"posX",OP_PORT_TYPE_VALUE)),this.posY=this.addInPort(new Port(this,"posY",OP_PORT_TYPE_VALUE)),this.posZ=this.addInPort(new Port(this,"posZ",OP_PORT_TYPE_VALUE)),this.rotX=this.addInPort(new Port(this,"rotX",OP_PORT_TYPE_VALUE)),this.rotY=this.addInPort(new Port(this,"rotY",OP_PORT_TYPE_VALUE)),this.outPosX=this.addOutPort(new Port(this,"posX",OP_PORT_TYPE_VALUE)),this.outPosY=this.addOutPort(new Port(this,"posY",OP_PORT_TYPE_VALUE)),this.outPosZ=this.addOutPort(new Port(this,"posZ",OP_PORT_TYPE_VALUE)),o.outPosX.val=-o.posX.val,o.outPosY.val=-o.posY.val,o.outPosZ.val=-o.posZ.val;mat4.create();this.render.onTriggered=function(){e(),n(),(0!==d||0!==h||0!==u)&&(o.outPosX.val=-o.posX.val,o.outPosY.val=-o.posY.val,o.outPosZ.val=-o.posZ.val),cgl.pushMvMatrix(),vec3.set(l,-o.posX.val,-o.posY.val,-o.posZ.val),mat4.rotateX(cgl.mvMatrix,cgl.mvMatrix,s*o.rotX.val),mat4.rotateY(cgl.mvMatrix,cgl.mvMatrix,s*o.rotY.val),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,l),o.trigger.trigger(),cgl.popMvMatrix()};var P=document.getElementById("glcanvas");document.addEventListener("pointerlockchange",r,!1),document.addEventListener("mozpointerlockchange",r,!1),document.addEventListener("webkitpointerlockchange",r,!1),document.getElementById("glcanvas").addEventListener("mousedown",function(){document.addEventListener("mousemove",t,!1),P.requestPointerLock=P.requestPointerLock||P.mozRequestPointerLock||P.webkitRequestPointerLock,P.requestPointerLock()});var c=0,f=!1,p=!1,m=!1,O=!1},Ops.Gl.Matrix.WASDCamera.prototype=new Op;
//# sourceMappingURL=cables.ops.min.js.map