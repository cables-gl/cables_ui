<html>
<head>
    <!-- <meta name="viewport" content="width=device-width, user-scalable=no,initial-scale=1, maximum-scale=1"> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />

    <title>cables</title>
    <link rel="stylesheet" type="text/css" href="css/ui.css">
</head>
<body>




    <canvas id="glcanvas" width="640" height="360"></canvas>


        <script type="text/javascript" src="js/libs.js"></script>
    <script type="text/javascript" src="js/cables.max.js"></script> 
    <script type="text/javascript" src="js/cables.ops.max.js"></script> 
    <script type="text/javascript" src="js/cablesui.max.js"></script> 

<script id="entry-template" type="text/x-handlebars-template">
  <div class="entry">
    <h1>{{title}}</h1>
    <div class="body">
      {{body}}
    </div>
  </div>
</script>


<div id="modalbg"></div>
<div id="modalcontent"></div>


<div id="sidebar" class="hidden ">
    <div class="content">
        <a onclick="ui.toggleSideBar();" class="button">close</a>
        <br/>
        <br/>
        <a onclick="localStorage['holo']=ui.scene.serialize();" >save local storage</a>
        <br/>
        <a onclick="ui.scene.clear();ui.scene.deSerialize(localStorage['holo']);" >load local storage</a>

        <hr/>

        <a onclick="ui.exportDialog();" >export</a>
        <br/>
        <a onclick="ui.importDialog();" >import</a>
        <br/>
        <br/>
        <a onclick="ui.scene.clear();" >clear patch</a>
        <br/>
        <br/>

        <div id="projectlist"></div>
    </div>
</div>

<div id="patch" tabindex="1"></div>

<div id="timing"></div>
<div id="statusbar"></div>
<!-- <div id="splitter"></div> -->


<div id="meta">

    <div id="projectfiles">
    </div>
</div>
<div id="options" class="panel"></div>

<div id="menubar">

    <a onclick="ui.toggleSideBar();" class="button">cables</a>

    <a onclick="ui.showOpSelect(100,100);" class="button fa fa-plus-square-o tt" data-tt="create new op"></a>

    <a onclick="ui.cycleRendererSize();" class="button fa fa-expand tt"  data-tt="resize webgl renderer (esc to exit fullscreen)"></a>

    <div id="serverproject" style="float:left;display:none;">
        <a onclick="ui.saveCurrentProject();" class="button">save project <span id="serverprojectname"></span></a>
    </div>

    <a target="_blankk" class="viewProjectLink button fa fa-external-link"></a>


    <div id="loggedin">
        <div id="username"></div> <a class="button tt" href="/logout" data-tt="logout">logout</a>
    </div>

    <div id="loggedout">
        <div id="username">not logged in</div> <a class="button fa fa-sign-out" href="/"></a>
    </div>



</div>

<div class="tooltip"></div>


<script id="op_select" type="text/x-handlebars-template">
    
<div class="opsearch">
    <h2>selct op</h2>

    <input id="opsearch"/>

    <br/><br/>
    <style id="search_style"></style>


    <div style="height:300px;overflow:auto">
      {{#each ops}}

        <div class="searchresult searchable" data-opname="{{ name }}" data-index="{{lowercasename}}">
            <a onclick="ui.scene.addOp('{{name}}');CABLES.UI.MODAL.hide();" >{{name}}  {{isFunction}}</a>
        </div>

      {{/each}}
    </div>

</div>

</script>



<script id="params_op_head" type="text/x-handlebars-template">

    <div class="">
        <input class="medium" id="opname" oninput="ui.setCurrentOpTitle($('#opname').val());" value="{{op.name}}">
        <br/><br/>{{op.objName}}
        
        <br/>
        <br/>
    </div>

<table>

</script>


<script id="params_op_foot" type="text/x-handlebars-template">

</table>

<div>
{{{ json op.uiAttribs }}}
</div>

<div>
    <br/>
    <br/>
    <span class="button warn" onclick="if(confirm('delete ?'))ui.scene.deleteOp('{{op.id}}')">delete</span>
    <br/>
    <br/>
</div>

<script>

function inputIncrement(v,dir)
{
    var val=parseFloat(v);
    var add=1;
    if(Math.abs(val)<2) add=0.1;
        else if(Math.abs(val)<100) add=1;
            else add=10;

    return val+add*dir;
}

    $("input").keydown(function(e)
    {
        switch(e.which)
        {
            // case 37: // left
            // break;

            // case 39: // right
            // break;

            case 38: // up
                this.value=inputIncrement(this.value,1);
                $(this).trigger('input');
                return false;
            break;

            case 40: // down
                this.value=inputIncrement(this.value,-1);
                $(this).trigger('input');
                return false;
            break;

            default: return; // exit this handler for other keys
        }
        e.preventDefault(); // prevent the default action (scroll / move caret)
    });

    $("input").bind("mousewheel", function(event, delta) 
    {
        // var add=getInputFieldIncrementValue(this.value);

        if (delta > 0)
        {
            this.value = Math.round(1000*inputIncrement(this.value,1))/1000;
        }
        else
        {
            this.value = Math.round(1000*inputIncrement(this.value,-1))/1000;
        }

         $(this).trigger('input');
        return false;
     });
</script>

</script>



<script id="params_ports_head" type="text/x-handlebars-template">
    
<tr>
<th colspan="11">
<div class="panelhead">{{title}}:</div>
</th>
</tr>

</script>

<script id="params_port" type="text/x-handlebars-template">






<tr>
    <td class="port portType_{{ port.type }}">


        {{port.name}}
    </td>

<td>

        {{#compare port.uiAttribs.colorPick '==' 'true' }}
        <div class="button_colorpick button fa fa-eyedropper" id="watchcolorpick_{{ dirStr }}_{{ portnum }}"></div>
        {{/compare}}
</td>

    <td>

        {{#if isInput}}



            {{#if port.links}}

                    {{#compare port.type '==' '1' }}function{{/compare}}
                    {{#compare port.type '==' 0 }} <span class="value watchPortValue_{{ port.watchId }}">{{port.val}}</span>{{/compare}}
                    {{#compare port.type '==' '2' }} object {{/compare}}
                    
                {{else}}

                    {{#if port.uiAttribs.display}}

                        {{#compare port.uiAttribs.display '==' 'bool' }}
                            
                            <span class="button fa fa-toggle-on" onclick="CABLES.togglePortValBool('portval_{{ portnum }}');"></span>
                            <input class="value" id="portval_{{ portnum }}" value="{{ port.val }}" style="width:70px;display:inline;"/>

                        {{/compare}}
                        {{#compare port.uiAttribs.display '==' 'range' }}

                            <a class="timingbutton fa fa-clock-o" id="portanim_{{ dirStr }}_{{ portnum }}" ></a>
                            <input type ="range" class="range" min ="0" max="1.0" value="{{ port.val }}" step ="0.001" oninput="$('#portval_{{ portnum }}').val(this.value);$('#portval_{{ portnum }}').trigger('input');" style="width:135px;"/>
                            <input class="value watchPortValue_{{ port.watchId }}" id="portval_{{ portnum }}" value="{{ port.val }}" style="width:40px;display:inline;"/>

                        {{/compare}}
                        {{#compare port.uiAttribs.display '==' 'dropdown' }}
                            
                            <select oninput="$('#portval_{{ portnum }}').val(this.value);$('#portval_{{ portnum }}').trigger('input');">
                                <option value="">...</option>
                                {{#each port.uiAttribs.values}}
                                    <option value="{{ this }}">{{ this }}</option>
                                {{/each}}
                            </select>
                            <input class="value" id="portval_{{ portnum }}" value="{{ port.val }}" style="width:70px;display:inline;"/>
                        {{/compare}}

                    {{else}}
                    
                        {{#compare port.type '==' '1' }} function
                        {{/compare}}{{#compare port.type '==' 0 }}

                        <a class="timingbutton fa fa-clock-o" id="portanim_{{ dirStr }}_{{ portnum }}" ></a>
                        <input class="value watchPortValue_{{ port.watchId }}" id="portval_{{ portnum }}" value="{{ port.val }}"/>

                        {{/compare}}
                        {{#compare port.type '==' '2' }} object {{/compare}}
                    
                    {{/if}}
            {{/if}}

        {{else}}

            {{#compare port.type '==' '1' }}function{{/compare}}
            {{#compare port.type '==' 0 }} <span class="value watchPortValue_{{ port.watchId }}" >{{port.val}}</span> {{/compare}}
            {{#compare port.type '==' '2' }} object {{/compare}}

            
        {{/if}}
    </td>


    <td>

        {{#if port.links}}
            <a class="button fa fa-chain-broken" id="portdelete_{{ dirStr }}_{{ portnum }}" ></a>
            {{port.links.length}}x
        {{/if}}
    </td>
</tr>

</script>


<script id="tmpl_projectfiles_list" type="text/x-handlebars-template">
    <h2>files</h2>

    <table class="list">
        {{#each files}}
            <tr>
            <!--
            <td>
                <a class="button fa fa-info-circle" onclick="ui.showFileInfo*()"></a> 
            </td>-->
            <td>
                <a class="filename" onclick="ui.addAssetOp('/assets/{{projectId}}/{{_id}}{{suffix}}','{{suffix}}','{{name}}')">
                {{name}}
                </a>
            </td>
            <td>
                <a class="button fa fa-trash-o" onclick="CABLES.api.delete('project/{{projectId}}/file/{{_id}}',null,function(){ui.updateProjectFiles();});"></a>&nbsp;

                <!-- <a class="button fa fa-retweet"></a> -->
            </td>
            </tr>
        {{/each}}
    </table>
</script>


<script id="tmpl_projectfiles_upload" type="text/x-handlebars-template">
    <br/>
    <a class="fa fa-upload"></a>
    drag & drop files to browser window to upload...
</script>





<script id="projects" type="text/x-handlebars-template">



<div id="projects">
<h2>my projects:</h2>

<table>
    {{#each projects}}
    <tr>
        <td style="width:70%;">
            <a href="#/project/{{_id}}">{{name}}</a>
        </td>
        <td>
            <span class="button fa fa-trash-o tt" data-tt="delete" onclick="if(confirm('delete ?')) CABLES.api.delete('project/{{_id}}',{},function(){ ui.updateProjectList(); } );"></span>
            &nbsp;<span class="button fa fa-pencil-square-o tt" data-tt="rename" onclick="CABLES.api.put('project/{{_id}}',{name:prompt('projectname','{{name}}')},function(){ ui.updateProjectList(); } );"></span>
        </td>
    </tr>
    {{/each}}

</table>

<br/>
<span class="button" onclick="CABLES.api.post('project',{name: prompt('projectname','') },function(){ ui.updateProjectList(); } );">create project</span>



</div>

</script>



<script id="timeline_controler" type="text/x-handlebars-template">

<div id="timelineui">

    <a class="button tt" data-tt="insert key" onclick="ui.toggleTiming();">timing</a>

    <span class="timelinetime"></span>
    <span class="button timeLineInsert fa fa-plus-square-o"></span>

    <a class="button fa fa-step-backward" onclick="ui.scene.timer.setTime(0);"></a>
    <a class="button fa fa-backward" onclick="ui.scene.timer.setOffset(-2);"></a>
    <a class="button fa fa-play " id="timelineplay" onclick="ui.timeLine.togglePlay()"></a>
    <a class="button fa fa-forward" onclick="ui.scene.timer.setOffset(2);"></a>

    <input type ="range" min="20" max="2000" value="" step ="1" oninput="ui.timeLine.setTimeScale(this.value);" style="float:left;width:85px;margin-left:20px;margin-top:10px;" class="tt" data-tt="scale time display"/>


    <a id="keymovemode" class="button fa fa-arrows-h tt" data-tt="key move mode" ></a>
    <a id="keyscaleheight" class="button fa fa-ellipsis-v tt" data-tt="display max. value height"></a>

    <a id="centercursor" class="button fa fa-i-cursor tt" data-tt="scroll to cursor"></a>





</div>

    <div id="timelineTitle" ></div>
    <div id="timetimeline" ></div>
    <div id="timeline" tabindex="2"></div>


</script>


        <a id="undev" target="_blank" href="http://www.undev.de"></a>

    </body>
</html>
