<html>
<head>
    <title>cables</title>
    <link rel="stylesheet" type="text/css" href="css/ui.css">
</head>
<body>




    <canvas id="glcanvas" width="640" height="360"></canvas>


        <script type="text/javascript" src="js/libs.min.js"></script>
    <script type="text/javascript" src="js/cables.min.js"></script> 
    <script type="text/javascript" src="js/cables.ops.min.js"></script> 
    <script type="text/javascript" src="js/cablesui.min.js"></script> 

<script id="entry-template" type="text/x-handlebars-template">
  <div class="entry">
    <h1>{{title}}</h1>
    <div class="body">
      {{body}}
    </div>
  </div>
</script>




<div id="sidebar" class="hidden ">
    <div class="content">
        <a onclick="ui.toggleSideBar();" class="button">close</a>
        <br/>
        <br/>
        <a onclick="localStorage['holo']=ui.scene.serialize();" >save local storage</a>
        <br/>
        <a onclick="ui.scene.clear();ui.scene.deSerialize(localStorage['holo']);" >load local storage</a>

        <hr/>

        <a onclick="ui.exportDialog();" >export</a>
        <br/>
        <a onclick="ui.importDialog();" >import</a>
        <br/>
        <br/>
        <a onclick="ui.scene.clear();" >clear patch</a>

        <div id="projectlist"></div>
    </div>
</div>

<div id="patch"></div>

<div id="timing"></div>
<div id="statusbar"></div>
<div id="meta">

    <div id="projectfiles">
    </div>
</div>
<div id="options" class="panel"></div>

<div id="menubar">


    <a onclick="ui.toggleSideBar();" class="button">cables</a>

    <a onclick="ui.showOpSelect(100,100);" class="button">new op</a>

    <a onclick="ui.cycleRendererSize();" class="button">size</a>

    <div id="serverproject" style="float:left;display:none;">
        <a onclick="ui.saveCurrentProject();" class="button">save project <span id="serverprojectname"></span></a>
    </div>

    <a target="_blankk" class="viewProjectLink button">view</a>


    <div id="loggedin">
        <div id="username"></div> <a class="button" href="/logout">logout</a>
    </div>

    <div id="loggedout">
        <div id="username">not logged in</div> <a class="button" href="/">login</a>
    </div>



</div>

<div id="modalbg"></div>
<div id="modalcontent"></div>



<script id="op_select" type="text/x-handlebars-template">
    
<div class="opsearch">
<h2>selct op</h2>

<input id="opsearch"/>

<br/><br/>
<style id="search_style"></style>


<div style="height:300px;overflow:auto">
  {{#each ops}}

    <div class="searchresult searchable" data-opname="{{ name }}" data-index="{{lowercasename}}">
        <a onclick="ui.scene.addOp('{{name}}');ui.closeModal();" >{{name}}  {{isFunction}}</a>
    </div>


  {{/each}}
</div>

</div>


<script>

$( ".searchresult:first" ).addClass( "selected" );

    var displayBoxIndex=0;
    var Navigate = function(diff) 
    {
        displayBoxIndex += diff;

        if (displayBoxIndex < 0) displayBoxIndex = 0;
        var oBoxCollection = $(".searchresult:visible");
        var oBoxCollectionAll = $(".searchresult");
        if (displayBoxIndex >= oBoxCollection.length) displayBoxIndex = 0;
        if (displayBoxIndex < 0) displayBoxIndex = oBoxCollection.length - 1;

        var cssClass = "selected";
        oBoxCollectionAll.removeClass(cssClass);

        oBoxCollection.removeClass(cssClass).eq(displayBoxIndex).addClass(cssClass);
    }

    function onInput(e)
    {

        // $(".searchresult:visible").first().addClass( "selected" );
        displayBoxIndex=0;
        Navigate(0);
    }

    $('#opsearch').on('input',onInput);

    $('#opsearch').keydown(function(e) 
    {

        switch(e.which)
        {
            case 13:
            var opname=$('.selected').data('opname');

            ui.scene.addOp(opname);
            ui.closeModal();

            break;

            case 8:
                onInput();
                return true;
            break;


            case 37: // left
            break;

            case 38: // up
                $('.selected').removeClass('selected');
                Navigate(-1);
            break;

            case 39: // right
            break;

            case 40: // down
                $('.selected').removeClass('selected');
                Navigate(1);
            break;

            default: return; // exit this handler for other keys
        }
        e.preventDefault(); // prevent the default action (scroll / move caret)
    });

</script>



</script>



<script id="params_op_head" type="text/x-handlebars-template">

    <div class="">
        <h2>{{op.name}}</h2>
        [{{op.objName}}]
        <input id="opname" oninput="ui.setSelectedOpTitle($('#opname').val());" value="{{op.name}}">
        <br/>
        <br/>
    </div>

<table>

</script>


<script id="params_op_foot" type="text/x-handlebars-template">

</table>

<div>
{{{ json op.uiAttribs }}}
</div>

<div>
    <br/>
    <br/>
    <span class="button warn" onclick="if(confirm('delete ?'))ui.scene.deleteOp('{{op.id}}')">delete</span>
    <br/>
    <br/>
</div>

<script>

function inputIncrement(v,dir)
{
    var val=parseFloat(v);
    var add=1;
    if(Math.abs(val)<2) add=0.1;
        else if(Math.abs(val)<100) add=1;
            else add=10;

    return val+add*dir;
}

    $("input").keydown(function(e)
    {
        switch(e.which)
        {
            // case 37: // left
            // break;

            // case 39: // right
            // break;

            case 38: // up
                this.value=inputIncrement(this.value,1);
                $(this).trigger('input');
                return false;
            break;

            case 40: // down
                this.value=inputIncrement(this.value,-1);
                $(this).trigger('input');
                return false;
            break;

            default: return; // exit this handler for other keys
        }
        e.preventDefault(); // prevent the default action (scroll / move caret)
    });

    $("input").bind("mousewheel", function(event, delta) 
    {
        // var add=getInputFieldIncrementValue(this.value);

        if (delta > 0)
        {
            this.value = inputIncrement(this.value,1);
        }
        else
        {
            this.value = inputIncrement(this.value,-1);
        }

         $(this).trigger('input');
        return false;
     });
</script>

</script>



<script id="params_ports_head" type="text/x-handlebars-template">
    
<tr>
<th colspan="11">
<div class="panelhead">{{title}}:</div>
</th>
</tr>

</script>

<script id="params_port" type="text/x-handlebars-template">

<tr>
    <td class="port portType_{{ port.type }}">
        {{port.name}}
    </td>

    <td>

        {{#if isInput}}

            {{#if port.links}}

                    {{#compare port.type '==' '1' }}function{{/compare}}
                    {{#compare port.type '==' 0 }} <span class="value watchPortValue_{{ port.watchId }}">{{port.val}}</span>{{/compare}}
                    {{#compare port.type '==' '2' }} object {{/compare}}
                    
                {{else}}

                    {{#if port.uiAttribs.display}}
                        {{#compare port.uiAttribs.display '==' 'bool' }}
                            
                            <span class="button" onclick="CABLES.togglePortValBool('portval_{{ portnum }}');">toggle</span>
                            <input class="value" id="portval_{{ portnum }}" value="{{ port.val }}" style="width:70px;display:inline;"/>

                        {{/compare}}
                        {{#compare port.uiAttribs.display '==' 'range' }}

                            <input type ="range" min ="0" max="1.0" value="{{ port.val }}" step ="0.001" oninput="$('#portval_{{ portnum }}').val(this.value);$('#portval_{{ portnum }}').trigger('input');" style="width:135px;"/>
                            <input class="value" id="portval_{{ portnum }}" value="{{ port.val }}" style="width:40px;display:inline;"/>

                        {{/compare}}
                        {{#compare port.uiAttribs.display '==' 'dropdown' }}
                            
                            <select oninput="$('#portval_{{ portnum }}').val(this.value);$('#portval_{{ portnum }}').trigger('input');">
                                <option value="">...</option>
                                {{#each port.uiAttribs.values}}
                                    <option value="{{ this }}">{{ this }}</option>
                                {{/each}}
                            </select>
                            <input class="value" id="portval_{{ portnum }}" value="{{ port.val }}" style="width:70px;display:inline;"/>

                        {{/compare}}

                    {{else}}
                    
                        {{#compare port.type '==' '1' }} function
                        {{/compare}}{{#compare port.type '==' 0 }}
                        <input class="value" id="portval_{{ portnum }}" value="{{ port.val }}"/>
                        {{/compare}}
                        {{#compare port.type '==' '2' }} object {{/compare}}

                        
                    
                    {{/if}}
            {{/if}}

        {{else}}

            {{#compare port.type '==' '1' }}function{{/compare}}
            {{#compare port.type '==' 0 }} <span class="value watchPortValue_{{ port.watchId }}" >{{port.val}}</span> {{/compare}}
            {{#compare port.type '==' '2' }} object {{/compare}}

            
        {{/if}}
    </td>

    <td>
        {{#if port.links}}
            <a class="button" id="portdelete_{{ dirStr }}_{{ portnum }}" >unlink</a>
            {{port.links.length}}x
        {{/if}}
    </td>
</tr>

</script>


<script id="tmpl_projectfiles_list" type="text/x-handlebars-template">
    <div>
        <h2>files</h2>

        <table>
            {{#each files}}
                <tr>
                <td>
                    <a onclick="ui.addAssetOp('/assets/{{projectId}}/{{_id}}{{suffix}}','{{suffix}}','{{name}}')">
                    {{name}}
                    </a>
                </td>
                </tr>
            {{/each}}
        </table>
    </div>
</script>


<script id="tmpl_projectfiles_upload" type="text/x-handlebars-template">

    <div id="">

        <form action="/api/project/{{_id}}/file" method="post" enctype="multipart/form-data">
          <p>
            <input name="file" type="file" size="99999999" accept="*"/> 
          </p>  
          <button class="button" type="submit" style="border:none;">upload</button>
        </form>
    </div>


    <script>

        // Variable to store your files
        var files;

        // Add events
        $('input[type=file]').on('change', prepareUpload);

        // Grab the files and set them to our variable
        function prepareUpload(event)
        {
            console.log('prepare files...');
            files = event.target.files;
        }


        $('form').on('submit', uploadFiles);

        // Catch the form submit and upload the files
        function uploadFiles(event)
        {
          event.stopPropagation(); // Stop stuff happening
            event.preventDefault(); // Totally stop stuff happening

            // START A LOADING SPINNER HERE

            // Create a formdata object and add the files
            var data = new FormData();
            $.each(files, function(key, value)
            {
                data.append(key, value);
            });

            $.ajax({
                url: '/api/project/{{_id}}/file',
                type: 'POST',
                data: data,
                cache: false,
                dataType: 'json',
                processData: false, // Don't process the files
                contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                success: function(data, textStatus, jqXHR)
                {
                    if(typeof data.error === 'undefined')
                    {
                        ui.updateProjectFiles();
                        // Success so call function to process the form
                        // submitForm(event, data);
                    }
                    else
                    {
                        // Handle errors here
                        console.log('ERRORS: ' + data.error);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    // Handle errors here
                    console.log('ERRORS: ' + textStatus);
                    // STOP LOADING SPINNER
                }
            });
        }

    </script>




</script>



<script id="projects" type="text/x-handlebars-template">



<div id="projects">
<h2>my projects:</h2>

<table>
    {{#each projects}}
    <tr>
        <td style="width:70%;">
            <a href="#/project/{{_id}}">{{name}}</a>
        </td>
        <td>
            <span onclick="if(confirm('delete ?')) CABLES.api.delete('project/{{_id}}',{},function(){ ui.updateProjectList(); } );">[del]</span>
            &nbsp;<span onclick="CABLES.api.put('project/{{_id}}',{name:prompt('projectname','{{name}}')},function(){ ui.updateProjectList(); } );">[rename]</span>
        </td>
    </tr>
    {{/each}}

</table>

<br/>
<span class="button" onclick="CABLES.api.post('project',{name: prompt('projectname','') },function(){ ui.updateProjectList(); } );">create project</span>



</div>

</script>



<script id="timeline_controler" type="text/x-handlebars-template">

<div id="timelineui">

    <span class="timelinetime"></span>
    <span class="button timeLineInsert">insert</span>


    <a class="button" onclick="ui.scene.timer.setOffset(-4);">rew</a>

    <a class="button" onclick="ui.scene.timer.togglePlay();">play / pause</a>

    <a class="button" onclick="ui.scene.timer.setOffset(4);">fwd</a>

    <br/><br/>
</div>

    <div id="timeline"></div>


</script>


    </body>
</html>
