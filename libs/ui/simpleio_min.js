!function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err}var module=require.modules[resolved];if(!module.exports){module.exports={};module.client=module.component=true;module.call(this,module.exports,require.relative(resolved),module)}return module.exports}require.modules={};require.aliases={};require.resolve=function(path){if(path.charAt(0)==="/")path=path.slice(1);var index=path+"/index.js";var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"];for(var i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path}if(require.aliases.hasOwnProperty(index)){return require.aliases[index]}};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,definition){require.modules[path]=definition};require.alias=function(from,to){if(!require.modules.hasOwnProperty(from)){throw new Error('Failed to alias "'+from+'", it does not exist')}require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path};localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))};return localRequire};require.register("component-emitter/index.js",function(exports,require,module){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}fn._off=on;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var i=callbacks.indexOf(fn._off||fn);if(~i)callbacks.splice(i,1);return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}});require.register("simpleio/lib/client/index.js",function(exports,require,module){exports.Client=require("./Client");exports.create=function(options){return new exports.Client(options)}});require.register("simpleio/lib/client/Client.js",function(exports,require,module){var Emitter=require("emitter"),sio=require("./index"),Multiplexer=require("../shared/Multiplexer"),$=require("../shared/utils");function Client(options){var self=this;this.options=$.extend({},Client.options,options);this.ajax=this.options.ajax;this._multiplexer=new Multiplexer({duration:this.options.multiplexDuration}).on("reset",function(){self._open(true)});this._connections=0;this._delivered=[];this._reconnectionAttempts=1;this._id=$.uid()}Client.options={url:"/simpleio",ajax:null,reconnectionDelay:1e3,maxReconnectionDelay:1e4,multiplexDuration:500,ajaxOptions:{cache:false,dataType:"json",async:true,global:false,timeout:1e3*60*2,complete:$.noop,simpleio:true}};Emitter(Client.prototype);module.exports=Client;Client.prototype.connect=function(data){if(!this._polling){this._polling=true;this._defaultData=data;this._open(true)}return this};Client.prototype.disconnect=function(){this._polling=false;if(this._xhr){this._xhr.abort()}return this};Client.prototype.send=function(message,callback){this._multiplexer.add(message);if(callback)this.once("success",callback);return this};Client.prototype._open=function(immediately){var self=this,data=this._defaultData?$.extend({},this._defaultData):{};data.client=this._id;if(!this._polling){return this}if(!immediately&&this._connections>0){return this}if(this._multiplexer.get().length){data.messages=this._multiplexer.get();this._multiplexer.reset()}if(this._delivered.length){data.delivered=this._delivered;this._delivered=[]}this._connections++;this._xhr=this.ajax($.extend({},this.options.ajaxOptions,{url:this.options.url,type:data.messages||data.delivered?"post":"get",data:data,success:function(data,status,xhr){self.emit("success",data,status,xhr);self._onSuccess(data)},error:function(xhr,status,error){self.emit("error",xhr,status,error);self._onError(data)}}));return this};Client.prototype._reopen=function(){var self=this,delay;this._reconnectionAttempts++;delay=this._reconnectionAttempts*this.options.reconnectionDelay;delay=Math.min(delay,this.options.maxReconnectionDelay);setTimeout(function(){self._open()},delay);return this};Client.prototype._onError=function(data){this._connections--;if(data.delivered){this._delivered.push.apply(this._delivered,data.delivered)}if(data.messages){this._multiplexer.add(data.messages)}this._reopen()};Client.prototype._onSuccess=function(data){var self=this;this._connections--;this._reconnectionAttempts=1;if(data.messages.length){$.each(data.messages,function(message){self._delivered.push(message.id);if(message.data.event){self.emit(message.data.event,message.data.data)}self.emit("message",message)})}this._open(Boolean(this._delivered.length))}});require.register("simpleio/lib/shared/Multiplexer.js",function(exports,require,module){var Emitter,$=require("./utils");try{Emitter=require("emitter-component")}catch(err){Emitter=require("emitter")}function Multiplexer(opts){var self=this;this._messages=[];this._timeoutId=setInterval(function(){self.reset(true)},opts.duration)}Emitter(Multiplexer.prototype);module.exports=Multiplexer;Multiplexer.prototype.add=function(messages){if($.isArray(messages)){this._messages.push.apply(this._messages,messages)}else if(messages){this._messages.push(messages)}return this};Multiplexer.prototype.reset=function(emit){if(this._messages.length){if(emit)this.emit("reset");this._messages=[]}return this};Multiplexer.prototype.get=function(){return this._messages};Multiplexer.prototype.stop=function(){clearInterval(this._timeoutId);this.removeAllListeners();return this}});require.register("simpleio/lib/shared/utils.js",function(exports,require,module){var toString=Object.prototype.toString,nativeForEach=Array.prototype.forEach,hasOwnProperty=Object.prototype.hasOwnProperty,slice=Array.prototype.slice;exports.isArray=Array.isArray||function(obj){return toString.call(obj)=="[object Array]"};exports.now=Date.now||function(){return(new Date).getTime()};exports.each=function(obj,iterator,context){var i,key;if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(i=0,l=obj.length;i<l;i++){iterator.call(context,obj[i],i,obj)}}else{for(key in obj){if(exports.has(obj,key)){iterator.call(context,obj[key],key,obj)}}}};exports.has=function(obj,key){return hasOwnProperty.call(obj,key)};exports.extend=function(obj){exports.each(slice.call(arguments,1),function(source){var prop;if(source){for(prop in source){obj[prop]=source[prop]}}});return obj};exports.uid=function(){return Math.round(Math.random()*exports.now())};exports.noop=function(){}});require.alias("component-emitter/index.js","simpleio/deps/emitter/index.js");require.alias("component-emitter/index.js","emitter/index.js");require.alias("simpleio/lib/client/index.js","simpleio/index.js");if(typeof exports=="object"){module.exports=require("simpleio")}else if(typeof define=="function"&&define.amd){define(function(){return require("simpleio")})}else{this["simpleio"]=require("simpleio")}}();